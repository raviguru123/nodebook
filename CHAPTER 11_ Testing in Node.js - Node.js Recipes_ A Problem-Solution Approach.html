<!DOCTYPE html>
<!-- saved from url=(0102)https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml -->
<html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" "="" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="1573407" data-user-uuid="29525685-85c9-45c7-9eda-3c178d86398e" data-username="raviguru0007" data-account-type="Trial" data-activated-trial-date="04/17/2017" data-archive="9781430260585" data-publishers="Apress" data-htmlfile-name="9781430260585_Ch11.xhtml" data-epub-title="Node.js Recipes: A Problem-Solution Approach" data-debug="0" data-testing="0"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781430260585"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><script type="text/javascript" src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/510f1a6865"></script><script src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/nr-spa-1026.min.js"></script><script type="text/javascript" async="" src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/linkid.js"></script><script async="" src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/analytics.js"></script><script type="text/javascript">(window.NREUM||(NREUM={})).loader_config={xpid:"VQQDUVVVGwACU1RUAQA="};window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var o=e[n]={exports:{}};t[n][0].call(o.exports,function(e){var o=t[n][1][e];return r(o||e)},o,o.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,n){function r(t){try{c.console&&console.log(t)}catch(e){}}var o,i=t("ee"),a=t(19),c={};try{o=localStorage.getItem("__nr_flags").split(","),console&&"function"==typeof console.log&&(c.console=!0,o.indexOf("dev")!==-1&&(c.dev=!0),o.indexOf("nr_dev")!==-1&&(c.nrDev=!0))}catch(s){}c.nrDev&&i.on("internal-error",function(t){r(t.stack)}),c.dev&&i.on("fn-err",function(t,e,n){r(n.stack)}),c.dev&&(r("NR AGENT IN DEVELOPMENT MODE"),r("flags: "+a(c,function(t,e){return t}).join(", ")))},{}],2:[function(t,e,n){function r(t,e,n,r,o){try{d?d-=1:i("err",[o||new UncaughtException(t,e,n)])}catch(c){try{i("ierr",[c,s.now(),!0])}catch(u){}}return"function"==typeof f&&f.apply(this,a(arguments))}function UncaughtException(t,e,n){this.message=t||"Uncaught error with no additional information",this.sourceURL=e,this.line=n}function o(t){i("err",[t,s.now()])}var i=t("handle"),a=t(20),c=t("ee"),s=t("loader"),f=window.onerror,u=!1,d=0;s.features.err=!0,t(1),window.onerror=r;try{throw new Error}catch(p){"stack"in p&&(t(12),t(11),"addEventListener"in window&&t(6),s.xhrWrappable&&t(13),u=!0)}c.on("fn-start",function(t,e,n){u&&(d+=1)}),c.on("fn-err",function(t,e,n){u&&(this.thrown=!0,o(n))}),c.on("fn-end",function(){u&&!this.thrown&&d>0&&(d-=1)}),c.on("internal-error",function(t){i("ierr",[t,s.now(),!0])})},{}],3:[function(t,e,n){t("loader").features.ins=!0},{}],4:[function(t,e,n){function r(){C++,N=y.hash,this[u]=M.now()}function o(){C--,y.hash!==N&&i(0,!0);var t=M.now();this[l]=~~this[l]+t-this[u],this[d]=t}function i(t,e){x.emit("newURL",[""+y,e])}function a(t,e){t.on(e,function(){this[e]=M.now()})}var c="-start",s="-end",f="-body",u="fn"+c,d="fn"+s,p="cb"+c,h="cb"+s,l="jsTime",m="fetch",v="addEventListener",w=window,y=w.location;if(w[v]){var b=t(9),g=t(10),x=t(8),E=t(6),O=t(12),R=t(7),P=t(13),T=t("ee"),S=T.get("tracer");t(14);var M=t("loader");M.features.spa=!0;var N,j=w[v],C=0;T.on(u,r),T.on(p,r),T.on(d,o),T.on(h,o),T.buffer([u,d,"xhr-done","xhr-resolved"]),E.buffer([u]),O.buffer(["setTimeout"+s,"clearTimeout"+c,u]),P.buffer([u,"new-xhr","send-xhr"+c]),R.buffer([m+c,m+"-done",m+f+c,m+f+s]),x.buffer(["newURL"]),b.buffer([u]),g.buffer(["propagate",p,h,"executor-err","resolve"+c]),S.buffer([u,"no-"+u]),a(P,"send-xhr"+c),a(T,"xhr-resolved"),a(T,"xhr-done"),a(R,m+c),a(R,m+"-done"),x.on("pushState-end",i),x.on("replaceState-end",i),j("hashchange",i,!0),j("load",i,!0),j("popstate",function(){i(0,C>1)},!0)}},{}],5:[function(t,e,n){function r(t){}if(window.performance&&window.performance.timing&&window.performance.getEntriesByType){var o=t("ee"),i=t("handle"),a=t(12),c=t(11),s="learResourceTimings",f="addEventListener",u="resourcetimingbufferfull",d="bstResource",p="resource",h="-start",l="-end",m="fn"+h,v="fn"+l,w="bstTimer",y="pushState",b=t("loader");b.features.stn=!0,t(8);var g=NREUM.o.EV;o.on(m,function(t,e){var n=t[0];n instanceof g&&(this.bstStart=b.now())}),o.on(v,function(t,e){var n=t[0];n instanceof g&&i("bst",[n,e,this.bstStart,b.now()])}),a.on(m,function(t,e,n){this.bstStart=b.now(),this.bstType=n}),a.on(v,function(t,e){i(w,[e,this.bstStart,b.now(),this.bstType])}),c.on(m,function(){this.bstStart=b.now()}),c.on(v,function(t,e){i(w,[e,this.bstStart,b.now(),"requestAnimationFrame"])}),o.on(y+h,function(t){this.time=b.now(),this.startPath=location.pathname+location.hash}),o.on(y+l,function(t){i("bstHist",[location.pathname+location.hash,this.startPath,this.time])}),f in window.performance&&(window.performance["c"+s]?window.performance[f](u,function(t){i(d,[window.performance.getEntriesByType(p)]),window.performance["c"+s]()},!1):window.performance[f]("webkit"+u,function(t){i(d,[window.performance.getEntriesByType(p)]),window.performance["webkitC"+s]()},!1)),document[f]("scroll",r,{passive:!0}),document[f]("keypress",r,!1),document[f]("click",r,!1)}},{}],6:[function(t,e,n){function r(t){for(var e=t;e&&!e.hasOwnProperty(u);)e=Object.getPrototypeOf(e);e&&o(e)}function o(t){c.inPlace(t,[u,d],"-",i)}function i(t,e){return t[1]}var a=t("ee").get("events"),c=t(22)(a,!0),s=t("gos"),f=XMLHttpRequest,u="addEventListener",d="removeEventListener";e.exports=a,"getPrototypeOf"in Object?(r(document),r(window),r(f.prototype)):f.prototype.hasOwnProperty(u)&&(o(window),o(f.prototype)),a.on(u+"-start",function(t,e){var n=t[1],r=s(n,"nr@wrapped",function(){function t(){if("function"==typeof n.handleEvent)return n.handleEvent.apply(n,arguments)}var e={object:t,"function":n}[typeof n];return e?c(e,"fn-",null,e.name||"anonymous"):n});this.wrapped=t[1]=r}),a.on(d+"-start",function(t){t[1]=this.wrapped||t[1]})},{}],7:[function(t,e,n){function r(t,e,n){var r=t[e];"function"==typeof r&&(t[e]=function(){var t=r.apply(this,arguments);return o.emit(n+"start",arguments,t),t.then(function(e){return o.emit(n+"end",[null,e],t),e},function(e){throw o.emit(n+"end",[e],t),e})})}var o=t("ee").get("fetch"),i=t(19);e.exports=o;var a=window,c="fetch-",s=c+"body-",f=["arrayBuffer","blob","json","text","formData"],u=a.Request,d=a.Response,p=a.fetch,h="prototype";u&&d&&p&&(i(f,function(t,e){r(u[h],e,s),r(d[h],e,s)}),r(a,"fetch",c),o.on(c+"end",function(t,e){var n=this;e?e.clone().arrayBuffer().then(function(t){n.rxSize=t.byteLength,o.emit(c+"done",[null,e],n)}):o.emit(c+"done",[t],n)}))},{}],8:[function(t,e,n){var r=t("ee").get("history"),o=t(22)(r);e.exports=r,o.inPlace(window.history,["pushState","replaceState"],"-")},{}],9:[function(t,e,n){var r=t("ee").get("mutation"),o=t(22)(r),i=NREUM.o.MO;e.exports=r,i&&(window.MutationObserver=function(t){return this instanceof i?new i(o(t,"fn-")):i.apply(this,arguments)},MutationObserver.prototype=i.prototype)},{}],10:[function(t,e,n){function r(t){var e=a.context(),n=c(t,"executor-",e),r=new f(n);return a.context(r).getCtx=function(){return e},a.emit("new-promise",[r,e],e),r}function o(t,e){return e}var i=t(22),a=t("ee").get("promise"),c=i(a),s=t(19),f=NREUM.o.PR;e.exports=a,f&&(window.Promise=r,["all","race"].forEach(function(t){var e=f[t];f[t]=function(n){function r(t){return function(){a.emit("propagate",[null,!o],i),o=o||!t}}var o=!1;s(n,function(e,n){Promise.resolve(n).then(r("all"===t),r(!1))});var i=e.apply(f,arguments),c=f.resolve(i);return c}}),["resolve","reject"].forEach(function(t){var e=f[t];f[t]=function(t){var n=e.apply(f,arguments);return t!==n&&a.emit("propagate",[t,!0],n),n}}),f.prototype["catch"]=function(t){return this.then(null,t)},f.prototype=Object.create(f.prototype,{constructor:{value:r}}),s(Object.getOwnPropertyNames(f),function(t,e){try{r[e]=f[e]}catch(n){}}),a.on("executor-start",function(t){t[0]=c(t[0],"resolve-",this),t[1]=c(t[1],"resolve-",this)}),a.on("executor-err",function(t,e,n){t[1](n)}),c.inPlace(f.prototype,["then"],"then-",o),a.on("then-start",function(t,e){this.promise=e,t[0]=c(t[0],"cb-",this),t[1]=c(t[1],"cb-",this)}),a.on("then-end",function(t,e,n){this.nextPromise=n;var r=this.promise;a.emit("propagate",[r,!0],n)}),a.on("cb-end",function(t,e,n){a.emit("propagate",[n,!0],this.nextPromise)}),a.on("propagate",function(t,e,n){this.getCtx&&!e||(this.getCtx=function(){if(t instanceof Promise)var e=a.context(t);return e&&e.getCtx?e.getCtx():this})}),r.toString=function(){return""+f})},{}],11:[function(t,e,n){var r=t("ee").get("raf"),o=t(22)(r),i="equestAnimationFrame";e.exports=r,o.inPlace(window,["r"+i,"mozR"+i,"webkitR"+i,"msR"+i],"raf-"),r.on("raf-start",function(t){t[0]=o(t[0],"fn-")})},{}],12:[function(t,e,n){function r(t,e,n){t[0]=a(t[0],"fn-",null,n)}function o(t,e,n){this.method=n,this.timerDuration="number"==typeof t[1]?t[1]:0,t[0]=a(t[0],"fn-",this,n)}var i=t("ee").get("timer"),a=t(22)(i),c="setTimeout",s="setInterval",f="clearTimeout",u="-start",d="-";e.exports=i,a.inPlace(window,[c,"setImmediate"],c+d),a.inPlace(window,[s],s+d),a.inPlace(window,[f,"clearImmediate"],f+d),i.on(s+u,r),i.on(c+u,o)},{}],13:[function(t,e,n){function r(t,e){d.inPlace(e,["onreadystatechange"],"fn-",c)}function o(){var t=this,e=u.context(t);t.readyState>3&&!e.resolved&&(e.resolved=!0,u.emit("xhr-resolved",[],t)),d.inPlace(t,v,"fn-",c)}function i(t){w.push(t),l&&(b=-b,g.data=b)}function a(){for(var t=0;t<w.length;t++)r([],w[t]);w.length&&(w=[])}function c(t,e){return e}function s(t,e){for(var n in t)e[n]=t[n];return e}t(6);var f=t("ee"),u=f.get("xhr"),d=t(22)(u),p=NREUM.o,h=p.XHR,l=p.MO,m="readystatechange",v=["onload","onerror","onabort","onloadstart","onloadend","onprogress","ontimeout"],w=[];e.exports=u;var y=window.XMLHttpRequest=function(t){var e=new h(t);try{u.emit("new-xhr",[e],e),e.addEventListener(m,o,!1)}catch(n){try{u.emit("internal-error",[n])}catch(r){}}return e};if(s(h,y),y.prototype=h.prototype,d.inPlace(y.prototype,["open","send"],"-xhr-",c),u.on("send-xhr-start",function(t,e){r(t,e),i(e)}),u.on("open-xhr-start",r),l){var b=1,g=document.createTextNode(b);new l(a).observe(g,{characterData:!0})}else f.on("fn-end",function(t){t[0]&&t[0].type===m||a()})},{}],14:[function(t,e,n){function r(t){var e=this.params,n=this.metrics;if(!this.ended){this.ended=!0;for(var r=0;r<d;r++)t.removeEventListener(u[r],this.listener,!1);if(!e.aborted){if(n.duration=a.now()-this.startTime,4===t.readyState){e.status=t.status;var i=o(t,this.lastSize);if(i&&(n.rxSize=i),this.sameOrigin){var s=t.getResponseHeader("X-NewRelic-App-Data");s&&(e.cat=s.split(", ").pop())}}else e.status=0;n.cbTime=this.cbTime,f.emit("xhr-done",[t],t),c("xhr",[e,n,this.startTime])}}}function o(t,e){var n=t.responseType;if("json"===n&&null!==e)return e;var r="arraybuffer"===n||"blob"===n||"json"===n?t.response:t.responseText;return l(r)}function i(t,e){var n=s(e),r=t.params;r.host=n.hostname+":"+n.port,r.pathname=n.pathname,t.sameOrigin=n.sameOrigin}var a=t("loader");if(a.xhrWrappable){var c=t("handle"),s=t(15),f=t("ee"),u=["load","error","abort","timeout"],d=u.length,p=t("id"),h=t(18),l=t(17),m=window.XMLHttpRequest;a.features.xhr=!0,t(13),f.on("new-xhr",function(t){var e=this;e.totalCbs=0,e.called=0,e.cbTime=0,e.end=r,e.ended=!1,e.xhrGuids={},e.lastSize=null,h&&(h>34||h<10)||window.opera||t.addEventListener("progress",function(t){e.lastSize=t.loaded},!1)}),f.on("open-xhr-start",function(t){this.params={method:t[0]},i(this,t[1]),this.metrics={}}),f.on("open-xhr-end",function(t,e){"loader_config"in NREUM&&"xpid"in NREUM.loader_config&&this.sameOrigin&&e.setRequestHeader("X-NewRelic-ID",NREUM.loader_config.xpid)}),f.on("send-xhr-start",function(t,e){var n=this.metrics,r=t[0],o=this;if(n&&r){var i=l(r);i&&(n.txSize=i)}this.startTime=a.now(),this.listener=function(t){try{"abort"===t.type&&(o.params.aborted=!0),("load"!==t.type||o.called===o.totalCbs&&(o.onloadCalled||"function"!=typeof e.onload))&&o.end(e)}catch(n){try{f.emit("internal-error",[n])}catch(r){}}};for(var c=0;c<d;c++)e.addEventListener(u[c],this.listener,!1)}),f.on("xhr-cb-time",function(t,e,n){this.cbTime+=t,e?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&&"function"==typeof n.onload||this.end(n)}),f.on("xhr-load-added",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&!this.xhrGuids[n]&&(this.xhrGuids[n]=!0,this.totalCbs+=1)}),f.on("xhr-load-removed",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&this.xhrGuids[n]&&(delete this.xhrGuids[n],this.totalCbs-=1)}),f.on("addEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-added",[t[1],t[2]],e)}),f.on("removeEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-removed",[t[1],t[2]],e)}),f.on("fn-start",function(t,e,n){e instanceof m&&("onload"===n&&(this.onload=!0),("load"===(t[0]&&t[0].type)||this.onload)&&(this.xhrCbStart=a.now()))}),f.on("fn-end",function(t,e){this.xhrCbStart&&f.emit("xhr-cb-time",[a.now()-this.xhrCbStart,this.onload,e],e)})}},{}],15:[function(t,e,n){e.exports=function(t){var e=document.createElement("a"),n=window.location,r={};e.href=t,r.port=e.port;var o=e.href.split("://");!r.port&&o[1]&&(r.port=o[1].split("/")[0].split("@").pop().split(":")[1]),r.port&&"0"!==r.port||(r.port="https"===o[0]?"443":"80"),r.hostname=e.hostname||n.hostname,r.pathname=e.pathname,r.protocol=o[0],"/"!==r.pathname.charAt(0)&&(r.pathname="/"+r.pathname);var i=!e.protocol||":"===e.protocol||e.protocol===n.protocol,a=e.hostname===document.domain&&e.port===n.port;return r.sameOrigin=i&&(!e.hostname||a),r}},{}],16:[function(t,e,n){function r(){}function o(t,e,n){return function(){return i(t,[f.now()].concat(c(arguments)),e?null:this,n),e?void 0:this}}var i=t("handle"),a=t(19),c=t(20),s=t("ee").get("tracer"),f=t("loader"),u=NREUM;"undefined"==typeof window.newrelic&&(newrelic=u);var d=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],p="api-",h=p+"ixn-";a(d,function(t,e){u[e]=o(p+e,!0,"api")}),u.addPageAction=o(p+"addPageAction",!0),u.setCurrentRouteName=o(p+"routeName",!0),e.exports=newrelic,u.interaction=function(){return(new r).get()};var l=r.prototype={createTracer:function(t,e){var n={},r=this,o="function"==typeof e;return i(h+"tracer",[f.now(),t,n],r),function(){if(s.emit((o?"":"no-")+"fn-start",[f.now(),r,o],n),o)try{return e.apply(this,arguments)}finally{s.emit("fn-end",[f.now()],n)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,e){l[e]=o(h+e)}),newrelic.noticeError=function(t){"string"==typeof t&&(t=new Error(t)),i("err",[t,f.now()])}},{}],17:[function(t,e,n){e.exports=function(t){if("string"==typeof t&&t.length)return t.length;if("object"==typeof t){if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&t.byteLength)return t.byteLength;if("undefined"!=typeof Blob&&t instanceof Blob&&t.size)return t.size;if(!("undefined"!=typeof FormData&&t instanceof FormData))try{return JSON.stringify(t).length}catch(e){return}}}},{}],18:[function(t,e,n){var r=0,o=navigator.userAgent.match(/Firefox[\/\s](\d+\.\d+)/);o&&(r=+o[1]),e.exports=r},{}],19:[function(t,e,n){function r(t,e){var n=[],r="",i=0;for(r in t)o.call(t,r)&&(n[i]=e(r,t[r]),i+=1);return n}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],20:[function(t,e,n){function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(o<0?0:o);++r<o;)i[r]=t[e+r];return i}e.exports=r},{}],21:[function(t,e,n){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],22:[function(t,e,n){function r(t){return!(t&&t instanceof Function&&t.apply&&!t[a])}var o=t("ee"),i=t(20),a="nr@original",c=Object.prototype.hasOwnProperty,s=!1;e.exports=function(t,e){function n(t,e,n,o){function nrWrapper(){var r,a,c,s;try{a=this,r=i(arguments),c="function"==typeof n?n(r,a):n||{}}catch(f){p([f,"",[r,a,o],c])}u(e+"start",[r,a,o],c);try{return s=t.apply(a,r)}catch(d){throw u(e+"err",[r,a,d],c),d}finally{u(e+"end",[r,a,s],c)}}return r(t)?t:(e||(e=""),nrWrapper[a]=t,d(t,nrWrapper),nrWrapper)}function f(t,e,o,i){o||(o="");var a,c,s,f="-"===o.charAt(0);for(s=0;s<e.length;s++)c=e[s],a=t[c],r(a)||(t[c]=n(a,f?c+o:o,i,c))}function u(n,r,o){if(!s||e){var i=s;s=!0;try{t.emit(n,r,o,e)}catch(a){p([a,n,r,o])}s=i}}function d(t,e){if(Object.defineProperty&&Object.keys)try{var n=Object.keys(t);return n.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(r){p([r])}for(var o in t)c.call(t,o)&&(e[o]=t[o]);return e}function p(e){try{t.emit("internal-error",e)}catch(n){}}return t||(t=o),n.inPlace=f,n.flag=a,n}},{}],ee:[function(t,e,n){function r(){}function o(t){function e(t){return t&&t instanceof r?t:t?s(t,c,i):i()}function n(n,r,o,i){if(!p.aborted||i){t&&t(n,r,o);for(var a=e(o),c=l(n),s=c.length,f=0;f<s;f++)c[f].apply(a,r);var d=u[y[n]];return d&&d.push([b,n,r,a]),a}}function h(t,e){w[t]=l(t).concat(e)}function l(t){return w[t]||[]}function m(t){return d[t]=d[t]||o(n)}function v(t,e){f(t,function(t,n){e=e||"feature",y[n]=e,e in u||(u[e]=[])})}var w={},y={},b={on:h,emit:n,get:m,listeners:l,context:e,buffer:v,abort:a,aborted:!1};return b}function i(){return new r}function a(){(u.api||u.feature)&&(p.aborted=!0,u=p.backlog={})}var c="nr@context",s=t("gos"),f=t(19),u={},d={},p=e.exports=o();p.backlog=u},{}],gos:[function(t,e,n){function r(t,e,n){if(o.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return t[e]=r,r}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(t,e,n){function r(t,e,n,r){o.buffer([t],r),o.emit(t,e,n)}var o=t("ee").get("handle");e.exports=r,r.ee=o},{}],id:[function(t,e,n){function r(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,i,function(){return o++})}var o=1,i="nr@id",a=t("gos");e.exports=r},{}],loader:[function(t,e,n){function r(){if(!x++){var t=g.info=NREUM.info,e=p.getElementsByTagName("script")[0];if(setTimeout(u.abort,3e4),!(t&&t.licenseKey&&t.applicationID&&e))return u.abort();f(y,function(e,n){t[e]||(t[e]=n)}),s("mark",["onload",a()+g.offset],null,"api");var n=p.createElement("script");n.src="https://"+t.agent,e.parentNode.insertBefore(n,e)}}function o(){"complete"===p.readyState&&i()}function i(){s("mark",["domContent",a()+g.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(c=Math.max((new Date).getTime(),c))-g.offset}var c=(new Date).getTime(),s=t("handle"),f=t(19),u=t("ee"),d=window,p=d.document,h="addEventListener",l="attachEvent",m=d.XMLHttpRequest,v=m&&m.prototype;NREUM.o={ST:setTimeout,CT:clearTimeout,XHR:m,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var w=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-spa-1026.min.js"},b=m&&v&&v[h]&&!/CriOS/.test(navigator.userAgent),g=e.exports={offset:c,now:a,origin:w,features:{},xhrWrappable:b};t(16),p[h]?(p[h]("DOMContentLoaded",i,!1),d[h]("load",r,!1)):(p[l]("onreadystatechange",o),d[l]("onload",r)),s("mark",["firstbyte",c],null,"api");var x=0,E=t(21)},{}]},{},["loader",2,14,5,3,4]);</script><link rel="apple-touch-icon" href="https://www.safaribooksonline.com/static/images/apple-touch-icon.8cc2fd27400e.png"><link rel="shortcut icon" href="https://www.safaribooksonline.com/favicon.ico" type="image/x-icon"><link href="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/css" rel="stylesheet" type="text/css"><title>CHAPTER 11: Testing in Node.js - Node.js Recipes: A Problem-Solution Approach</title><link rel="stylesheet" href="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/74741d96e0ae.css" type="text/css"><link rel="stylesheet" type="text/css" href="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/annotator.e34eec1a0d5a.css"><link rel="stylesheet" href="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/font-awesome.min.css"><style type="text/css" title="ibis-book">
    #sbo-rt-content div{margin:1em 1em 1em 1em}#sbo-rt-content a{text-decoration:none}#sbo-rt-content img{max-width:100%;margin-top:10pt}#sbo-rt-content p.booktitle{font-weight:bold;font-size:2.5em;margin-top:2em;margin-bottom:8em;text-align:center}#sbo-rt-content p.bookauthor{font-weight:bold;font-size:1.7em;margin-top:0;margin-right:2em;margin-bottom:0;text-align:left}#sbo-rt-content p.booksubtitle{font-weight:bold;font-size:1.7em;margin-top:0;margin-bottom:7em;text-align:center;color:#8A8A8A}#sbo-rt-content .bookimage{font-size:1.2em;margin-top:0;margin-bottom:1em;text-align:left}#sbo-rt-content .fmpara{font-size:.9em;text-indent:0;margin-top:.5em;margin-bottom:.3em;text-align:justify}#sbo-rt-content .fmpara1{font-size:.9em;text-indent:0;margin-top:.4em;margin-bottom:.3em;text-align:right}#sbo-rt-content .inpara{text-indent:0;margin-top:.4em;margin-left:3em;margin-bottom:.3em}#sbo-rt-content .pub{margin-top:10em;margin-bottom:1em;text-align:right;margin-right:5em}#sbo-rt-content .copyright{font-size:.9em;margin-top:.4em;margin-bottom:.4em;margin-left:1.2em;margin-right:1.2em;text-align:left}#sbo-rt-content .copyright1{font-size:.9em;margin-top:.1em;margin-bottom:.1em;margin-left:4em;margin-right:3.3em;text-align:left;text-indent:-1.6em}#sbo-rt-content .copyright2{font-size:.9em;margin-top:.1em;margin-bottom:.1em;margin-left:4.2em}#sbo-rt-content .dedication{font-size:1.2em;margin-bottom:0;margin-top:3.5em;text-align:center;margin-right:1em;font-style:italic}#sbo-rt-content .dedication1{font-size:1.2em;margin-bottom:0;margin-top:.5em;text-align:center;margin-right:1em;font-style:normal}#sbo-rt-content .dedication2{font-size:1.2em;margin-bottom:0;margin-top:1.5em;text-align:center;margin-right:1em;font-style:italic}#sbo-rt-content .content-title{font-size:1.6em;margin-top:3em;margin-bottom:.1em;text-align:left;font-weight:bold}#sbo-rt-content .fmtitle{font-size:2.5em;margin-top:1em;margin-bottom:1em;text-align:left;font-weight:bold;border-bottom:1.1px solid black;padding-bottom:.8em}#sbo-rt-content .right{text-indent:0;margin-top:1em;margin-right:1.5em;margin-bottom:.3em;text-align:right}#sbo-rt-content .right1{text-indent:0;margin-top:0;margin-right:1.5em;margin-bottom:.2em;text-align:right}#sbo-rt-content .chapimage{margin-left:.2em;margin-top:1.5em;margin-bottom:1.5em;text-align:left}#sbo-rt-content p.ChapterNumber{font-weight:bold;font-size:1.7em;margin-top:10px;margin-left:0;margin-bottom:5px;text-align:left}#sbo-rt-content p.ChapterTitle{font-weight:bold;font-size:2.5em;margin-top:0;margin-bottom:1em;margin-left:0;text-align:left;border-bottom:1.1px solid black;padding-bottom:.8em}#sbo-rt-content p.PartNumber{font-weight:bold;font-size:1.7em;margin-top:10px;margin-left:0;margin-bottom:5px;text-align:left;padding-bottom:.8em}#sbo-rt-content p.partTitle{font-weight:bold;font-size:2.5em;margin-top:1em;margin-bottom:1em;margin-left:0;text-align:left}#sbo-rt-content .paraaftertitle{font-size:100%;text-indent:0;margin-top:0;margin-left:0;margin-bottom:0}#sbo-rt-content p.noindent{font-size:100%;text-indent:0;margin-top:1em;margin-bottom:0;margin-left:0;margin-right:0;text-align:left}#sbo-rt-content p.noindent1{font-size:100%;text-indent:0;margin-top:1em;margin-bottom:1em}#sbo-rt-content p.noindent2{font-size:100%;text-indent:0;margin-top:1.5em;margin-bottom:1em}#sbo-rt-content p.noindent3{font-size:100%;text-indent:0;margin-top:.8em;margin-bottom:.2em;margin-left:0;margin-right:0;text-align:center}#sbo-rt-content p.noindent4{font-size:100%;text-indent:0;margin-top:.8em;margin-bottom:.2em;margin-left:0;margin-right:0;text-align:left}#sbo-rt-content span.listing{font-weight:bold}#sbo-rt-content p.indent{font-size:100%;text-indent:1.2em;margin-top:.1em;margin-bottom:.1em;margin-left:0;margin-right:0;text-align:left}#sbo-rt-content p.indent1{font-size:100%;text-indent:1.2em;margin-top:0;margin-bottom:0;margin-left:0;margin-right:0;text-align:left}#sbo-rt-content p.indent1a{font-size:100%;text-indent:1.5em;margin-top:0;margin-bottom:0;margin-left:0;margin-right:4.5em;text-align:right}#sbo-rt-content p.indent2{font-size:100%;margin-top:.8em;margin-bottom:.8em;margin-left:2.4em;margin-right:2.4em;text-align:justify;font-style:italic}#sbo-rt-content p.indent3{font-size:100%;text-indent:1em;margin-top:.8em;margin-bottom:.8em;margin-left:1.8em;margin-right:1.8em;text-align:left}#sbo-rt-content p.indent4{font-size:100%;text-indent:1.3em;margin-top:.5em;margin-bottom:.5em;margin-left:2em;margin-right:0;text-align:left}#sbo-rt-content .blockquote{font-size:100%;text-indent:.2em;margin-top:1em;margin-left:3em;margin-right:2em;margin-bottom:1em;font-style:italic}#sbo-rt-content .blockquote1{font-size:100%;text-indent:.2em;margin-top:1em;margin-left:3em;margin-bottom:0;font-style:italic}#sbo-rt-content p.Heading1{font-weight:bold;font-size:2em;text-indent:0;margin-top:1.3em;margin-bottom:.3em}#sbo-rt-content p.Heading2{font-size:1.6em;text-indent:0;margin-top:1.3em;margin-bottom:.3em}#sbo-rt-content p.Heading2_2{font-size:1.6em;text-indent:0;margin-top:.3em;margin-bottom:.3em}#sbo-rt-content p.Heading2a{font-size:1.5em;text-indent:0;margin-top:1.3em;margin-bottom:.3em;font-weight:bold}#sbo-rt-content p.Heading3{font-weight:bold;font-size:1.45em;text-indent:0;margin-top:1.2em;margin-bottom:.1em}#sbo-rt-content p.Heading3a{font-weight:normal;font-size:1.25em;text-indent:0;margin-top:1.2em;margin-bottom:.1em}#sbo-rt-content p.Heading4{font-size:1.3em;text-indent:0;margin-top:1.3em;margin-bottom:.3em;text-align:left}#sbo-rt-content .img{max-width:100%;margin-top:10pt}#sbo-rt-content .img1{text-align:left}#sbo-rt-content .img1a{text-align:right;margin-right:5em;margin-top:5em}#sbo-rt-content .img2{text-align:left}#sbo-rt-content div.Figure{font-size:small;margin-top:1.5em;margin-bottom:1.5em}#sbo-rt-content .para-1{font-size:100%;margin-top:1em;text-indent:1.5em;margin-bottom:0;text-align:left}#sbo-rt-content .para-2{font-size:.9em;text-indent:-1.4em;margin-left:2.4em;margin-top:.5em;margin-bottom:0}#sbo-rt-content .figurecaption{font-size:small;margin-top:0;margin-bottom:0;text-align:justify}#sbo-rt-content .image{text-align:center}#sbo-rt-content .codecaption{font-size:100%;margin-top:.6em;margin-bottom:.6em;text-align:justify;font-style:italic}#sbo-rt-content .PCode{font-size:small;margin-top:1em;margin-bottom:1em;margin-left:0;text-align:left;font-family:monospace}#sbo-rt-content .PCode-1{font-size:small;margin-top:1em;margin-bottom:.1em;margin-left:0;text-align:left;font-family:monospace}#sbo-rt-content .PCode-2{font-size:small;margin-top:0;margin-bottom:0;margin-left:0;text-align:left;font-family:monospace}#sbo-rt-content .PCode-3{font-size:small;margin-top:0;margin-bottom:1em;margin-left:0;text-align:left;font-family:monospace}#sbo-rt-content div.singlethin{border-bottom:solid 3px;margin-left:1em;margin-right:1em;margin-bottom:1em}#sbo-rt-content div.singlethin1{margin-left:2em;margin-right:2em}#sbo-rt-content .inlinecode{font-family:monospace}#sbo-rt-content div.notepara{font-size:110%;text-indent:0;margin-top:1em;border-top:solid 1px;border-bottom:solid 1px;margin-bottom:1em;text-align:justify}#sbo-rt-content span.pink-box{font-weight:bold;padding-left:1.3em;padding-right:1.3em;border:1.1px solid black;font-size:1.5em;margin-top:.5em;margin-bottom:.5em;text-indent:0;text-align:justify}#sbo-rt-content span.courier{font-family:Courier New;font-weight:normal;font-style:normal;font-size:100%}#sbo-rt-content div.courier{font-family:Courier New;font-weight:normal;font-style:normal;font-size:100%;margin-top:1em;margin-bottom:1em}#sbo-rt-content div.boxcourier{font-family:Courier New;font-weight:normal;font-style:normal;font-size:100%;margin-top:1em;margin-bottom:1em;margin-left:1.5em;margin-right:1.5em;text-align:left}#sbo-rt-content span.courier1{font-family:Courier New;font-weight:normal;font-style:normal;font-size:95%}#sbo-rt-content .boxhead{font-size:1.25em;font-weight:bold;padding-left:.1em;padding-bottom:.1em;padding-top:.1em;margin-top:0;text-indent:0;text-align:center;border:3px solid black}#sbo-rt-content div.box{margin-top:1em;margin-bottom:1em}#sbo-rt-content .boxpara{font-size:110%;text-indent:0;margin-left:1.5em;margin-right:1.5em;margin-top:.5em;margin-bottom:.5em;text-align:left}#sbo-rt-content .alpha{font-size:1.2em;font-weight:bold;margin-left:.2em;margin-top:1em;margin-bottom:.3em;text-align:left}#sbo-rt-content .index{font-size:small;margin-left:.2em;margin-top:0;margin-bottom:0;text-align:left}#sbo-rt-content .index1{font-size:small;margin-left:1em;margin-top:0;margin-bottom:0;text-align:left}#sbo-rt-content .index2{font-size:small;margin-left:2em;margin-top:0;margin-bottom:0;text-align:left}#sbo-rt-content .cover{text-align:center}#sbo-rt-content .top{border-top:1.1px solid black;border-bottom:2px solid black}#sbo-rt-content .bot{border-bottom:2px solid black}#sbo-rt-content table.bodytable,#sbo-rt-content table{border-collapse:collapse;margin-bottom:8px;font-size:small;margin-top:10pt;width:95%;border-top:0 solid black;border-bottom:0 solid black}#sbo-rt-content table.fmtable{margin-bottom:1em;font-size:1em;margin-left:4em;border-top:0 solid #FFF;border-bottom:0 solid #FFF}#sbo-rt-content table{margin-bottom:1em;border-top:1.1px solid black;border-bottom:1.1px solid black;border-collapse:collapse}#sbo-rt-content th{border-top:1px solid black;border-bottom:1px solid black;padding-right:1.5em}#sbo-rt-content td{font-size:small;vertical-align:top;padding-right:1.5em;margin-top:0;margin-bottom:1em}#sbo-rt-content .tablepara{font-size:small;text-indent:0;margin-top:0;margin-bottom:.5em;padding-right:1.5em}#sbo-rt-content .tablepara1{font-size:small;margin-left:2em;margin-top:0;margin-bottom:0;padding-right:1.5em}#sbo-rt-content .header{border-bottom:1.1px solid black;text-indent:0;text-align:left}#sbo-rt-content .TabCapt{font-style:italic;margin-left:0;text-indent:0}#sbo-rt-content .FigCapt{font-style:italic;font-size:.9em}#sbo-rt-content .CaptNr{font-weight:bold}#sbo-rt-content .ttitle{font-style:Italic;margin-bottom:1em}#sbo-rt-content p.paraaftertitle1{font-size:.9em;text-indent:0;margin-top:.5em;margin-bottom:.8em;text-align:left}#sbo-rt-content p.para{font-size:small;text-indent:20px;margin-top:0;margin-bottom:0;text-align:justify}#sbo-rt-content p.quote{font-style:italic;font-size:100%;margin-top:1.5em;margin-left:2.5em;margin-right:2.5em;margin-bottom:0}#sbo-rt-content p.quotesource{font-size:small;text-indent:0;margin-top:1em;margin-bottom:1em;text-align:right}#sbo-rt-content p.chaptersubtitle{font-size:x-large;text-indent:0;margin-top:0;margin-left:0;margin-bottom:0;text-align:left}#sbo-rt-content p.line{margin-top:.3em;border-bottom:1px solid black}#sbo-rt-content p.line1{margin-top:.3em;margin-bottom:1.5em;border-bottom:1px solid black}#sbo-rt-content p.line2{margin-top:5em;margin-bottom:5em;border-bottom:1px solid black;text-align:center;margin-left:15em;margin-right:15em}#sbo-rt-content li{margin-bottom:.5em;margin-top:.5em}#sbo-rt-content p.alpha{font-size:1.2em;font-weight:bold;margin-left:.2em;margin-top:1em;margin-bottom:.3em;text-align:left}#sbo-rt-content ul.bulleted{font-size:100%;text-align:justify;margin-left:2.5em;margin-right:3em;margin-top:1em;margin-bottom:1em;text-indent:0}#sbo-rt-content ol.OrderedList{font-size:100%;text-align:left;margin-left:2.5em;margin-right:3em;margin-top:1em;margin-bottom:1em}#sbo-rt-content ul.bulleted1{font-size:100%;text-align:left;margin-left:1em;margin-right:5em;margin-top:1em;margin-bottom:1em;list-style-type:none}#sbo-rt-content ul.bulleted1_a{font-size:100%;text-align:justify;margin-left:0;margin-right:5em;margin-top:1em;margin-bottom:1em;text-indent:0;list-style-type:none}#sbo-rt-content ul.bulleted2{font-size:100%;text-align:justify;margin-left:2.3em;margin-right:5em;margin-top:1em;margin-bottom:1em;text-indent:0}#sbo-rt-content ul.bulleted4{font-size:100%;text-align:center;margin-left:1.3em;margin-right:5em;margin-top:1em;margin-bottom:1em;text-indent:0;list-style-type:none}#sbo-rt-content .numbered{font-size:small;text-align:justify;margin-left:2em;margin-right:2em;margin-top:.5em;margin-bottom:.5em;text-indent:1em}#sbo-rt-content .bulletedin{font-size:100%;text-align:justify;margin-left:4em;margin-right:4em;margin-top:.5em;margin-bottom:.5em}#sbo-rt-content ul.None{font-size:.9em;text-align:justify;margin-left:3em;margin-right:2em;margin-top:.5em;margin-bottom:.5em;list-style-type:none}#sbo-rt-content .Listing{font-size:small;margin-bottom:0}#sbo-rt-content .PCode1{font-size:small;margin-top:.7em;margin-bottom:0;text-align:left;font-family:monospace}#sbo-rt-content .PCode2{font-size:small;margin-top:1em;margin-bottom:.1em;margin-left:2.2em;text-align:left;font-family:monospace}#sbo-rt-content .PCode3{font-size:small;margin-top:0;margin-left:2.2em;margin-bottom:.1em;text-align:left;font-family:monospace}#sbo-rt-content .NoteCaption{font-size:small;margin-top:1.3em;margin-left:5em;margin-right:5em;border:1.1px solid black;padding:.5em;margin-bottom:1.3em}#sbo-rt-content .Table{font-size:100%;margin-bottom:1em;margin-left:0}#sbo-rt-content .toc{font-size:1.1em;margin-top:.2em;margin-bottom:.2em;text-align:left;font-weight:bold}#sbo-rt-content .toca{font-size:1.1em;margin-top:.8em;margin-bottom:.4em;text-align:left;font-weight:bold}#sbo-rt-content .toc1{font-size:1.1em;margin-top:.4em;margin-bottom:.3em;text-align:left;text-indent:1.4em;font-weight:normal}#sbo-rt-content .toc2{font-size:1.2em;margin-top:.4em;margin-bottom:.3em;text-align:left;font-weight:bold}#sbo-rt-content .toc3{font-size:.9em;margin-top:.4em;margin-bottom:.3em;text-align:left;text-indent:3.5em;font-weight:normal}#sbo-rt-content .toc4{font-size:1.1em;margin-top:.2em;margin-bottom:.5em;text-align:left;font-weight:bold}#sbo-rt-content .tocch{font-size:1.3em;margin-top:.7em;margin-bottom:.7em;text-align:left;font-weight:bold}#sbo-rt-content .noborder{margin-bottom:1em;border-top:0 solid #FFF;border-bottom:0 solid #FFF}#sbo-rt-content .authurright{text-align:right;margin-top:0;margin-bottom:0}#sbo-rt-content .FormalPara{font-size:small;margin-bottom:.7em}#sbo-rt-content .FontName1{font-size:100%;font-family:"Courier New",Courier,monospace}#sbo-rt-content span.FontName2{font-size:100%;font-family:"Courier New",Courier,monospace}#sbo-rt-content span.FontName3{font-size:100%;font-family:"Courier New",Courier,monospace}#sbo-rt-content .rightarrow{margin-top:0}#sbo-rt-content div.thinline{margin-top:1em;margin-bottom:1em;border-top:solid 4px #AFAFB0;border-bottom:solid 4px #AFAFB0}#sbo-rt-content span.line{text-decoration:underline}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content div.box{border-top:solid 2px;border-bottom:solid 2px}#sbo-rt-content .app{font-size:150%;margin-left:.8em}#sbo-rt-content .page{text-decoration:none;color:#000}#sbo-rt-content .cXXX{text-decoration:none;color:#000}#sbo-rt-content .textindent{margin-left:1.7em;margin-top:1em;margin-bottom:1em;font-size:100%}#sbo-rt-content .textindent1{margin-left:1.7em;margin-top:0;margin-bottom:0;font-size:100%}#sbo-rt-content .textindent2{margin-left:1.7em;margin-top:0;margin-bottom:0;font-size:100%;text-indent:1em}#sbo-rt-content p.FootNote{margin-top:.8em;margin-bottom:0;font-size:85%;text-indent:0;text-align:left;margin-left:1.1em;margin-right:1.1em}#sbo-rt-content pre{margin-left:0;font-family:monospace;white-space:pre-wrap}#sbo-rt-content p.Heading4a{font-size:1.15em;font-weight:bold;text-indent:1em;margin-top:1.3em;margin-bottom:.3em;border-top:3px solid #4d4d4c;border-left:solid 3px #4d4d4c;border-right:solid 3px #4d4d4c;border-bottom:solid 3px #4d4d4c;text-align:center}#sbo-rt-content p.noindent8{font-size:100%;text-indent:0;margin-top:1em;margin-bottom:1em;text-align:center;font-weight:bold;color:#8A8A8A}#sbo-rt-content .tocb{font-size:1.4em;margin-top:.5em;margin-bottom:.2em;text-align:left;font-weight:bold}#sbo-rt-content .part{font-weight:normal;font-size:1em;margin-bottom:5px;text-align:left;padding-left:1.3em;padding-bottom:10em;padding-right:1.3em;border:1.1px solid black}#sbo-rt-content p.Heading5{font-size:1em;text-indent:0;margin-top:1.3em;margin-bottom:.3em;text-align:center}#sbo-rt-content p.noindent5s{font-size:100%;text-indent:0;margin-top:.1em;margin-bottom:.1em;margin-left:0;margin-right:0;text-align:right}#sbo-rt-content span.strike{text-decoration:line-through}
    </style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9781430260585/chapter/9781430260585_Ch11.xhtml",
          "book_id": "9781430260585",
          "chapter_uri": "9781430260585_Ch11.xhtml",
          "position": 0,
          "user_uuid": "29525685-85c9-45c7-9eda-3c178d86398e",
          "next_chapter_uri": "/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch12.xhtml"
        
      },
      title: "Node.js Recipes: A Problem\u002DSolution Approach",
      author_list: "Cory Gackenheimer",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false,
      show_ios_app_teaser: false
    };
    // ]]></script><script src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/modernizr.js"></script><script>
    
      
        

        

        
          
            window.PUBLIC_ANNOTATIONS = true;
          
        

      

      
        window.MOBILE_PUBLIC_ANNOTATIONS = false;
      

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

    
      window.PRIVACY_CONTROL_SWITCH = true;
    

    
      window.PUBLISHER_PAGES = true;
    

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "https://www.safaribooksonline.com/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://www.safaribooksonline.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml"><meta name="description" content="CHAPTER 11 Testing in Node.js Testing allows you the peace of mind to know that the code you wrote is actually performing the operations that it was intended to ... "><meta property="og:title" content="CHAPTER 11: Testing in Node.js"><meta itemprop="isPartOf" content="/library/view/nodejs-recipes-a/9781430260585/"><meta itemprop="name" content="CHAPTER 11: Testing in Node.js"><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/9781430260585/"><meta property="og:description" itemprop="description" content="CHAPTER 11 Testing in Node.js Testing allows you the peace of mind to know that the code you wrote is actually performing the operations that it was intended to ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="Apress"><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781430260585"><meta property="og:book:author" itemprop="author" content="Cory Gackenheimer"><meta property="og:book:tag" itemprop="about" content="JavaScript"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: &lt;%= font_size %&gt; !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: &lt;%= font_family %&gt; !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: &lt;%= column_width %&gt;% !important; margin: 0 auto !important; }"></style><noscript>&lt;meta http-equiv="refresh" content="0; url=/library/no-js/" /&gt;</noscript><script type="text/javascript">
  (function(i,s,o,g,r,a,m) {
    i['GoogleAnalyticsObject']=r;
    i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();
    a=s.createElement(o),m=s.getElementsByTagName(o)[0];
    a.async=1;
    a.src=g;
    m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  var matches = document.cookie.match(/BrowserCookie\s*=\s*([a-f0-9\-]{36})/),
      user_uuid = null;

  if (matches && matches.length === 2) {
    user_uuid = matches[1];
  }


  ga('create', 'UA-39299553-7', {'userId': '29525685-85c9-45c7-9eda-3c178d86398e' });


ga('set', 'dimension1', 'Trial');
ga('set', 'dimension6', user_uuid);


  ga('set', 'dimension2', '29525685-85c9-45c7-9eda-3c178d86398e');
  






  //enable enhanced link tracking
  ga('require', 'linkid', 'linkid.js');

  // reading interface will track pageviews itself
  if (document.location.pathname.indexOf("/library/view") !== 0) {
    ga('send', 'pageview');
  }
</script><script defer="" src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/vendor.34024413b1d4.js"></script><script defer="" src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/reader.a05323b190d3.js"></script><script async="" src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/MathJax.js"></script><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts subscribe-panel library">

    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        





<a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="https://www.safaribooksonline.com/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"></path><rect x="10" y="12" width="3" height="7"></rect><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"></rect><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"></rect></g></svg><span>Safari Home</span></a></li><li><a href="https://www.safaribooksonline.com/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z"></path></g></svg><span>Recommended</span></a></li><li><a href="https://www.safaribooksonline.com/s/" class="t-queue-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z"></path></g></svg><span>
              
                Queue
              
            </span></a></li><li class="search"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="https://www.safaribooksonline.com/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z"></path></g></svg><span>History</span></a></li><li><a href="https://www.safaribooksonline.com/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" width="20" height="20" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z"></path></g></svg><span>Topics</span></a></li><li><a href="https://www.safaribooksonline.com/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z"></path></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>offers icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M35.9 20.6L27 15.5C26.1 15 24.7 15 23.7 15.5L14.9 20.6C13.9 21.1 13.2 22.4 13.2 23.4L13.2 41.4C13.2 42.4 13.9 43.7 14.9 44.2L23.3 49C24.2 49.5 25.6 49.5 26.6 49L35.9 43.6C36.8 43.1 37.6 41.8 37.6 40.8L37.6 23.4C37.6 22.4 36.8 21.1 35.9 20.6L35.9 20.6ZM40 8.2C39.1 7.6 37.6 7.6 36.7 8.2L30.2 11.9C29.3 12.4 29.3 13.2 30.2 13.8L39.1 18.8C40 19.4 40.7 20.6 40.7 21.7L40.7 39C40.7 40.1 41.4 40.5 42.4 40L48.2 36.6C49.1 36.1 49.8 34.9 49.8 33.8L49.8 15.6C49.8 14.6 49.1 13.3 48.2 12.8L40 8.2 40 8.2ZM27 10.1L33.6 6.4C34.5 5.9 34.5 5 33.6 4.5L26.6 0.5C25.6 0 24.2 0 23.3 0.5L16.7 4.2C15.8 4.7 15.8 5.6 16.7 6.1L23.7 10.1C24.7 10.6 26.1 10.6 27 10.1ZM10.1 21.7C10.1 20.6 10.8 19.4 11.7 18.8L20.6 13.8C21.5 13.2 21.5 12.4 20.6 11.9L13.6 7.9C12.7 7.4 11.2 7.4 10.3 7.9L1.6 12.8C0.7 13.3 0 14.6 0 15.6L0 33.8C0 34.9 0.7 36.1 1.6 36.6L8.4 40.5C9.3 41 10.1 40.6 10.1 39.6L10.1 21.7 10.1 21.7Z"></path></g></svg><span>Offers &amp; Deals</span></a><ul class="flyout"><li><a href="https://www.safaribooksonline.com/oreilly-newsletters/" class="l2 nav-icn"><span>Newsletters</span></a></li></ul></li><li class="nav-highlights"><a href="https://www.safaribooksonline.com/u/001o00000169U9HAAU/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" width="20" height="20" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z"></path></g></svg><span>Highlights</span></a></li><li><a href="https://www.safaribooksonline.com/u/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://www.safaribooksonline.com/public/support" class="l1 no-icon">Support</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="https://www.safaribooksonline.com/u/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a><span class="l2 t-nag-notification" id="nav-nag"><strong class="trial-green">10</strong> days left in your trial.
  
  

  
    
      

<a class="" href="https://www.safaribooksonline.com/subscribe/">Subscribe</a>.


    
  

  

</span></li><li><a href="https://www.safaribooksonline.com/public/support" class="l2">Support</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Node.js Recipes: A Problem-Solution Approach
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9781430260585/chapter/9781430260585_Ch11.xhtml" data-for-analytics="9781430260585:9781430260585_Ch11.xhtml" aria-label="Add to Queue"><span>Add to Queue</span></button></li><li class="js-font-control-panel font-control-activator"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml&amp;text=Node.js%20Recipes%3A%20A%20Problem-Solution%20Approach&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%20CHAPTER%2011%3A%20Testing%20in%20Node.js&amp;body=https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml%0D%0Afrom%20Node.js%20Recipes%3A%20A%20Problem-Solution%20Approach%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
        
        



 <!--[if lt IE 9]>
  
<![endif]-->



  <script defer="" src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/djangoMessagesPage.845b17d78025.js"></script>


        
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch10.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">CHAPTER 10: Connecting to a Data Store</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch12.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">CHAPTER 12: Debugging and Deploying Your Application</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content" style="transform: none;"><div class="annotator-wrapper"><p class="ChapterNumber"><a id="Chap_11"></a>CHAPTER 11</p>
<p class="chapimage"><img src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/frontdot.jpg" alt="image" width="82" height="25" data-mfp-src="/library/view/nodejs-recipes-a/9781430260585/images/frontdot.jpg"></p>
<p class="ChapterTitle">Testing in Node.js</p>
<div>
<p class="noindent">Testing allows you the peace of mind to know that the code you wrote is actually performing the operations that it was intended to do. Node.js offers a native implementation for writing some form of unit tests, and the Node.js community has created several robust libraries to aid you in your test-driven development process.</p>
<p class="indent">In this chapter you will investigate how to decide on a testing framework for your Node.js application, and you will also see a variety of techniques and testing mechanisms that you can use to create a fully tested application. Once you have built the tests that you need for your Node.js application, you will learn how to report on the tests that you have created and integrate them into your workflow.</p>
<p class="indent">There are a plethora of options for you to utilize when you are creating a Node.js testing<a id="cXXX.281m"></a> implementation. In this chapter you will get a chance to see a small sampling of the number of frameworks, including the following:</p>
<ul class="bulleted">
<li>Node.js assert</li>
<li>Nodeunit</li>
<li>Mocha</li>
<li>Chai.js</li>
<li>Vows.js</li>
<li>Should.js</li>
</ul>
<p class="indent">The ones that are used in this chapter feature more prominently in the community, but by all means this is not an exhaustive list. This chapter is designed to inform you enough to create a full test suite for your Node.js application, but I will attempt to remain agnostic about which framework you might eventually choose.</p>
<p id="Sec1" class="Heading1">11-1. Choosing a Framework for Test-Driven Development or Behavior-Driven Development</p>
<p class="noindent">You want to implement testing into your Node.js development process. To do this, you need to discover the best testing solution available to meet your testing needs.</p>
<p class="indent">The first thing that you should consider when you are choosing a testing framework is the types of tests you are trying to make. There are two generic categories to describe testing styles, which can then be broken down into smaller categories.</p>
<p class="indent">First, there is the classic test-driven development (TDD)<a id="cXXX.620"></a>. TDD<a id="cXXX.621"></a> is useful because you take a code requirement, write a failing test for that aspect of the requirement, then create the code that will allow that test to pass. The evolution of TDD is behavior-driven development (BDD).<a id="cXXX.622"></a> BDD<a id="cXXX.623"></a> takes not only a functional unit of code that can be tested, but also a business use case that can be tested, protecting both the code and the end users experience.</p>
<p class="indent">Your framework choice depends not only on the style of testing that you would prefer, but also on the types of testing that you wish to encounter. You might want to do some simple assertion testing only on critical values in your application. You may want to provide a code coverage summary to let you know where you can refactor and remove extraneous code from your application.</p>
<p class="indent">In this chapter you will see many implementations that each offer a unique take on testing in Node.js. It is not an exhaustive list but is meant to help you to gain a perspective on how to pick a testing framework that will work for you.</p>
<p class="indent">Some work seamlessly with asynchronous code; others perform better on a large-scale test project. These decisions are up to you, the developer, to decide which suits your need. Should you choose any or none of these frameworks is not as important as getting testing into your workflow and building a Node.js application that you know is well tested.</p>
<p id="Sec2" class="Heading1">11-2. Creating Tests with the Node.js assert Module<a id="cXXX.624"></a></p>
<div>
<p id="Sec3" class="Heading2_2">Problem</p>
<p class="noindent">You want to utilize Node.jss native assert module to test your Node.js application.</p>
</div>
<div>
<p id="Sec4" class="Heading2"> Solution</p>
<p class="noindent">There are many options for creating basic tests in Node.js. The basis for many tests derives from the Node.js assert module. This module is used internally for Node.js testing and is a good model for TDD.</p>
<p class="indent"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list1" id="_list1">Listing 11-1</a> shows you how to implement a basic set of tests with the Node.js assert module.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list1" id="list1">Listing 11-1</a></i></b>.&nbsp;&nbsp;Node.js assert Basics</p>
<pre><span class="FontName1">var assert = require('assert');</span><br>&nbsp;<br><span class="FontName1">/*11-2*/</span><br><span class="FontName1">var three = 3;</span><br>&nbsp;<br><span class="FontName1">assert.equal(three, '3', '3 equals "3"');</span><br>&nbsp;<br><span class="FontName1">assert.strictEqual('3', three.toString(), '3 and "3" are not strictly equal');</span><br>&nbsp;<br><span class="FontName1">assert.notEqual(three, 'three', '3 not equals three');</span><br>&nbsp;<br><span class="FontName1">// assert.ok(false, 'not truthy ');</span><br><span class="FontName1">assert.ok(true, 'truthy');</span><br>&nbsp;</pre>
<p class="indent">The Node.js assert module can also be utilized to test asynchronous code, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list2" id="_list2">Listing 11-2</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list2" id="list2">Listing 11-2</a></i></b>.&nbsp;&nbsp;Testing Function to Square a Number Asynchronously</p>
<pre><span class="FontName1">var squareAsync = function(a, cb) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">result = a * a;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">cb(result);</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">var assert = require(assert);</span><br>&nbsp;<br><span class="FontName1">squareAsync(three, function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">assert.equal(result, 9, '3 squared is nine');</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">squareAsync('three', function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">assert.ok(isNaN(result), '"Three squared is NaN');</span><br><span class="FontName1">});</span></pre>
<p class="indent">Normally in Node.js, you create code that is asynchronous as you saw above. However, there are times when you may have some code of a synchronous nature that you would like to test. You can test synchronous code with the assert module by following the example shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list3" id="_list3">Listing 11-3</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list3" id="list3">Listing 11-3</a></i></b>.&nbsp;&nbsp;Synchronous with Node.js assert</p>
<pre><span class="FontName1">var square = function(a) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (typeof a !== 'number') return false;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return a * a;</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">var assert = require('assert');</span><br>&nbsp;<br><span class="FontName1">assert.equal(square(three), 9, '3 squared equals 9');</span><br>&nbsp;<br><span class="FontName1">assert.equal(square('three'), false, 'should fail because "three" is not a number');</span></pre>
</div>
<div>
<p id="Sec5" class="Heading2">How It Works</p>
<p class="noindent">The Node.js assert testing module, imported using require(assert), is utilized for internal Node.js tests and has become the basis for many third-party testing implementations. The assert module is created in such a way that if a particular condition is not met for your testing needs, it will throw an assertion error. If all passes, the Node.js process will exit as expected.</p>
<p class="indent">In this solution you saw that you can validate truthy or falsey values, equality, and nonequality by using a smaller portion of the assert modules application programming interface (API)<a id="cXXX.625"></a>. The full listing of what the API is capable of asserting is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#Tab1" id="_Tab1">Table 11-1</a>.</p>
<div class="Table">
<p class="TabCapt">
<span class="CaptNr">
<a id="Tab1" href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_Tab1">Table 11-1</a>. </span>API<a id="cXXX.647"></a> Methods for the assert Module </p>
<table>
<thead>
<tr class="header">
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td> assert.deepEqual(actual, expected, message)</td>
<td> Tests for deep equality. This tests beyond the === operator and checks dates, regular expressions, objects, and buffers in the comparison.</td>
</tr>
<tr>
<td> assert.doesNotThrow(block, [error], [message])</td>
<td> Expects that the provided code block will not throw an error.</td>
</tr>
<tr>
<td> assert.equal(actual, expected, message)</td>
<td> Tests to see if the actual value is equal to the expected value by using the == operator.</td>
</tr>
<tr>
<td> assert.fail(actual, expected, message, operator)</td>
<td> Throws an assertion exception by showing the message and the actual and expected values separated by the operator.</td>
</tr>
<tr>
<td> assert.ifError(value)</td>
<td> Tests to see if the value is not false, and throws an assertion exception if it is. This is used to test if an error argument is provided by a callback.</td>
</tr>
<tr>
<td> assert.notDeepEqual(actual, expected, message)</td>
<td> Tests for deep nonequality. This tests beyond the !== operator and checks dates, regular expressions, objects, and buffers in the comparison.</td>
</tr>
<tr>
<td> assert.notEqual(actual, expected, message)</td>
<td> Tests to see that the actual value is not equal to the expected value by using the != operator.</td>
</tr>
<tr>
<td> assert.notStrictEqual(actual, expected, message)</td>
<td> Same as .notEqual with the exception that this compares the values with the !== operator.</td>
</tr>
<tr>
<td> assert.ok(value, message)</td>
<td> Tests to see if the value passed is a truthy value. If not, the message will be logged with the assertion exception.</td>
</tr>
<tr>
<td> assert.strictEqual(actual, expected, message)</td>
<td> Same as .equal with the exception that this compares the values by using the === operator.</td>
</tr>
<tr>
<td> assert.throws(block, [error], [message])</td>
<td> Expects the provided block to throw an error.</td>
</tr>
</tbody>
</table>
</div>
</div>
<p id="Sec6" class="Heading1">11-3. Creating Tests with Nodeunit</p>
<div>
<p id="Sec7" class="Heading2_2">Problem</p>
<p class="noindent">You want to utilize the nodeunit unit-testing module to test your Node.js application.</p>
</div>
<div>
<p id="Sec8" class="Heading2">Solution</p>
<p class="noindent">The nodeunit testing module builds off of the assert modules API and is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list4" id="_list4">Listing 11-4</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list4" id="list4">Listing 11-4</a></i></b>.&nbsp;&nbsp;Using nodeunit<a id="cXXX.626"></a> for Testing</p>
<pre><span class="FontName1">var test = require('nodeunit');</span><br>&nbsp;<br><span class="FontName1">module.exports = {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">'11-2': {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">'equal': function(test) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">test.equal(3, '3', '3 equals "3"');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">test.done();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">},</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">'strictEqual': function(test) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">test.strictEqual('3', 3, '3 and "3" are not strictly equal');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">test.done();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">},</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">'notEqual' : function(test) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">test.notEqual(3, 'three', '3 not equals three');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">test.done();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">},</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">'ok' : function(test) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">test.ok(false, 'not truthy ');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">test.done();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">};</span></pre>
<p class="indent"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list5" id="_list5">Listing 11-5</a> demonstrates the solution for utilizing the nodeunit testing framework for creating tests of asynchronous methods<a id="cXXX.627"></a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list5" id="list5">Listing 11-5</a></i></b>.&nbsp;&nbsp;Nodeunit Asynchronous Test</p>
<pre><span class="FontName1">var squareAsync = function(a, cb) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">result = a * a;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">cb(result);</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">module.exports = {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">'11-4': {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">'squareAsync': function(test) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">test.expect(2);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">squareAsync(three, function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">test.equal(result, 9, 'three squared is nine');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">squareAsync('three', function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">test.ok(isNaN(result), 'squaring a string returns NaN');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">test.done();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">};</span></pre>
<p class="indent">Nodeunit also allows for synchronous testing (shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list6" id="_list6">Listing 11-6</a>).</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list6" id="list6">Listing 11-6</a></i></b>.&nbsp;&nbsp;Nodeunit Synchronous Test<a id="cXXX.628"></a></p>
<pre><span class="FontName1">var square = function(a) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (typeof a !== 'number') return false;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return a * a;</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">var test = require('nodeunit');</span><br><span class="FontName1">module.exports = {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">'11-3': {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">'squareSync': function(test) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">test.equal(square(three), 9, 'three squared is nine');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">test.equal(square('three'), false, 'cannot square a non number');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">test.done();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">};</span></pre>
</div>
<div>
<p id="Sec9" class="Heading2">How It Works</p>
<p class="noindent">Nodeunit provides the same API as the assert module with the addition of two methods. First, add the .done() method<a id="cXXX.629"></a>, which tells nodeunit that you have finished that test and it is time to move on to the next one. The second addition that nodeunit brings is the .expect(amount) method. This method allows you to instruct nodeunit as to how many tests you plan to implement and to ensure that all tests have executed. If you had instructed nodeunit to run two tests using expect(2), and only ran one, the tests will fail with the message: <span class="FontName1">Error: Expected 2 assertions, 1 ran.</span> You will see in the next section that being able to use the expect() and done() methods<a id="cXXX.630"></a> allows for a great way to test asynchronous code.</p>
<p class="indent">To implement a test with nodeunit you need to export the tests from a module. As you saw previously you first require the nodeunit module and then export your tests. The format of this export can help you to group your tests. You can see in the solution that you grouped all the tests for this section under the 11-2 heading. You then created each test separately, calling the assertions for each test, then calling <span class="FontName1">test.done()</span>.</p>
<p class="indent">To call a nodeunit test, you must first install nodeunit with <span class="FontName1">npm install g nodeunit</span>. Then target the module you wish to test. If you used a file named nodeunit.js, you would call <span class="FontName1">$ nodeunit nodeunit.js</span> and the tests would execute and produce a result similar to what you see in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list7" id="_list7">Listing 11-7</a>, with checkmarks to indicate passing tests and an X for failures.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list7" id="list7">Listing 11-7</a></i></b>.&nbsp;&nbsp;Nodeunit Results</p>
<pre><span class="FontName1">nodeunit.js</span><br> <span class="FontName1">11-2 - equal</span><br> <span class="FontName1">11-2 - strictEqual</span><br> <span class="FontName1">11-2 - notEqual</span><br> <span class="FontName1">11-2  ok</span></pre>
</div>
<p id="Sec10" class="Heading1">11-4. Creating Tests with Mocha</p>
<div>
<p id="Sec11" class="Heading2_2">Problem</p>
<p class="noindent">You need to utilize Mocha to create tests for your Node.js application.</p>
</div>
<div>
<p id="Sec12" class="Heading2">Solution</p>
<p class="noindent">A prominent framework<a id="cXXX.631"></a> for writing Node.js tests is Mocha<a id="cXXX.286d"></a>. An example of how it can be used is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list8" id="_list8">Listing 11-8</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list8" id="list8">Listing 11-8</a></i></b>.&nbsp;&nbsp;Using the Mocha Framework</p>
<pre><span class="FontName1">var assert = require('assert');</span><br>&nbsp;<br><span class="FontName1">var three = 3;</span><br><span class="FontName1">describe('11-2', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">describe('#equal', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">it('should return true that 3 equals "3"', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">assert.equal(three, '3', '3 equals "3"');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">})</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">})</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">describe("#strictEqual", function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">it('"3" only strictly equals 3.toString()', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">assert.strictEqual('3', three.toString(), '3 and "3" are not strictly equal');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">})</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">})</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">describe("#notEqual", function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">it('should be that 3 is not equal to three', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">assert.notEqual(three, 'three', '3 not equals three');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">})</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">})</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">describe("#ok", function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">it('should return that false is not truthy', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">assert.ok(false, 'not truthy ');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">})</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">})</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">describe("#ok", function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">it('should be true that true is truthy', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">assert.ok(true, 'truthy');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">})</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">})</span><br><span class="FontName1">});</span></pre>
<p class="indent">Mocha can also test asynchronous code<a id="cXXX.632"></a>, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list9" id="_list9">Listing 11-9</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list9" id="list9">Listing 11-9</a></i></b>.&nbsp;&nbsp;Mocha Asynchronous Tests</p>
<pre><span class="FontName1">var squareAsync = function(a, cb) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">result = a * a;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">cb(result);</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">squareAsync(three, function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">result.should.equal(9, 'three squared is nine');</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">squareAsync('three', function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// NaN !== NaN</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">result.should.not.equal(result);</span><br><span class="FontName1">});</span></pre>
<p class="indent">On occasion, you will want to test code that has been written synchronously. Mocha can test code like this, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list10" id="_list10">Listing 11-10</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list10" id="list10">Listing 11-10</a></i></b>.&nbsp;&nbsp;Mocha Synchronous Test<a id="cXXX.633"></a></p>
<pre><span class="FontName1">var square = function(a) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (typeof a !== 'number') return false;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return a * a;</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">describe('11-3 sync', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">describe('square a number', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">it('should do this syncronously', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">square(three).should.equal(9);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">it('should fail when the target is not a number', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">square('three').should.be.false;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">});</span></pre>
</div>
<div>
<p id="Sec13" class="Heading2">How It Works</p>
<p class="noindent">Mocha is a testing framework that can utilize any assertion module that you choose. For this example you utilized the Node.js assert module to manage your simple assertions. However, in order for these assertions to work, you had to wrap your assertions in a Mocha-specific description. This allows you to name your test suite and specific case in order to see the desired output from your tests.</p>
<p class="indent">The way in which you create a description for your tests is to wrap them in the function describe. This function will take a name and a callback function. A test suite nests the individual test cases inside of its callback. In general this should look like the example shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list11" id="_list11">Listing 11-11</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list11" id="list11">Listing 11-11</a></i></b>.&nbsp;&nbsp;Building a Test Suite with Mocha</p>
<pre><span class="FontName1">describe(Test suite, function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">describe(test-case, function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// tests go here</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">});</span></pre>
<p class="indent">A test in Mocha can contain a description of what the expected outcome is to be, which is used when you encounter an assertion error. The syntax reads almost like a sentence, as you see in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list12" id="_list12">Listing 11-12</a>, where you describe what the test should result to, and the test itself is contained within the callback. The test description<a id="cXXX.634"></a> will only appear if the test fails.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list12" id="list12">Listing 11-12</a></i></b>.&nbsp;&nbsp;Test Failure Description</p>
<pre><span class="FontName1">it('should return true that 3 equals "3"', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">assert.equal(three, '3', '3 equals "3"');</span><br><span class="FontName1">});</span></pre>
<p class="indent">There are two main ways in which you can tell Mocha to perform its tests once you have installed Mocha globally via <span class="FontName1">$ npm install g mocha</span>. Mocha can be called on a file directly, by calling <span class="FontName1">$ mocha filename.js</span>. This is valuable if you are testing an individual test file, but if you want to test more than one you simply can create a test/ directory and move your Mocha test files into that directory. Once you have done this, simply call <span class="FontName1">$ mocha</span>, and it will find that directory and traverse it, executing the tests as they are encountered.</p>
</div>
<p id="Sec14" class="Heading1">11-5. Creating Tests with Chai.js<a id="cXXX.288u"></a></p>
<div>
<p id="Sec15" class="Heading2_2">Problem</p>
<p class="noindent">You want to create tests with the Chai.js testing framework.</p>
</div>
<div>
<p id="Sec16" class="Heading2">Solution</p>
<p class="noindent">Another example of a testing framework that incorporates the Node.js assert modules API is the Chai.js testing framework. An example of the same basic testing structure<a id="cXXX.635"></a> is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list13" id="_list13">Listing 11-13</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list13" id="list13">Listing 11-13</a></i></b>.&nbsp;&nbsp;Testing with Chai.js</p>
<pre><span class="FontName1">/**</span><br><span class="FontName1">* chaijs</span><br><span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var chai = require('chai');</span><br>&nbsp;<br><span class="FontName1">/* 11-2 simple */</span><br><span class="FontName1">var assert = chai.assert;</span><br><span class="FontName1">var three = 3;</span><br>&nbsp;<br><span class="FontName1">assert.equal(three, '3', '3 equals "3"');</span><br>&nbsp;<br><span class="FontName1">assert.strictEqual('3', three.toString(), '3 and "3" are not strictly equal');</span><br>&nbsp;<br><span class="FontName1">assert.notEqual(three, 'three', '3 not equals three');</span><br>&nbsp;<br><span class="FontName1">assert.ok(true, 'truthy');</span><br>&nbsp;<br><span class="FontName1">//assert.isFalse(true, 'true is false');</span><br>&nbsp;<br><span class="FontName1">var expect = chai.expect;</span><br>&nbsp;<br><span class="FontName1">expect(three).to.be.a('number');</span><br>&nbsp;<br><span class="FontName1">var should = chai.should();</span><br>&nbsp;<br><span class="FontName1">three.should.be.a('number');</span></pre>
<p class="indent">Next, you can create asynchronous tests with the Chai.js framework. These are shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list14" id="_list14">Listing 11-14</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list14" id="list14">Listing 11-14</a></i></b>.&nbsp;&nbsp;Chai.js Asynchronous Tests<a id="cXXX.636"></a></p>
<pre><span class="FontName1">var squareAsync = function(a, cb) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">result = a * a;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">cb(result);</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">squareAsync(three, function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">result.should.equal(9, 'three squared is nine');</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">squareAsync('three', function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// NaN !== NaN</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">expect(result).to.not.eql(result);</span><br><span class="FontName1">});</span></pre>
<p class="indent"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list15" id="_list15">Listing 11-15</a> shows how you implement synchronous tests with Chai.js.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list15" id="list15">Listing 11-15</a></i></b>.&nbsp;&nbsp;Chai.js Synchronous Test<a id="cXXX.637"></a></p>
<pre><span class="FontName1">var square = function(a) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (typeof a !== 'number') return false;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return a * a;</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">var chai = require('chai');</span><br>&nbsp;<br><span class="FontName1">var should = chai.should();</span><br>&nbsp;<br><span class="FontName1">square(three).should.equal(9);</span><br>&nbsp;<br><span class="FontName1">square('three').should.be.false;</span></pre>
</div>
<div>
<p id="Sec17" class="Heading2">How It Works</p>
<p class="noindent">Chai.js can be used as a test driver, accompanied by any Node.js assertion module. You begin testing with Chai by installing the Chai.js module and importing it locally. You then can build your assertions in any of the several styles that Chai.js offers.</p>
<p class="indent">There are two methods for BDD-style assertions that Chai.js offers. First is the expect style. The expect style creates a sentence-like structure to describe how you expect your code to be. You can build a statement that looks like the following: <span class="FontName1">expect('cheese').to.be.a('string');</span>. This type of testing will throw assertion errors when you encounter a statement such as <span class="FontName1">expect(3).to.be.a('string'), or expect(3).to.equal(6);</span>.</p>
<p class="indent">The second type of BDD style is should. Should resembles the expect module in many respects, although implementing the should module requires you to execute the should function, <span class="FontName1">chai.should()</span>, instead of a reference to the function as in <span class="FontName1">chai.expect</span>. This is because when you call expect, you invoke the function with the object that you are testing: <span class="FontName1">expect(three)</span>. In should style, you start with the object that you are testing, then describe the behavior that should occur.</p>
<p class="indent">The should and expect styles share the same API, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#Tab2" id="_Tab2">Table 11-2</a>. They also provide a nontesting set of methods that are used to build the sentence-like structure in a chainable way. These methods are to, be, been, is, that, and,&nbsp;&nbsp;have, with, at, of, and some.</p>
<div class="Table">
<p class="TabCapt">
<span class="CaptNr">
<a id="Tab2" href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_Tab2">Table 11-2</a>. </span>API Methods for should and expect Modules<a id="cXXX.638"></a></p>
<table>
<thead>
<tr class="header">
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td> .above(value)</td>
<td> Asserts that the target is greater than the value.</td>
</tr>
<tr>
<td> .arguments</td>
<td> The target must be an arguments object.</td>
</tr>
<tr>
<td> .a(type)</td>
<td> Determines that the preceding object should be of the type type.</td>
</tr>
<tr>
<td> .below(value)</td>
<td> The target is less than the value.</td>
</tr>
<tr>
<td> .closeTo(expected, delta)</td>
<td> The target value is within a given expected value plus or minus a delta.</td>
</tr>
<tr>
<td> .contain(value)</td>
<td> Asserts that the preceding contain the value given, that is, expect(cheese).to.contain(he).</td>
</tr>
<tr>
<td> .deep</td>
<td> This should be used with a following equal or property method. Will perform a deep equal check on the assertion.</td>
</tr>
<tr>
<td> .empty</td>
<td> Asserts that the target has length 0, or there are no enumerable keys in an object.</td>
</tr>
<tr>
<td> .eql(value)</td>
<td> The target must be deep equal.</td>
</tr>
<tr>
<td> .equal(value)</td>
<td> The target must be strict equal. If the deep method precedes it, this performs a deep equal check.</td>
</tr>
<tr>
<td> .exist</td>
<td> The target must not be null or undefined.</td>
</tr>
<tr>
<td> .false</td>
<td> The target must be false.</td>
</tr>
<tr>
<td> .include(value)</td>
<td> Asserts that the preceding includes the value given, i that is, expect([1,2,4]).to.include(2);.</td>
</tr>
<tr>
<td> .instanceof(constructor)</td>
<td> The target must be an instance of the constructor.</td>
</tr>
<tr>
<td> .itself</td>
<td> Sets the itself flag to be later used by the respondTo method.</td>
</tr>
<tr>
<td> .keys(key1, [key2],,[keyN])</td>
<td> The target contains exactly the provided keys.</td>
</tr>
<tr>
<td> .least(value)</td>
<td> The target must be greater than or equal to the value, ..is.at.least(value).</td>
</tr>
<tr>
<td> .length(value)</td>
<td> The target must have length of value.</td>
</tr>
<tr>
<td> .match(regex)</td>
<td> The target matches the regular expression.</td>
</tr>
<tr>
<td> .members(set)</td>
<td> The target has the same members of set, or is a superset of the set.</td>
</tr>
<tr>
<td> .most(value)</td>
<td> The target is less than or equal to the value.</td>
</tr>
<tr>
<td> .not</td>
<td> Negates any assertions that follow in the chain.</td>
</tr>
<tr>
<td> .null</td>
<td> The target must be null.</td>
</tr>
<tr>
<td> .ok</td>
<td> Ensures that the target is truthy.</td>
</tr>
<tr>
<td> .ownProperty(name)</td>
<td> The target will have its own property name.</td>
</tr>
<tr>
<td> .property(name, [value])</td>
<td> The target will have the property name, and optionally the value must match.</td>
</tr>
<tr>
<td> .respondTo(method)</td>
<td> The target will respond to the method.</td>
</tr>
<tr>
<td> .satisfy(method)</td>
<td> The target passes the given truth test.</td>
</tr>
<tr>
<td> .string(string)</td>
<td> The string target must contain the string.</td>
</tr>
<tr>
<td> .throw(constructor)</td>
<td> The function target should throw an exception.</td>
</tr>
<tr>
<td> .true</td>
<td> The target must be true.</td>
</tr>
<tr>
<td> .undefined</td>
<td> The target must be undefined.</td>
</tr>
<tr>
<td> .within(start, finish)</td>
<td> The target must fall between the start and finish range.</td>
</tr>
</tbody>
</table>
</div>
<p class="indent">Also in this example was the classic TDD style that is used in the Chai.js assert module<a id="cXXX.639"></a>. This module resembles the Node.js assert module, but it incorporates even more methods to the assert API, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#Tab3" id="_Tab3">Table 11-3</a>.</p>
<div class="Table">
<p class="TabCapt">
<span class="CaptNr">
<a id="Tab3" href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_Tab3">Table 11-3</a>. </span>Chai.js assert </p>
<table>
<thead>
<tr class="header">
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td> .closeTo(actual, expected, delta, [message])</td>
<td> The actual value will be within the delta of the expected.</td>
</tr>
<tr>
<td> .deepEqual(actual, expected, [message])</td>
<td> The actual value must be deep equal to the expected.</td>
</tr>
<tr>
<td> .deepProperty(object, property, [message])</td>
<td> The object must contain the property and can be deeply nested.</td>
</tr>
<tr>
<td> .deepPropertyNotVal(object, property, value, [message])</td>
<td> The object must contain the deep property but the value is not the value.</td>
</tr>
<tr>
<td> .deepPropertyVal(object, property, value, [message])</td>
<td> The object must contain the deep property with the value.</td>
</tr>
<tr>
<td> .doesNotThrow(function, [constructor/regexp], [message])</td>
<td> The function will not error as an instance of constructor or matching the regular expression.</td>
</tr>
<tr>
<td> .equal(actual, expected, [message])</td>
<td> The actual value must be nonstrict equal (==) to the expected.</td>
</tr>
<tr>
<td> .fail(actual, expected, [message], [operator])</td>
<td> Throws a failure.</td>
</tr>
<tr>
<td> .include(haystack, needle, [message])</td>
<td> The haystack contains a needle. This can be used for strings (contains) or arrays.</td>
</tr>
<tr>
<td> .includeMembers(superset, subset, [message])</td>
<td> The subset must be included in the superset.</td>
</tr>
<tr>
<td> .instanceOf(object, constructor, [message])</td>
<td> The object must be an instance of the constructor.</td>
</tr>
<tr>
<td> .isArray(value, [message])</td>
<td> The value must be an array.</td>
</tr>
<tr>
<td> .isBoolean(value, [message])</td>
<td> The value must be a boolean.</td>
</tr>
<tr>
<td> .isDefined(value, [message])</td>
<td> The value must not be undefined.</td>
</tr>
<tr>
<td> .isFalse(value, [message])</td>
<td> The value must be false.</td>
</tr>
<tr>
<td> .isFunction(value, [message])</td>
<td> The value must be a function.</td>
</tr>
<tr>
<td> .isNotArray(value, [message])</td>
<td> The value must not be an array.</td>
</tr>
<tr>
<td> .isNotBoolean(value, [message])</td>
<td> The value must not be a boolean.</td>
</tr>
<tr>
<td> .isNotFunction(value, [message])</td>
<td> The value must not be a function.</td>
</tr>
<tr>
<td> .isNotNull(value, [message])</td>
<td> The value must not be null.</td>
</tr>
<tr>
<td> .isNotNumber(value, [message])</td>
<td> The value must not be a number.</td>
</tr>
<tr>
<td> .isNotObject(value, [message])</td>
<td> The value must not be an object.</td>
</tr>
<tr>
<td> .isNotString(value, [message])</td>
<td> The value must not be a string.</td>
</tr>
<tr>
<td> .isNull(value, [message])</td>
<td> The value must be null.</td>
</tr>
<tr>
<td> .isNumber(value, [message])</td>
<td> The value must be a number.</td>
</tr>
<tr>
<td> .isObject(value, [message])</td>
<td> The value must be an object.</td>
</tr>
<tr>
<td> .isString(value, [message])</td>
<td> The value must be a string.</td>
</tr>
<tr>
<td> .isTrue(value, [message])</td>
<td> The value must be true.</td>
</tr>
<tr>
<td> .isUndefined(value, [message])</td>
<td> The value must be undefined.</td>
</tr>
<tr>
<td> .lengthOf(object, length, [message])</td>
<td> The object must have the given length.</td>
</tr>
<tr>
<td> .match(value, regexp, [message])</td>
<td> The value must match the regular expression.</td>
</tr>
<tr>
<td> .notDeepEqual(actual, expected, [message])</td>
<td> The actual value must be not deep equal to the expected.</td>
</tr>
<tr>
<td> .notDeepProperty(object, property, [message])</td>
<td> The object must not contain the deep property.</td>
</tr>
<tr>
<td> .notEqual(actual, expected, [message])</td>
<td> The actual value must be nonstrict inequal (!=) to the expected.</td>
</tr>
<tr>
<td> .notIncluded(haystack, needle, [message])</td>
<td> The haystack does not contain a needle.</td>
</tr>
<tr>
<td> .notInstanceOf(object, constructor, [message])</td>
<td> The object must not be an instance of the constructor.</td>
</tr>
<tr>
<td> .notMatch(value, regexp, [message])</td>
<td> The value must not match the regular expression.</td>
</tr>
<tr>
<td> .notOk(object, [message])</td>
<td> The object must not be truthy.</td>
</tr>
<tr>
<td> .notProperty(object, property, [message])</td>
<td> The object must not contain property.</td>
</tr>
<tr>
<td> .notStrictEqual(actual, expected, [message])</td>
<td> The actual value must be strict inequal (!==) to the expected.</td>
</tr>
<tr>
<td> .notTypeOf(value, name, [message])</td>
<td> The value is not a type of name.</td>
</tr>
<tr>
<td> .ok(object, [message])</td>
<td> The object must be truthy.</td>
</tr>
<tr>
<td> .operator(val1, operator, val2, [message])</td>
<td> The val1 will have the relation to val2 that is determined by the operator, that is, operator(3, &gt;, 0).</td>
</tr>
<tr>
<td> .propertyNotVal(object, property, value, [message])</td>
<td> The object must contain the property but the value is not the value.</td>
</tr>
<tr>
<td> .property(object, property, [message])</td>
<td> The object must contain the property.</td>
</tr>
<tr>
<td> .propertyVal(object, property, value, [message])</td>
<td> The object must contain the property with the value.</td>
</tr>
<tr>
<td> .sameMembers(set1, set2, [message])</td>
<td> Set1 and set2 must have the same members.</td>
</tr>
<tr>
<td> .strictEqual(actual, expected, [message])</td>
<td> The actual value must be strict equal (===) to the expected.</td>
</tr>
<tr>
<td> .throws(function, [constructor/string/regexp], [string/regexp], [message])</td>
<td> The function will error as an instance of the constructor, or it will throw an error with a matching regexp/string.</td>
</tr>
<tr>
<td> .typeOf(value, name, [message])</td>
<td> The value must be of the type name.</td>
</tr>
</tbody>
</table>
</div>
</div>
<p id="Sec18" class="Heading1">11-6. Creating Tests with Vows<a id="cXXX.294h"></a></p>
<div>
<p id="Sec19" class="Heading2_2">Problem</p>
<p class="noindent">You need to create tests for your Node.js application by using the Vows testing framework.</p>
</div>
<div>
<p id="Sec20" class="Heading2">Solution</p>
<p class="noindent">Vows is a popular testing framework that is popular with Node.js developers because it works great with Node.jss asynchronous<a id="cXXX.640"></a> nature. You can see the basic solution for using this framework in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list16" id="_list16">Listing 11-16</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list16" id="list16">Listing 11-16</a></i></b>.&nbsp;&nbsp;Using Vows.js for Testing</p>
<pre><span class="FontName1">var vows = require('vows'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">assert = require('assert');</span><br>&nbsp;<br><span class="FontName1">var three = 3;</span><br><span class="FontName1">vows.describe('vows testing').addBatch({</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">'11-2': {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">'basic testing': {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">topic: three,</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">' 3 equals "3"': function(topic) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">assert.equal(three, '3');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">},</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">' 3 and "3" are not strictly equal': function(topic) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">assert.strictEqual('3', three.toString());</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">},</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">' 3 notEqual "three"' : function(topic) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">assert.notEqual(three, 'three');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">},</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">' false is truthy? ' : function(topic) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">assert.ok(false);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">},</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">' true is truthy? ' : function(topic) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">assert.ok(true);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">}).export(module);</span></pre>
<p class="noindent2"><b><i>Listing 11-17</i></b>.&nbsp;&nbsp;Vows.js Synchronous Tests<a id="cXXX.641"></a></p>
<pre><span class="FontName1">var square = function(a) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (typeof a !== 'number') return false;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return a * a;</span><br><span class="FontName1">};</span><br>&nbsp;<br>&nbsp;<br><span class="FontName1">var vows = require('vows'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">assert = require('assert');</span><br>&nbsp;<br><span class="FontName1">vows.describe('vows testing').addBatch({</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">'11-3': {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">'sync': {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">topic: function(a) { return 3 * 3; },</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">'squared': function(topic) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">assert.equal(topic, 9);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">});</span></pre>
</div>
<div>
<p id="Sec21" class="Heading2">How It Works</p>
<p class="noindent">Vows is arguably the greatest departure in style from the previous testing frameworks. Vows is a testing framework that is built for testing asynchronous code, and therefore it is a great fit for Node.js.</p>
<p class="indent">In Vows, and in your solution using Vows, you begin by describing a test suite. In our case this was the vows testing suite created with calling <span class="FontName1">vows.describe(&lt;suite name&gt;)</span>. You then group a set of tests in a batch and add that to the suite by calling the .<span class="FontName1">addBatch()</span> method<a id="cXXX.642"></a>, which accepts an object literal: the test batch.</p>
<p class="indent">The batches are then divided into groups; in this case, the 11-2 group was created and further subdivided with basic testing. Next, you break up your tests into individual topics. Here you deal with the variable three, which points to the value 3. Within the topic, you build your tests, first describing the outcome you wish to see, then executing the test by passing the topic to the callback function. Within this callback you utilize the Node.js assert module in order to validate your tests. The output<a id="cXXX.643"></a> of your tests from this solution using Vows can be generated in two ways, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list18" id="_list18">Listing 11-18</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list18" id="list18">Listing 11-18</a></i></b>.&nbsp;&nbsp;Vows Output Options</p>
<pre><span class="FontName1">$ vows vows.js</span><br><span class="FontName1">?</span><br>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">11-2 basic testing</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">?&nbsp;&nbsp;false is truthy?</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1"> expected expression to evaluate to true, but was false // vows.js:24</span><br>&nbsp;&nbsp;<span class="FontName1">? Broken  4 honored  1 broken</span><br>&nbsp;<br><span class="FontName1">$ vows vows.js --spec</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">? vows testing</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">11-2 basic testing</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&nbsp;&nbsp;3 equals "3"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&nbsp;&nbsp;3 and "3" are not strictly equal</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&nbsp;&nbsp;3 notEqual "three"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">?&nbsp;&nbsp;false is truthy?</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1"> expected expression to evaluate to true, but was false // vows.js:24</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&nbsp;&nbsp;true is truthy?</span><br>&nbsp;<br><span class="FontName1">? Broken  4 honored  1 broken</span></pre>
<p class="indent">Simply calling the Vows method will run the tests, but by adding the --spec parameter to the call, you are able to get a more verbose output of the results. It will then print the number of vows that were honored: tests passed, or broken, meaning failed tests.</p>
<p class="indent">Setting up tests with any of these frameworks should not be a limitation in your Node.js development. These frameworks should become a part of your development cycle and can allow you to build a more proven and sound Node.js application. In the coming sections you will see how to test for certain points of synchronous methods, and more commonly how to fit these testing frameworks into your asynchronous applications build with Node.js.</p>
</div>
<p id="Sec22" class="Heading1">11-7. Creating Tests with Should.js</p>
<div>
<p id="Sec23" class="Heading2_2">Problem</p>
<p class="noindent">You have created a Node.js application that you need to create tests for by using the Should.js framework.</p>
</div>
<div>
<p id="Sec24" class="Heading2">Solution</p>
<p class="noindent">Should.js is a testing framework that uses a very friendly and chainable BDD syntax for testing. A basic example using Should.js is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list19" id="_list19">Listing 11-19</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list19" id="list19">Listing 11-19</a></i></b>.&nbsp;&nbsp;Using Should.js<a id="cXXX.644"></a></p>
<pre><span class="FontName1">var should = require('should');</span><br><span class="FontName1">var three = 3;</span><br>&nbsp;<br><span class="FontName1">should.equal(three, '3', '3 equals "3"');</span><br>&nbsp;<br><span class="FontName1">should.strictEqual('3', three.toString(), '3 and "3" are not strictly equal');</span><br>&nbsp;<br><span class="FontName1">should.notEqual(three, 'three', '3 not equals three');</span><br>&nbsp;<br><span class="FontName1">true.should.be.ok;</span><br><span class="FontName1">false.should.not.be.ok;</span><br>&nbsp;<br><span class="FontName1">three.should.be.a('number');</span></pre>
<p class="indent">Should.js can also be utilized for asynchronous and synchronous tests, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list20" id="_list20">Listings 11-20</a> and <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list21" id="_list21">11-21</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list20" id="list20">Listing 11-20</a></i></b>.&nbsp;&nbsp;Should.js Asynchronous Tests<a id="cXXX.645"></a></p>
<pre><span class="FontName1">var squareAsync = function(a, cb) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">result = a * a;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">cb(result);</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">squareAsync(three, function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">result.should.equal(9, 'three squared is nine');</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">squareAsync('three', function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// NaN !== NaN</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">result.should.not.equal(result);</span><br><span class="FontName1">});</span></pre>
<p class="noindent2"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list21" id="list21"><b><i>Listing 11-21</i></b></a>.&nbsp;&nbsp;Should.js Synchronous Tests<a id="cXXX.646"></a></p>
<pre><span class="FontName1">var square = function(a) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (typeof a !== 'number') return false;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return a * a;</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">var should = require('should');</span><br>&nbsp;&nbsp;<br><span class="FontName1">square(three).should.equal(9);</span><br>&nbsp;<br><span class="FontName1">square('three').should.be.false;</span></pre>
</div>
<div>
<p id="Sec25" class="Heading2">How It Works</p>
<p class="noindent">When you begin to test with Should.js, you note that it begins as an extension of the Node.js assert module. This means that you are able to implement all of the items of the assert API just as you would normally. Should.js also expands this module to include a method named .<span class="FontName1">exists()</span> that is the same as <span class="FontName1">.ok()</span>.</p>
<p class="indent">Should.js, like the Chai.js should style, allows the chaining of tests. This not only helps to better describe the behavior, but also allows the testing framework to become a self-documenting piece of code. The chainable syntax allows chaining methods like an, and, be, have, and with. These methods do not actually manipulate the tests but are convenient for chaining and readability. The API for Should.js contains the methods that are shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#Tab4" id="_Tab4">Table 11-4</a>.</p>
<div class="Table">
<p class="TabCapt">
<span class="CaptNr">
<a id="Tab4" href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_Tab4">Table 11-4</a>. </span>Should.js API </p>
<table>
<thead>
<tr class="header">
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td> .a</td>
<td> The target should be of the type declared.</td>
</tr>
<tr>
<td> .above</td>
<td> The target must have a numeric value above the expected.</td>
</tr>
<tr>
<td> .arguments</td>
<td> The target is an arguments array-like object.</td>
</tr>
<tr>
<td> .below</td>
<td> The target must have a numeric value below the expected.</td>
</tr>
<tr>
<td> .empty</td>
<td> The target must have length 0.</td>
</tr>
<tr>
<td> .eql</td>
<td> Checks for equality.</td>
</tr>
<tr>
<td> .equal</td>
<td> Is of strict equality.</td>
</tr>
<tr>
<td> .false</td>
<td> The target must === false.</td>
</tr>
<tr>
<td> .header(field, [value])</td>
<td> The target must be the specified field with an optional value equality check.</td>
</tr>
<tr>
<td> .html</td>
<td> The target must be text/html, charset=utf-8.</td>
</tr>
<tr>
<td> .includeEql(obj)</td>
<td> The object obj must be present and equal.</td>
</tr>
<tr>
<td> .include(obj)</td>
<td> The obj object must be present in the indexOf. Works for strings, arrays, and objects.</td>
</tr>
<tr>
<td> .instanceOf</td>
<td> The target should be an instance of the declared.</td>
</tr>
<tr>
<td> .json</td>
<td> The target must be application/json, charset=utf-8.</td>
</tr>
<tr>
<td> .keys</td>
<td> The target must have the keys specified.</td>
</tr>
<tr>
<td> .length</td>
<td> The target must be of the length specified.</td>
</tr>
<tr>
<td> .match</td>
<td> The target must match the regular expression.</td>
</tr>
<tr>
<td> .ok</td>
<td> The target must be truthy.</td>
</tr>
<tr>
<td> .ownProperty</td>
<td> The target must have its own property specified.</td>
</tr>
<tr>
<td> .property</td>
<td> The target must contain the property specified.</td>
</tr>
<tr>
<td> .status(code)</td>
<td> The target statusCode must be that specified.</td>
</tr>
<tr>
<td> .throw and .throwError</td>
<td> Ensures that an exception is thrown. throwError is to be used if your JavaScript Linter does not parse kindly the .throw nomenclature.</td>
</tr>
<tr>
<td> .true</td>
<td> The target must === true.</td>
</tr>
<tr>
<td> .within</td>
<td> The target should be within a numeric range.</td>
</tr>
</tbody>
</table>
</div>
<p class="indent">You can see that this API is similar to the should and expect API that the Chai.js framework uses. This is because the chaining syntax of this type of testing lends to many of these features being present in the API.</p>
<p class="indent">In <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list6">Listing 11-6</a>, you built some simple tests using the assert module syntax. You then stepped into the BDD model by using the chainable Should.js syntax: <span class="FontName1">true.should.be.ok;</span>, was an example of this.</p>
</div>
<p id="Sec26" class="Heading1">11-8. Reporting Code Coverage with Node-cover</p>
<div>
<p id="Sec27" class="Heading2_2">Problem</p>
<p class="noindent">You have built some tests for your Node.js application. Now you would like to analyze whether the code that you have written will be covered in full by using the node-cover <a id="cXXX.298b"></a>.</p>
</div>
<div>
<p id="Sec28" class="Heading2"> Solution</p>
<p class="noindent">There are several libraries that are available to use for reporting code coverage in your Node.js application. For this solution you will examine one of these: node-cover. This library can be installed globally by using npm: <span class="FontName1">$ npm install cover g</span>. Once you have it installed, you will then be able to run coverage tests and reports on your Node.js application.</p>
<p class="indent">For this section you will create a simple Node.js application that will purposefully test your code coverage<a id="cXXX.648"></a> and that will help to highlight the strengths of the Node.js coverage libraries. This example code is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list22" id="_list22">Listing 11-22</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list22" id="list22">Listing 11-22</a></i></b>.&nbsp;&nbsp;Code Coverage Example App</p>
<pre><span class="FontName1">/**</span><br><span class="FontName1">* coverage tests</span><br><span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">function add(a, b, callback) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">callback(a + b);</span><br><span class="FontName1">}</span><br>&nbsp;<br><span class="FontName1">function subtract(a, b, callback) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">callback(a - b);</span><br><span class="FontName1">}</span><br>&nbsp;<br><span class="FontName1">add(2, 3, function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(result);</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">//subtract(3, 2, function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// console.log(result);</span><br><span class="FontName1">// });</span></pre>
<p class="indent">You are now able to begin your code coverage tests for this block of code. To get started, install node-cover first, then run the coverage tests, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list23" id="_list23">Listing 11-23</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list23" id="list23">Listing 11-23</a></i></b>.&nbsp;&nbsp;Installing node-cover and Running a Coverage Test</p>
<pre><span class="FontName1">$ npm install -g cover</span><br>&nbsp;<br><span class="FontName1">$ cover run 11-5-1.js</span></pre>
<p class="indent">You now have successfully executed a coverage test for your code. With node-cover there are two ways in which you can view the report of this coverage. First, <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list24" id="_list24">Listing 11-24</a> shows how to view the coverage directly in your command prompt/terminal<a id="cXXX.649"></a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list24" id="list24">Listing 11-24</a></i></b>.&nbsp;&nbsp;Node-cover Report in the Terminal</p>
<pre><span class="FontName1">&gt; cover run 11-5-1.js</span><br><span class="FontName1">path.existsSync is now called `fs.existsSync`.</span><br><span class="FontName1">5</span></pre>
<p class="indent">Once you have viewed the report in the terminal, you may decide that to better view the results, or to publish them to other parties with vested interest in your coverage, you should view the report in an HTML mode. Node-cover makes reporting in HTML simple, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list25" id="_list25">Listing 11-25</a>. Here, the module will generate a cover-html directory and allow you to navigate to /cover_html/index.html in your browser in order to view the reports shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#Fig1" id="_Fig1">Figures 11-1</a> and <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#Fig2" id="_Fig2">11-2</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list25" id="list25">Listing 11-25</a></i></b>.&nbsp;&nbsp;Reporting node-cover Coverage in HTML<a id="cXXX.650"></a>.</p>
<pre><span class="FontName1">$ cover report html</span></pre>
<p class="indent"> </p>
<div class="Figure" id="Fig1">
<p class="img">
<img src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/9781430260585_Fig11-01.jpg" alt="9781430260585_Fig11-01.jpg" width="937" height="165" data-mfp-src="/library/view/nodejs-recipes-a/9781430260585/images/9781430260585_Fig11-01.jpg"></p>
<p class="FigCapt">
<span class="CaptNr">
<a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_Fig1">Figure 11-1</a>. </span>node_cover index.html </p>
</div>
<div class="Figure" id="Fig2">
<p class="img">
<img src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/9781430260585_Fig11-02.jpg" alt="9781430260585_Fig11-02.jpg" width="825" height="821" data-mfp-src="/library/view/nodejs-recipes-a/9781430260585/images/9781430260585_Fig11-02.jpg"></p>
<p class="FigCapt">
<span class="CaptNr">
<a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_Fig2">Figure 11-2</a>. </span>node_cover detail<a id="cXXX.651"></a></p>
</div>
<div class="notepara">
<p class="paraaftertitle1"><img src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/sq.jpg" alt="image" width="12" height="12" data-mfp-src="/library/view/nodejs-recipes-a/9781430260585/images/sq.jpg">&nbsp;<b>Note</b>&nbsp;&nbsp;Viewing the report in the command prompt, Cygwin, Git Bash, or PowerShell on Windows is cryptic at best due to font-rendering issues. If you know what you are looking for, you can decipher the results, but it is better to view the HTML report or to pass the plain option with <span class="FontName1">$ cover report plain</span>.</p></div>
</div>
<div>
<p id="Sec29" class="Heading2">How It Works</p>
<p class="noindent">Testing for code coverage is important because it can highlight unnecessary or underused code in your application. In this solution you saw how you could leverage the node-cover framework in order to view your code coverage.</p>
<p class="indent">The node-cover framework is installed globally, allowing you to simply use the cover method in your terminal or shell wherever your Node.js application resides and where you wish to run coverage tests. To run a test, use the command <span class="FontName1">$ cover run &lt;file&gt;</span>.</p>
<p class="indent">After running, you now have a reference to the code coverage. To view this access you need to see the results via the command <span class="FontName1">$ cover results [type] [file]</span>. The type can be cli, which is the default and attempts to generate an ASCII graphical layout in your terminal. This works decently in Mac or Linux, but for Windows users the command-line interface (CLI)<a id="cXXX.652"></a> output is nearly impossible to read. Fortunately there are three other options for output. The first is plain, which will just output the line or lines of your code that are not covered. For more graphical reports you can use the html option, which will generate a&nbsp;&nbsp;full report that can be viewed in the browser. Alternatively, if you would like to manage your own implementation, or would like to view the data in a custom reporting service, you could choose the JSON output type for the report. The JSON output contains all of the relevant details for the report and the original source code of the code on which you have executed the coverage test.</p>
</div>
<p id="Sec30" class="Heading1">11-9. Reporting Code Coverage with istanbul</p>
<div>
<p id="Sec31" class="Heading2_2">Problem</p>
<p class="noindent">You want to analyze the coverage of your code by utilizing the istanbul code coverage framework.</p>
</div>
<div>
<p id="Sec32" class="Heading2">Solution</p>
<p class="noindent">There are several libraries that are available for reporting code coverage in your Node.js application. For this solution, you will examine istanbul.</p>
<p class="indent">For this section you will create a simple Node.js application that will purposefully test your code coverage and that will help to highlight the strengths of the Node.js coverage libraries. This example code is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list26" id="_list26">Listing 11-26</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list26" id="list26">Listing 11-26</a></i></b>.&nbsp;&nbsp;Code Coverage Example App<a id="cXXX.653"></a></p>
<pre><span class="FontName1">/**</span><br><span class="FontName1">* coverage tests</span><br><span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">function add(a, b, callback) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">callback(a + b);</span><br><span class="FontName1">}</span><br>&nbsp;<br><span class="FontName1">function subtract(a, b, callback) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">callback(a - b);</span><br><span class="FontName1">}</span><br>&nbsp;<br><span class="FontName1">add(2, 3, function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(result);</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">//subtract(3, 2, function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// console.log(result);</span><br><span class="FontName1">// });</span></pre>
<p class="indent">The code coverage module that you will utilize to show code coverage for this set of code is istanbul. Istanbul is installed globally by using <span class="FontName1">$ npm install</span><a id="cXXX.654"></a>
<span class="FontName1">g istanbul</span>. You can then run coverage tests for your module, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list27" id="_list27">Listing 11-27</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list27" id="list27">Listing 11-27</a></i></b>.&nbsp;&nbsp;Coverage Test with istanbul</p>
<pre><span class="FontName1">$ istanbul cover 11-5-1.js</span><br><span class="FontName1">5</span><br><span class="FontName1">=============================================================================</span><br><span class="FontName1">Writing coverage object [c:\Users\cgackenheimer\Dropbox\book\code\11\coverage\coverage.json]</span><br><span class="FontName1">Writing coverage reports at [c:\Users\cgackenheimer\Dropbox\book\code\11\coverage]</span><br><span class="FontName1">=============================================================================</span><br>&nbsp;<br><span class="FontName1">=============================== Coverage summary ===============================</span><br><span class="FontName1">Statements&nbsp;&nbsp; : 83.33% ( 5/6 )</span><br><span class="FontName1">Branches&nbsp;&nbsp;&nbsp;&nbsp; : 100% ( 0/0 )</span><br><span class="FontName1">Functions&nbsp;&nbsp;&nbsp;&nbsp;: 66.67% ( 2/3 )</span><br><span class="FontName1">Lines&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: 83.33% ( 5/6 )</span><br><span class="FontName1">================================================================================</span></pre>
<p class="indent">Istanbul will automatically generate an HTML report for you. It will place this inside of the coverage directory in a directory named lcov-report<a id="cXXX.655"></a>. The results of the coverage test above can be viewed in a browser. The summary page is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#Fig3" id="_Fig3">Figure 11-3</a> with the coverage detail in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#Fig4" id="_Fig4">Figure 11-4</a>.</p>
<div class="Figure" id="Fig3">
<p class="img">
<img src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/9781430260585_Fig11-03.jpg" alt="9781430260585_Fig11-03.jpg" width="937" height="246" data-mfp-src="/library/view/nodejs-recipes-a/9781430260585/images/9781430260585_Fig11-03.jpg"></p>
<p class="FigCapt">
<span class="CaptNr">
<a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_Fig3">Figure 11-3</a>. </span>istanbul cover summary </p>
</div>
<div class="Figure" id="Fig4">
<p class="img">
<img src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/9781430260585_Fig11-04.jpg" alt="9781430260585_Fig11-04.jpg" width="825" height="531" data-mfp-src="/library/view/nodejs-recipes-a/9781430260585/images/9781430260585_Fig11-04.jpg"></p>
<p class="FigCapt">
<span class="CaptNr">
<a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_Fig4">Figure 11-4</a>. </span>istanbul cover detail<a id="cXXX.656"></a></p>
</div>
</div>
<div>
<p id="Sec33" class="Heading2">How It Works</p>
<p class="noindent">You utilized istanbul as a module to generate code coverage tests. Istanbul is also installed globally for ease of use with the command line throughout your projects. To generate a coverage test with istanbul, simply run <span class="FontName1">$ istanbul cover &lt;file&gt;</span><a id="cXXX.657"></a>. This will run the test coverage for you.</p>
<p class="indent">When you run a coverage test with istanbul, you also get the reports automatically. There is not a secondary step like with node-cover to generate the test results. Running the <span class="FontName1">cover</span> command will also produce a clean summary of the coverage directly in your CLI. It will also produce a JSON output and the HTML. As you saw in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#Fig4">Figure 11-4</a>, the detailed summary of the coverage in HTML will highlight the statements that arent covered in red. The functions that are not covered are highlighted in an orange hue.</p>
<p class="indent">Adding these reports to your testing workflow can be extremely helpful for analyzing your coding, especially if you are adding large modules to your implementation. If you have been in the process of refactoring, you may likely see that there are a great number of gaps in your code coverage. This allows for a more informed form of refactoring your code for the next iteration.</p>
</div>
<p id="Sec34" class="Heading1">11-10. Building a Full Test Suite</p>
<div>
<p id="Sec35" class="Heading2_2">Problem</p>
<p class="noindent">You want to include a set of tests within your application in order to build a robust testing suite<a id="cXXX.658"></a>.</p>
</div>
<div>
<p id="Sec36" class="Heading2">Solution</p>
<p class="noindent">In this solution, you will build a suite of tests to be executed using the Mocha testing framework. To do this, build all your tests into the tests directory. For this example, you can utilize all the tests from the previous sections, breaking them up into a few files (see <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list28" id="_list28">Listings 11-28</a> and <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list29" id="_list29">11-29</a>).</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list28" id="list28">Listing 11-28</a></i></b>.&nbsp;&nbsp;First Test/Mocha.js File</p>
<pre><span class="FontName1">/**</span><br><span class="FontName1">* mocha</span><br><span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var assert = require('assert');</span><br>&nbsp;<br><span class="FontName1">var three = 3;</span><br><span class="FontName1">describe('11-2', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">describe('equal', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">it('should return true that 3 equals "3"', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">assert.equal('three', '3', '3 equals "3"');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">describe("strictEqual", function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">it('"3" only strictly equals 3.toString()', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">assert.strictEqual('3', three.toString(), '3 and "3" are not strictly equal');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">describe("notEqual", function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">it('should be that 3 is not equal to three', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">assert.notEqual(three, 'three', '3 not equals three');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">describe("ok", function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">it('should return that false is not truthy', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">assert.ok(false, 'not truthy ');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">describe("ok", function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">it('should be true that true is truthy', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">assert.ok(true, 'truthy');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">});</span></pre>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list29" id="list29">Listing 11-29</a></i></b>.&nbsp;&nbsp;Second Test/Mocha.2.js</p>
<pre><span class="FontName1">/**</span><br><span class="FontName1">* mocha</span><br><span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var three = 3;</span><br>&nbsp;<br><span class="FontName1">var should = require('should');</span><br>&nbsp;<br><span class="FontName1">var square = function(a) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (typeof a !== 'number') return false;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return a * a;</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">describe('11-3 sync', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">describe('square a number', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">it('should do this syncronously', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">square(three).should.equal(9);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">it('should fail when the target is not a number', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">square('three').should.be.false;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">var squareAsync = function(a, cb) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">result = a * a;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">cb(result);</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">describe('11-4 async', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">describe('square a number', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">it('should perform async', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">squareAsync(three, function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">result.should.equal(9);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">it('should fail', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">squareAsync('three', function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">result.should.not.be.a('number');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">});</span></pre>
</div>
<div>
<p id="Sec37" class="Heading2">How It Works</p>
<p class="noindent">This is a simple test suite, but it shows the power of a tool like Mocha, which allows you to utilize a single command to execute an entire folder of tests.</p>
<p class="indent">When you execute the <span class="FontName1">mocha</span> command, it will look for the files that reside in the test directory and execute the Mocha tests on each one. The <span class="FontName1">mocha</span> command will only execute on files that are formatted for at least one Mocha test. This means that a directory that has a number of files that use only the Node.js assert methods for testing code will still only run the tests for files that contain Mocha tests. The entire file is not required to contain only Mocha tests; in fact only a single <span class="FontName1">mocha describe</span> needs to be present in the file in order to get the Mocha command line to find the file and execute the test, adding the result to the aggregate total.</p>
</div>
<p id="Sec38" class="Heading1">11-11. Implementing Testing into Your Workflow<a id="cXXX.659"></a></p>
<div>
<p id="Sec39" class="Heading2_2">Problem</p>
<p class="noindent">You want to implement testing as a part of your workflow when developing a Node.js application.</p>
</div>
<div>
<p id="Sec40" class="Heading2">Solution</p>
<p class="noindent">Adding testing to your workflow can be done in any number of ways. What is important is that you are able to add tests to your process. One way to implement tests is to simply invoke the test framework of your choosing at each time you create new code for your Node.js application. This can be a manual process or, as you will see in the next section, an automated task.</p>
<p class="indent">Another way you can implement testing is to add a test command to the scripts section in your package.json file, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list30" id="_list30">Listing 11-30</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list30" id="list30">Listing 11-30</a></i></b>.&nbsp;&nbsp;Package.json for npm Test</p>
<pre><span class="FontName1">{</span><br>&nbsp;&nbsp;<span class="FontName1">"name": "Ch11",</span><br>&nbsp;&nbsp;<span class="FontName1">"version": "0.0.0",</span><br>&nbsp;&nbsp;<span class="FontName1">"description": "chapter 11",</span><br>&nbsp;&nbsp;<span class="FontName1">"main": "mocha.js",</span><br>&nbsp;&nbsp;<span class="FontName1">"directories": {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"test": "test"</span><br>&nbsp;&nbsp;<span class="FontName1">},</span><br>&nbsp;&nbsp;<span class="FontName1">"dependencies": {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"chai": "1.7.2",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"nodeunit": "0.8.1",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"should": "1.2.2",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"vows": "0.7.0"</span><br>&nbsp;&nbsp;<span class="FontName1">},</span><br>&nbsp;&nbsp;<span class="FontName1">"devDependencies": {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"mocha": "1.12.0"</span><br>&nbsp;&nbsp;<span class="FontName1">},</span><br>&nbsp;&nbsp;<span class="FontName1">"scripts": {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"test": "mocha"</span><br>&nbsp;&nbsp;<span class="FontName1">},</span><br>&nbsp;&nbsp;<span class="FontName1">"author": "cgack"</span><br><span class="FontName1">}</span></pre>
<p class="indent">Here you would simply invoke <span class="FontName1">$ npm test</span> each time that you want to run your tests. This allows you to have a uniform test call for each module that you wish to test, regardless of the underlying testing infrastructure.</p>
</div>
<div>
<p id="Sec41" class="Heading2">How It Works</p>
<p class="noindent">You saw previously in this chapter how to execute tests using the framework of your choosing, so implementing this into your workflow is straightforward and works just the same as invoking the frameworks.</p>
<p class="indent">Adding the ability to test your modules using <span class="FontName1">npm test</span> is a useful trick. This works because the npm command line has the ability to parse your test directory and use the test script that you have supplied for your npm package.json file that describes your Node.js module.</p>
<p class="indent">There are many ways to implement testing into your workflow, but, as you will see in the next section, automating your testing is the easiest way to ensure that you never miss an opportunity to test your code.</p>
</div>
<p id="Sec42" class="Heading1">11-12. Automating Your&nbsp;&nbsp;Testing</p>
<div>
<p id="Sec43" class="Heading2_2">Problem</p>
<p class="noindent">You need to automate your tests so you can always be assured that your Node.js is tested and passing each time a change is made to your code.</p>
</div>
<div>
<p id="Sec44" class="Heading2">Solution</p>
<p class="noindent">There are a number of ways to automate your testing solution. One of the easiest methods, if you are utilizing Mocha, is to use the Mocha watch functionality<a id="cXXX.660"></a>. To do this, invoke Mocha as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list31" id="_list31">Listing 11-31</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list31" id="list31">Listing 11-31</a></i></b>.&nbsp;&nbsp;Mocha Watch</p>
<pre><span class="FontName1">$ mocha -w</span><br>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">............</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">11 passing (9 ms)</span><br>&nbsp;&nbsp;<span class="FontName1">1 failing</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">1) calc tests simple maths should be easy to subtract:</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">AssertionError: four minus 2 is two</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">at Context.&lt;anonymous&gt; (c:\Users\cgackenheimer\Dropbox\book\code\11\test\calc_test.js:14:11)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">at Test.Runnable.run (c:\Users\cgackenheimer\AppData\Roaming\npm\node_modules\mocha\lib\runnable.js:211:32)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">at Runner.runTest (c:\Users\cgackenheimer\AppData\Roaming\npm\node_modules\mocha\lib\runner.js:355:10)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">at c:\Users\cgackenheimer\AppData\Roaming\npm\node_modules\mocha\lib\runner.js:401:12</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">at next (c:\Users\cgackenheimer\AppData\Roaming\npm\node_modules\mocha\lib\runner.js:281:14)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">at c:\Users\cgackenheimer\AppData\Roaming\npm\node_modules\mocha\lib\runner.js:290:7</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">at next (c:\Users\cgackenheimer\AppData\Roaming\npm\node_modules\mocha\lib\runner.js:234:23)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">at Object._onImmediate (c:\Users\cgackenheimer\AppData\Roaming\npm\node_modules\mocha\lib\runner.js:258:5)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">at processImmediate [as _immediateCallback] (timers.js:330:15)</span><br>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;<span class="FontName1">............</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">12 passing (16 ms)</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">\ watching</span></pre>
<p class="indent">Another test automation method<a id="cXXX.661"></a> is to utilize the Grunt.js task runner to drive tests. One of the more popular integrations with Grunt is the grunt-contrib-nodeunit module. This allows you to group and run all of your nodeunit tests together with a single command.</p>
<p class="indent">To configure the Grunt nodeunit, you need to install the Grunt command line with <span class="FontName1">$ npm install g grunt-cli</span>. You will then install the <span class="FontName1">grunt-contrib-nodeunit</span> module by entering <span class="FontName1">$ npm install grunt-contrib-nodeunit</span>. Next you need to add a reference to Grunt and grunt-contrib-nodeunit to your package.json file. When these dependencies are installed, install Grunt to the project named <span class="FontName1">$ npm install grunt save-dev</span>.</p>
<p class="indent">Now you need to create a Gruntfile.js file that will export the tasks that you desire for Grunt to execute. A simple Grunt file to use for the nodeunit tests that you had previously created would look like the example in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list32" id="_list32">Listing 11-32</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list32" id="list32">Listing 11-32</a></i></b>.&nbsp;&nbsp;Gruntfile.js<a id="cXXX.662"></a> for nodeunit</p>
<pre><span class="FontName1">module.exports = function(grunt) {</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">grunt.initConfig({</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">nodeunit: {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">all: ['nodeunit.js']</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">grunt.loadNpmTasks('grunt-contrib-nodeunit');</span><br><span class="FontName1">};</span></pre>
<p class="indent">You can now execute any nodeunit test by running the <span class="FontName1">grunt nodeunit</span> command<a id="cXXX.663"></a>, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list33" id="_list33">Listing 11-33</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list33" id="list33">Listing 11-33</a></i></b>.&nbsp;&nbsp;Executing grunt nodeunit</p>
<pre><span class="FontName1">$ grunt nodeunit</span><br><span class="FontName1">Running "nodeunit:all" (nodeunit) task</span><br><span class="FontName1">Testing nodeunit.js......OK</span><br><span class="FontName1">&gt;&gt; 8 assertions passed (7ms)</span><br>&nbsp;<br><span class="FontName1">Done, without errors.</span></pre>
</div>
<div>
<p id="Sec45" class="Heading2">How It Works</p>
<p class="noindent">Watching a file with the built-in file watcher for the Mocha command line will run the tests initially, a single time, and then watch the files in the directory for any alterations.</p>
<p class="indent">In this solution, you started by creating a calc.js module (see <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#list34" id="_list34">Listing 11-34</a>) that had erroneously placed a multiplication operator where the subtraction operator was located in the subtract method.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#_list34" id="list34">Listing 11-34</a></i></b>.&nbsp;&nbsp;Erroneous calc.js Module<a id="cXXX.664"></a></p>
<pre><span class="FontName1">/**</span><br><span class="FontName1">* calc</span><br><span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var calc = module.exports = {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">add: function(a, b) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return a + b;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">},</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">subtract: function(a, b) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return a * b;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">};</span></pre>
<p class="indent">You invoked the <span class="FontName1">mocha w</span>, watcher on the tests that you wrote, expecting that the subtraction would work, but they failed on the subtraction test. Watch the files in the directory for changes. You then need to correct the file to properly subtract b from a, and the file watcher picks up the change. Once the file changes, Mocha runs the tests againthis time passingand continues to watch the files for changes. Having this continual feedback on tests is very beneficial, and it can help motivate you to write your tests first.</p>
<p class="indent">You next saw how to integrate nodeunit testing into your testing workflow by automating these tests to the Grunt.js task-runner framework. The key here is that you are able to design your gruntfile.js so that you can cover all the tests in a directory or the tests that fit a certain file structure. In your case you provided a single file; however, the Grunt task configuration for nodeunit can accept a variety of named tests, not just the all seen here, but you could break them down to the submodule as well. The nodeunit configuration also allows for the implementation of wildcards, so that you could target all files in the test directory with test/*.js, or a similar pattern.</p>
<p class="indent">Allowing testing to become a natural and automated part of your Node.js development process can be critical, especially as the scale of your project grows. You have seen two methods for implementing testing automatically, which eases the burden of running tests as your project grows in size.</p>
</div>
</div>
<div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-0" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders ">
		
		<li class="copy"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#">Add Highlight</a></li>
		<li class="add-note"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#">
			
				Add Note
			
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch10.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">CHAPTER 10: Connecting to a Data Store</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch12.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">CHAPTER 12: Debugging and Deploying Your Application</div>
        </a>
    
  
  </div>


        
    </section>
    <div class="reading-controls-bottom">
      <ul class="interface-controls js-bitlist">
        <li class="queue-control">
            <button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9781430260585/chapter/9781430260585_Ch11.xhtml" data-for-analytics="9781430260585:9781430260585_Ch11.xhtml" aria-label="Add to Queue">
      <span>Add to Queue</span>
  </button>
        </li>
      </ul>
    </div>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  





    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel  collapsed slideUp">
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#" class="js-toggle-nag ss-navigateup" title="Toggle open or close footer"></a>
        <div class="sample-message">
          <p class="usage-data t-collapsed-text">Enjoy Safari?
            <a class="ga-active-trial-subscribe-nag" href="https://www.safaribooksonline.com/subscribe/">
              Subscribe Today
              
            </a>
          </p>
          

        <div class="expanded">
          <h2>You have 10 days left in your trial, Raviguru0007. </h2>
          <p class="t-expanded-text">Safari is your trusted guide for building a remarkable career. We hope you've been enjoying your trialready to join?</p>
          <a href="https://www.safaribooksonline.com/subscribe/" class="button-primary">
            Subscribe Today
            
          </a>
          
          <footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
    <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#" class="icon-up" style="display: none;"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/contact/">Contact Us</a></li>
      <li><a href="https://www.safaribooksonline.com/blog/">Blog</a></li>
    </ul>
    <span class="copyright"> 2017 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/membership-agreement/">Membership Agreement</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>

        </div>
      </div>
    </div>

    
    



        
      </div>
      




  <footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
    <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#" class="icon-up" style="display: none;"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      
        <li><a class="t-recommendations-footer" href="https://www.safaribooksonline.com/r/">Recommended</a></li>
      
      <li><a class="t-queue-footer" href="https://www.safaribooksonline.com/s/">Queue</a></li>
      
        <li><a class="t-recent-footer" href="https://www.safaribooksonline.com/history/">History</a></li>
        <li><a class="t-topics-footer" href="https://www.safaribooksonline.com/topics?q=*&amp;limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="https://www.safaribooksonline.com/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="https://www.safaribooksonline.com/u/">Settings</a></li>
      <li><a href="https://www.safaribooksonline.com/blog/">Blog</a></li>
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright"> 2017 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>

<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"applicationTime":251,"agent":"","applicationID":"3275661","errorBeacon":"bam.nr-data.net","beacon":"bam.nr-data.net","queueTime":0,"transactionName":"YgdaZ0NSW0cEB0RdWltNfkZfUEFdCgofXFBHDVYdR1pQQxZeRl1QQj1aWkU=","licenseKey":"510f1a6865"}</script>


    

    <script src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/saved_resource" charset="utf-8"></script>
    <script src="./CHAPTER 11_ Testing in Node.js - Node.js Recipes_ A Problem-Solution Approach_files/saved_resource(1)" charset="utf-8"></script>
  

<div class="annotator-notice"></div><div class="font-flyout" style="top: 200px; left: 1217px;"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch11.xhtml#">Reset</a>
</div>
</div></body></html>