<!DOCTYPE html>
<!-- saved from url=(0102)https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml -->
<html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" "="" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="1573407" data-user-uuid="29525685-85c9-45c7-9eda-3c178d86398e" data-username="raviguru0007" data-account-type="Trial" data-activated-trial-date="04/17/2017" data-archive="9781430260585" data-publishers="Apress" data-htmlfile-name="9781430260585_Ch09.xhtml" data-epub-title="Node.js Recipes: A Problem-Solution Approach" data-debug="0" data-testing="0"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781430260585"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><script type="text/javascript" src="./CHAPTER 9_ Using Web Server Frameworks - Node.js Recipes_ A Problem-Solution Approach_files/510f1a6865"></script><script src="./CHAPTER 9_ Using Web Server Frameworks - Node.js Recipes_ A Problem-Solution Approach_files/nr-spa-1026.min.js"></script><script type="text/javascript" async="" src="./CHAPTER 9_ Using Web Server Frameworks - Node.js Recipes_ A Problem-Solution Approach_files/linkid.js"></script><script async="" src="./CHAPTER 9_ Using Web Server Frameworks - Node.js Recipes_ A Problem-Solution Approach_files/analytics.js"></script><script type="text/javascript">(window.NREUM||(NREUM={})).loader_config={xpid:"VQQDUVVVGwACU1RUAQA="};window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var o=e[n]={exports:{}};t[n][0].call(o.exports,function(e){var o=t[n][1][e];return r(o||e)},o,o.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,n){function r(t){try{c.console&&console.log(t)}catch(e){}}var o,i=t("ee"),a=t(19),c={};try{o=localStorage.getItem("__nr_flags").split(","),console&&"function"==typeof console.log&&(c.console=!0,o.indexOf("dev")!==-1&&(c.dev=!0),o.indexOf("nr_dev")!==-1&&(c.nrDev=!0))}catch(s){}c.nrDev&&i.on("internal-error",function(t){r(t.stack)}),c.dev&&i.on("fn-err",function(t,e,n){r(n.stack)}),c.dev&&(r("NR AGENT IN DEVELOPMENT MODE"),r("flags: "+a(c,function(t,e){return t}).join(", ")))},{}],2:[function(t,e,n){function r(t,e,n,r,o){try{d?d-=1:i("err",[o||new UncaughtException(t,e,n)])}catch(c){try{i("ierr",[c,s.now(),!0])}catch(u){}}return"function"==typeof f&&f.apply(this,a(arguments))}function UncaughtException(t,e,n){this.message=t||"Uncaught error with no additional information",this.sourceURL=e,this.line=n}function o(t){i("err",[t,s.now()])}var i=t("handle"),a=t(20),c=t("ee"),s=t("loader"),f=window.onerror,u=!1,d=0;s.features.err=!0,t(1),window.onerror=r;try{throw new Error}catch(p){"stack"in p&&(t(12),t(11),"addEventListener"in window&&t(6),s.xhrWrappable&&t(13),u=!0)}c.on("fn-start",function(t,e,n){u&&(d+=1)}),c.on("fn-err",function(t,e,n){u&&(this.thrown=!0,o(n))}),c.on("fn-end",function(){u&&!this.thrown&&d>0&&(d-=1)}),c.on("internal-error",function(t){i("ierr",[t,s.now(),!0])})},{}],3:[function(t,e,n){t("loader").features.ins=!0},{}],4:[function(t,e,n){function r(){C++,N=y.hash,this[u]=M.now()}function o(){C--,y.hash!==N&&i(0,!0);var t=M.now();this[l]=~~this[l]+t-this[u],this[d]=t}function i(t,e){x.emit("newURL",[""+y,e])}function a(t,e){t.on(e,function(){this[e]=M.now()})}var c="-start",s="-end",f="-body",u="fn"+c,d="fn"+s,p="cb"+c,h="cb"+s,l="jsTime",m="fetch",v="addEventListener",w=window,y=w.location;if(w[v]){var b=t(9),g=t(10),x=t(8),E=t(6),O=t(12),R=t(7),P=t(13),T=t("ee"),S=T.get("tracer");t(14);var M=t("loader");M.features.spa=!0;var N,j=w[v],C=0;T.on(u,r),T.on(p,r),T.on(d,o),T.on(h,o),T.buffer([u,d,"xhr-done","xhr-resolved"]),E.buffer([u]),O.buffer(["setTimeout"+s,"clearTimeout"+c,u]),P.buffer([u,"new-xhr","send-xhr"+c]),R.buffer([m+c,m+"-done",m+f+c,m+f+s]),x.buffer(["newURL"]),b.buffer([u]),g.buffer(["propagate",p,h,"executor-err","resolve"+c]),S.buffer([u,"no-"+u]),a(P,"send-xhr"+c),a(T,"xhr-resolved"),a(T,"xhr-done"),a(R,m+c),a(R,m+"-done"),x.on("pushState-end",i),x.on("replaceState-end",i),j("hashchange",i,!0),j("load",i,!0),j("popstate",function(){i(0,C>1)},!0)}},{}],5:[function(t,e,n){function r(t){}if(window.performance&&window.performance.timing&&window.performance.getEntriesByType){var o=t("ee"),i=t("handle"),a=t(12),c=t(11),s="learResourceTimings",f="addEventListener",u="resourcetimingbufferfull",d="bstResource",p="resource",h="-start",l="-end",m="fn"+h,v="fn"+l,w="bstTimer",y="pushState",b=t("loader");b.features.stn=!0,t(8);var g=NREUM.o.EV;o.on(m,function(t,e){var n=t[0];n instanceof g&&(this.bstStart=b.now())}),o.on(v,function(t,e){var n=t[0];n instanceof g&&i("bst",[n,e,this.bstStart,b.now()])}),a.on(m,function(t,e,n){this.bstStart=b.now(),this.bstType=n}),a.on(v,function(t,e){i(w,[e,this.bstStart,b.now(),this.bstType])}),c.on(m,function(){this.bstStart=b.now()}),c.on(v,function(t,e){i(w,[e,this.bstStart,b.now(),"requestAnimationFrame"])}),o.on(y+h,function(t){this.time=b.now(),this.startPath=location.pathname+location.hash}),o.on(y+l,function(t){i("bstHist",[location.pathname+location.hash,this.startPath,this.time])}),f in window.performance&&(window.performance["c"+s]?window.performance[f](u,function(t){i(d,[window.performance.getEntriesByType(p)]),window.performance["c"+s]()},!1):window.performance[f]("webkit"+u,function(t){i(d,[window.performance.getEntriesByType(p)]),window.performance["webkitC"+s]()},!1)),document[f]("scroll",r,{passive:!0}),document[f]("keypress",r,!1),document[f]("click",r,!1)}},{}],6:[function(t,e,n){function r(t){for(var e=t;e&&!e.hasOwnProperty(u);)e=Object.getPrototypeOf(e);e&&o(e)}function o(t){c.inPlace(t,[u,d],"-",i)}function i(t,e){return t[1]}var a=t("ee").get("events"),c=t(22)(a,!0),s=t("gos"),f=XMLHttpRequest,u="addEventListener",d="removeEventListener";e.exports=a,"getPrototypeOf"in Object?(r(document),r(window),r(f.prototype)):f.prototype.hasOwnProperty(u)&&(o(window),o(f.prototype)),a.on(u+"-start",function(t,e){var n=t[1],r=s(n,"nr@wrapped",function(){function t(){if("function"==typeof n.handleEvent)return n.handleEvent.apply(n,arguments)}var e={object:t,"function":n}[typeof n];return e?c(e,"fn-",null,e.name||"anonymous"):n});this.wrapped=t[1]=r}),a.on(d+"-start",function(t){t[1]=this.wrapped||t[1]})},{}],7:[function(t,e,n){function r(t,e,n){var r=t[e];"function"==typeof r&&(t[e]=function(){var t=r.apply(this,arguments);return o.emit(n+"start",arguments,t),t.then(function(e){return o.emit(n+"end",[null,e],t),e},function(e){throw o.emit(n+"end",[e],t),e})})}var o=t("ee").get("fetch"),i=t(19);e.exports=o;var a=window,c="fetch-",s=c+"body-",f=["arrayBuffer","blob","json","text","formData"],u=a.Request,d=a.Response,p=a.fetch,h="prototype";u&&d&&p&&(i(f,function(t,e){r(u[h],e,s),r(d[h],e,s)}),r(a,"fetch",c),o.on(c+"end",function(t,e){var n=this;e?e.clone().arrayBuffer().then(function(t){n.rxSize=t.byteLength,o.emit(c+"done",[null,e],n)}):o.emit(c+"done",[t],n)}))},{}],8:[function(t,e,n){var r=t("ee").get("history"),o=t(22)(r);e.exports=r,o.inPlace(window.history,["pushState","replaceState"],"-")},{}],9:[function(t,e,n){var r=t("ee").get("mutation"),o=t(22)(r),i=NREUM.o.MO;e.exports=r,i&&(window.MutationObserver=function(t){return this instanceof i?new i(o(t,"fn-")):i.apply(this,arguments)},MutationObserver.prototype=i.prototype)},{}],10:[function(t,e,n){function r(t){var e=a.context(),n=c(t,"executor-",e),r=new f(n);return a.context(r).getCtx=function(){return e},a.emit("new-promise",[r,e],e),r}function o(t,e){return e}var i=t(22),a=t("ee").get("promise"),c=i(a),s=t(19),f=NREUM.o.PR;e.exports=a,f&&(window.Promise=r,["all","race"].forEach(function(t){var e=f[t];f[t]=function(n){function r(t){return function(){a.emit("propagate",[null,!o],i),o=o||!t}}var o=!1;s(n,function(e,n){Promise.resolve(n).then(r("all"===t),r(!1))});var i=e.apply(f,arguments),c=f.resolve(i);return c}}),["resolve","reject"].forEach(function(t){var e=f[t];f[t]=function(t){var n=e.apply(f,arguments);return t!==n&&a.emit("propagate",[t,!0],n),n}}),f.prototype["catch"]=function(t){return this.then(null,t)},f.prototype=Object.create(f.prototype,{constructor:{value:r}}),s(Object.getOwnPropertyNames(f),function(t,e){try{r[e]=f[e]}catch(n){}}),a.on("executor-start",function(t){t[0]=c(t[0],"resolve-",this),t[1]=c(t[1],"resolve-",this)}),a.on("executor-err",function(t,e,n){t[1](n)}),c.inPlace(f.prototype,["then"],"then-",o),a.on("then-start",function(t,e){this.promise=e,t[0]=c(t[0],"cb-",this),t[1]=c(t[1],"cb-",this)}),a.on("then-end",function(t,e,n){this.nextPromise=n;var r=this.promise;a.emit("propagate",[r,!0],n)}),a.on("cb-end",function(t,e,n){a.emit("propagate",[n,!0],this.nextPromise)}),a.on("propagate",function(t,e,n){this.getCtx&&!e||(this.getCtx=function(){if(t instanceof Promise)var e=a.context(t);return e&&e.getCtx?e.getCtx():this})}),r.toString=function(){return""+f})},{}],11:[function(t,e,n){var r=t("ee").get("raf"),o=t(22)(r),i="equestAnimationFrame";e.exports=r,o.inPlace(window,["r"+i,"mozR"+i,"webkitR"+i,"msR"+i],"raf-"),r.on("raf-start",function(t){t[0]=o(t[0],"fn-")})},{}],12:[function(t,e,n){function r(t,e,n){t[0]=a(t[0],"fn-",null,n)}function o(t,e,n){this.method=n,this.timerDuration="number"==typeof t[1]?t[1]:0,t[0]=a(t[0],"fn-",this,n)}var i=t("ee").get("timer"),a=t(22)(i),c="setTimeout",s="setInterval",f="clearTimeout",u="-start",d="-";e.exports=i,a.inPlace(window,[c,"setImmediate"],c+d),a.inPlace(window,[s],s+d),a.inPlace(window,[f,"clearImmediate"],f+d),i.on(s+u,r),i.on(c+u,o)},{}],13:[function(t,e,n){function r(t,e){d.inPlace(e,["onreadystatechange"],"fn-",c)}function o(){var t=this,e=u.context(t);t.readyState>3&&!e.resolved&&(e.resolved=!0,u.emit("xhr-resolved",[],t)),d.inPlace(t,v,"fn-",c)}function i(t){w.push(t),l&&(b=-b,g.data=b)}function a(){for(var t=0;t<w.length;t++)r([],w[t]);w.length&&(w=[])}function c(t,e){return e}function s(t,e){for(var n in t)e[n]=t[n];return e}t(6);var f=t("ee"),u=f.get("xhr"),d=t(22)(u),p=NREUM.o,h=p.XHR,l=p.MO,m="readystatechange",v=["onload","onerror","onabort","onloadstart","onloadend","onprogress","ontimeout"],w=[];e.exports=u;var y=window.XMLHttpRequest=function(t){var e=new h(t);try{u.emit("new-xhr",[e],e),e.addEventListener(m,o,!1)}catch(n){try{u.emit("internal-error",[n])}catch(r){}}return e};if(s(h,y),y.prototype=h.prototype,d.inPlace(y.prototype,["open","send"],"-xhr-",c),u.on("send-xhr-start",function(t,e){r(t,e),i(e)}),u.on("open-xhr-start",r),l){var b=1,g=document.createTextNode(b);new l(a).observe(g,{characterData:!0})}else f.on("fn-end",function(t){t[0]&&t[0].type===m||a()})},{}],14:[function(t,e,n){function r(t){var e=this.params,n=this.metrics;if(!this.ended){this.ended=!0;for(var r=0;r<d;r++)t.removeEventListener(u[r],this.listener,!1);if(!e.aborted){if(n.duration=a.now()-this.startTime,4===t.readyState){e.status=t.status;var i=o(t,this.lastSize);if(i&&(n.rxSize=i),this.sameOrigin){var s=t.getResponseHeader("X-NewRelic-App-Data");s&&(e.cat=s.split(", ").pop())}}else e.status=0;n.cbTime=this.cbTime,f.emit("xhr-done",[t],t),c("xhr",[e,n,this.startTime])}}}function o(t,e){var n=t.responseType;if("json"===n&&null!==e)return e;var r="arraybuffer"===n||"blob"===n||"json"===n?t.response:t.responseText;return l(r)}function i(t,e){var n=s(e),r=t.params;r.host=n.hostname+":"+n.port,r.pathname=n.pathname,t.sameOrigin=n.sameOrigin}var a=t("loader");if(a.xhrWrappable){var c=t("handle"),s=t(15),f=t("ee"),u=["load","error","abort","timeout"],d=u.length,p=t("id"),h=t(18),l=t(17),m=window.XMLHttpRequest;a.features.xhr=!0,t(13),f.on("new-xhr",function(t){var e=this;e.totalCbs=0,e.called=0,e.cbTime=0,e.end=r,e.ended=!1,e.xhrGuids={},e.lastSize=null,h&&(h>34||h<10)||window.opera||t.addEventListener("progress",function(t){e.lastSize=t.loaded},!1)}),f.on("open-xhr-start",function(t){this.params={method:t[0]},i(this,t[1]),this.metrics={}}),f.on("open-xhr-end",function(t,e){"loader_config"in NREUM&&"xpid"in NREUM.loader_config&&this.sameOrigin&&e.setRequestHeader("X-NewRelic-ID",NREUM.loader_config.xpid)}),f.on("send-xhr-start",function(t,e){var n=this.metrics,r=t[0],o=this;if(n&&r){var i=l(r);i&&(n.txSize=i)}this.startTime=a.now(),this.listener=function(t){try{"abort"===t.type&&(o.params.aborted=!0),("load"!==t.type||o.called===o.totalCbs&&(o.onloadCalled||"function"!=typeof e.onload))&&o.end(e)}catch(n){try{f.emit("internal-error",[n])}catch(r){}}};for(var c=0;c<d;c++)e.addEventListener(u[c],this.listener,!1)}),f.on("xhr-cb-time",function(t,e,n){this.cbTime+=t,e?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&&"function"==typeof n.onload||this.end(n)}),f.on("xhr-load-added",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&!this.xhrGuids[n]&&(this.xhrGuids[n]=!0,this.totalCbs+=1)}),f.on("xhr-load-removed",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&this.xhrGuids[n]&&(delete this.xhrGuids[n],this.totalCbs-=1)}),f.on("addEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-added",[t[1],t[2]],e)}),f.on("removeEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-removed",[t[1],t[2]],e)}),f.on("fn-start",function(t,e,n){e instanceof m&&("onload"===n&&(this.onload=!0),("load"===(t[0]&&t[0].type)||this.onload)&&(this.xhrCbStart=a.now()))}),f.on("fn-end",function(t,e){this.xhrCbStart&&f.emit("xhr-cb-time",[a.now()-this.xhrCbStart,this.onload,e],e)})}},{}],15:[function(t,e,n){e.exports=function(t){var e=document.createElement("a"),n=window.location,r={};e.href=t,r.port=e.port;var o=e.href.split("://");!r.port&&o[1]&&(r.port=o[1].split("/")[0].split("@").pop().split(":")[1]),r.port&&"0"!==r.port||(r.port="https"===o[0]?"443":"80"),r.hostname=e.hostname||n.hostname,r.pathname=e.pathname,r.protocol=o[0],"/"!==r.pathname.charAt(0)&&(r.pathname="/"+r.pathname);var i=!e.protocol||":"===e.protocol||e.protocol===n.protocol,a=e.hostname===document.domain&&e.port===n.port;return r.sameOrigin=i&&(!e.hostname||a),r}},{}],16:[function(t,e,n){function r(){}function o(t,e,n){return function(){return i(t,[f.now()].concat(c(arguments)),e?null:this,n),e?void 0:this}}var i=t("handle"),a=t(19),c=t(20),s=t("ee").get("tracer"),f=t("loader"),u=NREUM;"undefined"==typeof window.newrelic&&(newrelic=u);var d=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],p="api-",h=p+"ixn-";a(d,function(t,e){u[e]=o(p+e,!0,"api")}),u.addPageAction=o(p+"addPageAction",!0),u.setCurrentRouteName=o(p+"routeName",!0),e.exports=newrelic,u.interaction=function(){return(new r).get()};var l=r.prototype={createTracer:function(t,e){var n={},r=this,o="function"==typeof e;return i(h+"tracer",[f.now(),t,n],r),function(){if(s.emit((o?"":"no-")+"fn-start",[f.now(),r,o],n),o)try{return e.apply(this,arguments)}finally{s.emit("fn-end",[f.now()],n)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,e){l[e]=o(h+e)}),newrelic.noticeError=function(t){"string"==typeof t&&(t=new Error(t)),i("err",[t,f.now()])}},{}],17:[function(t,e,n){e.exports=function(t){if("string"==typeof t&&t.length)return t.length;if("object"==typeof t){if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&t.byteLength)return t.byteLength;if("undefined"!=typeof Blob&&t instanceof Blob&&t.size)return t.size;if(!("undefined"!=typeof FormData&&t instanceof FormData))try{return JSON.stringify(t).length}catch(e){return}}}},{}],18:[function(t,e,n){var r=0,o=navigator.userAgent.match(/Firefox[\/\s](\d+\.\d+)/);o&&(r=+o[1]),e.exports=r},{}],19:[function(t,e,n){function r(t,e){var n=[],r="",i=0;for(r in t)o.call(t,r)&&(n[i]=e(r,t[r]),i+=1);return n}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],20:[function(t,e,n){function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(o<0?0:o);++r<o;)i[r]=t[e+r];return i}e.exports=r},{}],21:[function(t,e,n){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],22:[function(t,e,n){function r(t){return!(t&&t instanceof Function&&t.apply&&!t[a])}var o=t("ee"),i=t(20),a="nr@original",c=Object.prototype.hasOwnProperty,s=!1;e.exports=function(t,e){function n(t,e,n,o){function nrWrapper(){var r,a,c,s;try{a=this,r=i(arguments),c="function"==typeof n?n(r,a):n||{}}catch(f){p([f,"",[r,a,o],c])}u(e+"start",[r,a,o],c);try{return s=t.apply(a,r)}catch(d){throw u(e+"err",[r,a,d],c),d}finally{u(e+"end",[r,a,s],c)}}return r(t)?t:(e||(e=""),nrWrapper[a]=t,d(t,nrWrapper),nrWrapper)}function f(t,e,o,i){o||(o="");var a,c,s,f="-"===o.charAt(0);for(s=0;s<e.length;s++)c=e[s],a=t[c],r(a)||(t[c]=n(a,f?c+o:o,i,c))}function u(n,r,o){if(!s||e){var i=s;s=!0;try{t.emit(n,r,o,e)}catch(a){p([a,n,r,o])}s=i}}function d(t,e){if(Object.defineProperty&&Object.keys)try{var n=Object.keys(t);return n.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(r){p([r])}for(var o in t)c.call(t,o)&&(e[o]=t[o]);return e}function p(e){try{t.emit("internal-error",e)}catch(n){}}return t||(t=o),n.inPlace=f,n.flag=a,n}},{}],ee:[function(t,e,n){function r(){}function o(t){function e(t){return t&&t instanceof r?t:t?s(t,c,i):i()}function n(n,r,o,i){if(!p.aborted||i){t&&t(n,r,o);for(var a=e(o),c=l(n),s=c.length,f=0;f<s;f++)c[f].apply(a,r);var d=u[y[n]];return d&&d.push([b,n,r,a]),a}}function h(t,e){w[t]=l(t).concat(e)}function l(t){return w[t]||[]}function m(t){return d[t]=d[t]||o(n)}function v(t,e){f(t,function(t,n){e=e||"feature",y[n]=e,e in u||(u[e]=[])})}var w={},y={},b={on:h,emit:n,get:m,listeners:l,context:e,buffer:v,abort:a,aborted:!1};return b}function i(){return new r}function a(){(u.api||u.feature)&&(p.aborted=!0,u=p.backlog={})}var c="nr@context",s=t("gos"),f=t(19),u={},d={},p=e.exports=o();p.backlog=u},{}],gos:[function(t,e,n){function r(t,e,n){if(o.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return t[e]=r,r}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(t,e,n){function r(t,e,n,r){o.buffer([t],r),o.emit(t,e,n)}var o=t("ee").get("handle");e.exports=r,r.ee=o},{}],id:[function(t,e,n){function r(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,i,function(){return o++})}var o=1,i="nr@id",a=t("gos");e.exports=r},{}],loader:[function(t,e,n){function r(){if(!x++){var t=g.info=NREUM.info,e=p.getElementsByTagName("script")[0];if(setTimeout(u.abort,3e4),!(t&&t.licenseKey&&t.applicationID&&e))return u.abort();f(y,function(e,n){t[e]||(t[e]=n)}),s("mark",["onload",a()+g.offset],null,"api");var n=p.createElement("script");n.src="https://"+t.agent,e.parentNode.insertBefore(n,e)}}function o(){"complete"===p.readyState&&i()}function i(){s("mark",["domContent",a()+g.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(c=Math.max((new Date).getTime(),c))-g.offset}var c=(new Date).getTime(),s=t("handle"),f=t(19),u=t("ee"),d=window,p=d.document,h="addEventListener",l="attachEvent",m=d.XMLHttpRequest,v=m&&m.prototype;NREUM.o={ST:setTimeout,CT:clearTimeout,XHR:m,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var w=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-spa-1026.min.js"},b=m&&v&&v[h]&&!/CriOS/.test(navigator.userAgent),g=e.exports={offset:c,now:a,origin:w,features:{},xhrWrappable:b};t(16),p[h]?(p[h]("DOMContentLoaded",i,!1),d[h]("load",r,!1)):(p[l]("onreadystatechange",o),d[l]("onload",r)),s("mark",["firstbyte",c],null,"api");var x=0,E=t(21)},{}]},{},["loader",2,14,5,3,4]);</script><link rel="apple-touch-icon" href="https://www.safaribooksonline.com/static/images/apple-touch-icon.8cc2fd27400e.png"><link rel="shortcut icon" href="https://www.safaribooksonline.com/favicon.ico" type="image/x-icon"><link href="./CHAPTER 9_ Using Web Server Frameworks - Node.js Recipes_ A Problem-Solution Approach_files/css" rel="stylesheet" type="text/css"><title>CHAPTER 9: Using Web Server Frameworks - Node.js Recipes: A Problem-Solution Approach</title><link rel="stylesheet" href="./CHAPTER 9_ Using Web Server Frameworks - Node.js Recipes_ A Problem-Solution Approach_files/74741d96e0ae.css" type="text/css"><link rel="stylesheet" type="text/css" href="./CHAPTER 9_ Using Web Server Frameworks - Node.js Recipes_ A Problem-Solution Approach_files/annotator.e34eec1a0d5a.css"><link rel="stylesheet" href="./CHAPTER 9_ Using Web Server Frameworks - Node.js Recipes_ A Problem-Solution Approach_files/font-awesome.min.css"><style type="text/css" title="ibis-book">
    #sbo-rt-content div{margin:1em 1em 1em 1em}#sbo-rt-content a{text-decoration:none}#sbo-rt-content img{max-width:100%;margin-top:10pt}#sbo-rt-content p.booktitle{font-weight:bold;font-size:2.5em;margin-top:2em;margin-bottom:8em;text-align:center}#sbo-rt-content p.bookauthor{font-weight:bold;font-size:1.7em;margin-top:0;margin-right:2em;margin-bottom:0;text-align:left}#sbo-rt-content p.booksubtitle{font-weight:bold;font-size:1.7em;margin-top:0;margin-bottom:7em;text-align:center;color:#8A8A8A}#sbo-rt-content .bookimage{font-size:1.2em;margin-top:0;margin-bottom:1em;text-align:left}#sbo-rt-content .fmpara{font-size:.9em;text-indent:0;margin-top:.5em;margin-bottom:.3em;text-align:justify}#sbo-rt-content .fmpara1{font-size:.9em;text-indent:0;margin-top:.4em;margin-bottom:.3em;text-align:right}#sbo-rt-content .inpara{text-indent:0;margin-top:.4em;margin-left:3em;margin-bottom:.3em}#sbo-rt-content .pub{margin-top:10em;margin-bottom:1em;text-align:right;margin-right:5em}#sbo-rt-content .copyright{font-size:.9em;margin-top:.4em;margin-bottom:.4em;margin-left:1.2em;margin-right:1.2em;text-align:left}#sbo-rt-content .copyright1{font-size:.9em;margin-top:.1em;margin-bottom:.1em;margin-left:4em;margin-right:3.3em;text-align:left;text-indent:-1.6em}#sbo-rt-content .copyright2{font-size:.9em;margin-top:.1em;margin-bottom:.1em;margin-left:4.2em}#sbo-rt-content .dedication{font-size:1.2em;margin-bottom:0;margin-top:3.5em;text-align:center;margin-right:1em;font-style:italic}#sbo-rt-content .dedication1{font-size:1.2em;margin-bottom:0;margin-top:.5em;text-align:center;margin-right:1em;font-style:normal}#sbo-rt-content .dedication2{font-size:1.2em;margin-bottom:0;margin-top:1.5em;text-align:center;margin-right:1em;font-style:italic}#sbo-rt-content .content-title{font-size:1.6em;margin-top:3em;margin-bottom:.1em;text-align:left;font-weight:bold}#sbo-rt-content .fmtitle{font-size:2.5em;margin-top:1em;margin-bottom:1em;text-align:left;font-weight:bold;border-bottom:1.1px solid black;padding-bottom:.8em}#sbo-rt-content .right{text-indent:0;margin-top:1em;margin-right:1.5em;margin-bottom:.3em;text-align:right}#sbo-rt-content .right1{text-indent:0;margin-top:0;margin-right:1.5em;margin-bottom:.2em;text-align:right}#sbo-rt-content .chapimage{margin-left:.2em;margin-top:1.5em;margin-bottom:1.5em;text-align:left}#sbo-rt-content p.ChapterNumber{font-weight:bold;font-size:1.7em;margin-top:10px;margin-left:0;margin-bottom:5px;text-align:left}#sbo-rt-content p.ChapterTitle{font-weight:bold;font-size:2.5em;margin-top:0;margin-bottom:1em;margin-left:0;text-align:left;border-bottom:1.1px solid black;padding-bottom:.8em}#sbo-rt-content p.PartNumber{font-weight:bold;font-size:1.7em;margin-top:10px;margin-left:0;margin-bottom:5px;text-align:left;padding-bottom:.8em}#sbo-rt-content p.partTitle{font-weight:bold;font-size:2.5em;margin-top:1em;margin-bottom:1em;margin-left:0;text-align:left}#sbo-rt-content .paraaftertitle{font-size:100%;text-indent:0;margin-top:0;margin-left:0;margin-bottom:0}#sbo-rt-content p.noindent{font-size:100%;text-indent:0;margin-top:1em;margin-bottom:0;margin-left:0;margin-right:0;text-align:left}#sbo-rt-content p.noindent1{font-size:100%;text-indent:0;margin-top:1em;margin-bottom:1em}#sbo-rt-content p.noindent2{font-size:100%;text-indent:0;margin-top:1.5em;margin-bottom:1em}#sbo-rt-content p.noindent3{font-size:100%;text-indent:0;margin-top:.8em;margin-bottom:.2em;margin-left:0;margin-right:0;text-align:center}#sbo-rt-content p.noindent4{font-size:100%;text-indent:0;margin-top:.8em;margin-bottom:.2em;margin-left:0;margin-right:0;text-align:left}#sbo-rt-content span.listing{font-weight:bold}#sbo-rt-content p.indent{font-size:100%;text-indent:1.2em;margin-top:.1em;margin-bottom:.1em;margin-left:0;margin-right:0;text-align:left}#sbo-rt-content p.indent1{font-size:100%;text-indent:1.2em;margin-top:0;margin-bottom:0;margin-left:0;margin-right:0;text-align:left}#sbo-rt-content p.indent1a{font-size:100%;text-indent:1.5em;margin-top:0;margin-bottom:0;margin-left:0;margin-right:4.5em;text-align:right}#sbo-rt-content p.indent2{font-size:100%;margin-top:.8em;margin-bottom:.8em;margin-left:2.4em;margin-right:2.4em;text-align:justify;font-style:italic}#sbo-rt-content p.indent3{font-size:100%;text-indent:1em;margin-top:.8em;margin-bottom:.8em;margin-left:1.8em;margin-right:1.8em;text-align:left}#sbo-rt-content p.indent4{font-size:100%;text-indent:1.3em;margin-top:.5em;margin-bottom:.5em;margin-left:2em;margin-right:0;text-align:left}#sbo-rt-content .blockquote{font-size:100%;text-indent:.2em;margin-top:1em;margin-left:3em;margin-right:2em;margin-bottom:1em;font-style:italic}#sbo-rt-content .blockquote1{font-size:100%;text-indent:.2em;margin-top:1em;margin-left:3em;margin-bottom:0;font-style:italic}#sbo-rt-content p.Heading1{font-weight:bold;font-size:2em;text-indent:0;margin-top:1.3em;margin-bottom:.3em}#sbo-rt-content p.Heading2{font-size:1.6em;text-indent:0;margin-top:1.3em;margin-bottom:.3em}#sbo-rt-content p.Heading2_2{font-size:1.6em;text-indent:0;margin-top:.3em;margin-bottom:.3em}#sbo-rt-content p.Heading2a{font-size:1.5em;text-indent:0;margin-top:1.3em;margin-bottom:.3em;font-weight:bold}#sbo-rt-content p.Heading3{font-weight:bold;font-size:1.45em;text-indent:0;margin-top:1.2em;margin-bottom:.1em}#sbo-rt-content p.Heading3a{font-weight:normal;font-size:1.25em;text-indent:0;margin-top:1.2em;margin-bottom:.1em}#sbo-rt-content p.Heading4{font-size:1.3em;text-indent:0;margin-top:1.3em;margin-bottom:.3em;text-align:left}#sbo-rt-content .img{max-width:100%;margin-top:10pt}#sbo-rt-content .img1{text-align:left}#sbo-rt-content .img1a{text-align:right;margin-right:5em;margin-top:5em}#sbo-rt-content .img2{text-align:left}#sbo-rt-content div.Figure{font-size:small;margin-top:1.5em;margin-bottom:1.5em}#sbo-rt-content .para-1{font-size:100%;margin-top:1em;text-indent:1.5em;margin-bottom:0;text-align:left}#sbo-rt-content .para-2{font-size:.9em;text-indent:-1.4em;margin-left:2.4em;margin-top:.5em;margin-bottom:0}#sbo-rt-content .figurecaption{font-size:small;margin-top:0;margin-bottom:0;text-align:justify}#sbo-rt-content .image{text-align:center}#sbo-rt-content .codecaption{font-size:100%;margin-top:.6em;margin-bottom:.6em;text-align:justify;font-style:italic}#sbo-rt-content .PCode{font-size:small;margin-top:1em;margin-bottom:1em;margin-left:0;text-align:left;font-family:monospace}#sbo-rt-content .PCode-1{font-size:small;margin-top:1em;margin-bottom:.1em;margin-left:0;text-align:left;font-family:monospace}#sbo-rt-content .PCode-2{font-size:small;margin-top:0;margin-bottom:0;margin-left:0;text-align:left;font-family:monospace}#sbo-rt-content .PCode-3{font-size:small;margin-top:0;margin-bottom:1em;margin-left:0;text-align:left;font-family:monospace}#sbo-rt-content div.singlethin{border-bottom:solid 3px;margin-left:1em;margin-right:1em;margin-bottom:1em}#sbo-rt-content div.singlethin1{margin-left:2em;margin-right:2em}#sbo-rt-content .inlinecode{font-family:monospace}#sbo-rt-content div.notepara{font-size:110%;text-indent:0;margin-top:1em;border-top:solid 1px;border-bottom:solid 1px;margin-bottom:1em;text-align:justify}#sbo-rt-content span.pink-box{font-weight:bold;padding-left:1.3em;padding-right:1.3em;border:1.1px solid black;font-size:1.5em;margin-top:.5em;margin-bottom:.5em;text-indent:0;text-align:justify}#sbo-rt-content span.courier{font-family:Courier New;font-weight:normal;font-style:normal;font-size:100%}#sbo-rt-content div.courier{font-family:Courier New;font-weight:normal;font-style:normal;font-size:100%;margin-top:1em;margin-bottom:1em}#sbo-rt-content div.boxcourier{font-family:Courier New;font-weight:normal;font-style:normal;font-size:100%;margin-top:1em;margin-bottom:1em;margin-left:1.5em;margin-right:1.5em;text-align:left}#sbo-rt-content span.courier1{font-family:Courier New;font-weight:normal;font-style:normal;font-size:95%}#sbo-rt-content .boxhead{font-size:1.25em;font-weight:bold;padding-left:.1em;padding-bottom:.1em;padding-top:.1em;margin-top:0;text-indent:0;text-align:center;border:3px solid black}#sbo-rt-content div.box{margin-top:1em;margin-bottom:1em}#sbo-rt-content .boxpara{font-size:110%;text-indent:0;margin-left:1.5em;margin-right:1.5em;margin-top:.5em;margin-bottom:.5em;text-align:left}#sbo-rt-content .alpha{font-size:1.2em;font-weight:bold;margin-left:.2em;margin-top:1em;margin-bottom:.3em;text-align:left}#sbo-rt-content .index{font-size:small;margin-left:.2em;margin-top:0;margin-bottom:0;text-align:left}#sbo-rt-content .index1{font-size:small;margin-left:1em;margin-top:0;margin-bottom:0;text-align:left}#sbo-rt-content .index2{font-size:small;margin-left:2em;margin-top:0;margin-bottom:0;text-align:left}#sbo-rt-content .cover{text-align:center}#sbo-rt-content .top{border-top:1.1px solid black;border-bottom:2px solid black}#sbo-rt-content .bot{border-bottom:2px solid black}#sbo-rt-content table.bodytable,#sbo-rt-content table{border-collapse:collapse;margin-bottom:8px;font-size:small;margin-top:10pt;width:95%;border-top:0 solid black;border-bottom:0 solid black}#sbo-rt-content table.fmtable{margin-bottom:1em;font-size:1em;margin-left:4em;border-top:0 solid #FFF;border-bottom:0 solid #FFF}#sbo-rt-content table{margin-bottom:1em;border-top:1.1px solid black;border-bottom:1.1px solid black;border-collapse:collapse}#sbo-rt-content th{border-top:1px solid black;border-bottom:1px solid black;padding-right:1.5em}#sbo-rt-content td{font-size:small;vertical-align:top;padding-right:1.5em;margin-top:0;margin-bottom:1em}#sbo-rt-content .tablepara{font-size:small;text-indent:0;margin-top:0;margin-bottom:.5em;padding-right:1.5em}#sbo-rt-content .tablepara1{font-size:small;margin-left:2em;margin-top:0;margin-bottom:0;padding-right:1.5em}#sbo-rt-content .header{border-bottom:1.1px solid black;text-indent:0;text-align:left}#sbo-rt-content .TabCapt{font-style:italic;margin-left:0;text-indent:0}#sbo-rt-content .FigCapt{font-style:italic;font-size:.9em}#sbo-rt-content .CaptNr{font-weight:bold}#sbo-rt-content .ttitle{font-style:Italic;margin-bottom:1em}#sbo-rt-content p.paraaftertitle1{font-size:.9em;text-indent:0;margin-top:.5em;margin-bottom:.8em;text-align:left}#sbo-rt-content p.para{font-size:small;text-indent:20px;margin-top:0;margin-bottom:0;text-align:justify}#sbo-rt-content p.quote{font-style:italic;font-size:100%;margin-top:1.5em;margin-left:2.5em;margin-right:2.5em;margin-bottom:0}#sbo-rt-content p.quotesource{font-size:small;text-indent:0;margin-top:1em;margin-bottom:1em;text-align:right}#sbo-rt-content p.chaptersubtitle{font-size:x-large;text-indent:0;margin-top:0;margin-left:0;margin-bottom:0;text-align:left}#sbo-rt-content p.line{margin-top:.3em;border-bottom:1px solid black}#sbo-rt-content p.line1{margin-top:.3em;margin-bottom:1.5em;border-bottom:1px solid black}#sbo-rt-content p.line2{margin-top:5em;margin-bottom:5em;border-bottom:1px solid black;text-align:center;margin-left:15em;margin-right:15em}#sbo-rt-content li{margin-bottom:.5em;margin-top:.5em}#sbo-rt-content p.alpha{font-size:1.2em;font-weight:bold;margin-left:.2em;margin-top:1em;margin-bottom:.3em;text-align:left}#sbo-rt-content ul.bulleted{font-size:100%;text-align:justify;margin-left:2.5em;margin-right:3em;margin-top:1em;margin-bottom:1em;text-indent:0}#sbo-rt-content ol.OrderedList{font-size:100%;text-align:left;margin-left:2.5em;margin-right:3em;margin-top:1em;margin-bottom:1em}#sbo-rt-content ul.bulleted1{font-size:100%;text-align:left;margin-left:1em;margin-right:5em;margin-top:1em;margin-bottom:1em;list-style-type:none}#sbo-rt-content ul.bulleted1_a{font-size:100%;text-align:justify;margin-left:0;margin-right:5em;margin-top:1em;margin-bottom:1em;text-indent:0;list-style-type:none}#sbo-rt-content ul.bulleted2{font-size:100%;text-align:justify;margin-left:2.3em;margin-right:5em;margin-top:1em;margin-bottom:1em;text-indent:0}#sbo-rt-content ul.bulleted4{font-size:100%;text-align:center;margin-left:1.3em;margin-right:5em;margin-top:1em;margin-bottom:1em;text-indent:0;list-style-type:none}#sbo-rt-content .numbered{font-size:small;text-align:justify;margin-left:2em;margin-right:2em;margin-top:.5em;margin-bottom:.5em;text-indent:1em}#sbo-rt-content .bulletedin{font-size:100%;text-align:justify;margin-left:4em;margin-right:4em;margin-top:.5em;margin-bottom:.5em}#sbo-rt-content ul.None{font-size:.9em;text-align:justify;margin-left:3em;margin-right:2em;margin-top:.5em;margin-bottom:.5em;list-style-type:none}#sbo-rt-content .Listing{font-size:small;margin-bottom:0}#sbo-rt-content .PCode1{font-size:small;margin-top:.7em;margin-bottom:0;text-align:left;font-family:monospace}#sbo-rt-content .PCode2{font-size:small;margin-top:1em;margin-bottom:.1em;margin-left:2.2em;text-align:left;font-family:monospace}#sbo-rt-content .PCode3{font-size:small;margin-top:0;margin-left:2.2em;margin-bottom:.1em;text-align:left;font-family:monospace}#sbo-rt-content .NoteCaption{font-size:small;margin-top:1.3em;margin-left:5em;margin-right:5em;border:1.1px solid black;padding:.5em;margin-bottom:1.3em}#sbo-rt-content .Table{font-size:100%;margin-bottom:1em;margin-left:0}#sbo-rt-content .toc{font-size:1.1em;margin-top:.2em;margin-bottom:.2em;text-align:left;font-weight:bold}#sbo-rt-content .toca{font-size:1.1em;margin-top:.8em;margin-bottom:.4em;text-align:left;font-weight:bold}#sbo-rt-content .toc1{font-size:1.1em;margin-top:.4em;margin-bottom:.3em;text-align:left;text-indent:1.4em;font-weight:normal}#sbo-rt-content .toc2{font-size:1.2em;margin-top:.4em;margin-bottom:.3em;text-align:left;font-weight:bold}#sbo-rt-content .toc3{font-size:.9em;margin-top:.4em;margin-bottom:.3em;text-align:left;text-indent:3.5em;font-weight:normal}#sbo-rt-content .toc4{font-size:1.1em;margin-top:.2em;margin-bottom:.5em;text-align:left;font-weight:bold}#sbo-rt-content .tocch{font-size:1.3em;margin-top:.7em;margin-bottom:.7em;text-align:left;font-weight:bold}#sbo-rt-content .noborder{margin-bottom:1em;border-top:0 solid #FFF;border-bottom:0 solid #FFF}#sbo-rt-content .authurright{text-align:right;margin-top:0;margin-bottom:0}#sbo-rt-content .FormalPara{font-size:small;margin-bottom:.7em}#sbo-rt-content .FontName1{font-size:100%;font-family:"Courier New",Courier,monospace}#sbo-rt-content span.FontName2{font-size:100%;font-family:"Courier New",Courier,monospace}#sbo-rt-content span.FontName3{font-size:100%;font-family:"Courier New",Courier,monospace}#sbo-rt-content .rightarrow{margin-top:0}#sbo-rt-content div.thinline{margin-top:1em;margin-bottom:1em;border-top:solid 4px #AFAFB0;border-bottom:solid 4px #AFAFB0}#sbo-rt-content span.line{text-decoration:underline}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content div.box{border-top:solid 2px;border-bottom:solid 2px}#sbo-rt-content .app{font-size:150%;margin-left:.8em}#sbo-rt-content .page{text-decoration:none;color:#000}#sbo-rt-content .cXXX{text-decoration:none;color:#000}#sbo-rt-content .textindent{margin-left:1.7em;margin-top:1em;margin-bottom:1em;font-size:100%}#sbo-rt-content .textindent1{margin-left:1.7em;margin-top:0;margin-bottom:0;font-size:100%}#sbo-rt-content .textindent2{margin-left:1.7em;margin-top:0;margin-bottom:0;font-size:100%;text-indent:1em}#sbo-rt-content p.FootNote{margin-top:.8em;margin-bottom:0;font-size:85%;text-indent:0;text-align:left;margin-left:1.1em;margin-right:1.1em}#sbo-rt-content pre{margin-left:0;font-family:monospace;white-space:pre-wrap}#sbo-rt-content p.Heading4a{font-size:1.15em;font-weight:bold;text-indent:1em;margin-top:1.3em;margin-bottom:.3em;border-top:3px solid #4d4d4c;border-left:solid 3px #4d4d4c;border-right:solid 3px #4d4d4c;border-bottom:solid 3px #4d4d4c;text-align:center}#sbo-rt-content p.noindent8{font-size:100%;text-indent:0;margin-top:1em;margin-bottom:1em;text-align:center;font-weight:bold;color:#8A8A8A}#sbo-rt-content .tocb{font-size:1.4em;margin-top:.5em;margin-bottom:.2em;text-align:left;font-weight:bold}#sbo-rt-content .part{font-weight:normal;font-size:1em;margin-bottom:5px;text-align:left;padding-left:1.3em;padding-bottom:10em;padding-right:1.3em;border:1.1px solid black}#sbo-rt-content p.Heading5{font-size:1em;text-indent:0;margin-top:1.3em;margin-bottom:.3em;text-align:center}#sbo-rt-content p.noindent5s{font-size:100%;text-indent:0;margin-top:.1em;margin-bottom:.1em;margin-left:0;margin-right:0;text-align:right}#sbo-rt-content span.strike{text-decoration:line-through}
    </style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9781430260585/chapter/9781430260585_Ch09.xhtml",
          "book_id": "9781430260585",
          "chapter_uri": "9781430260585_Ch09.xhtml",
          "position": 0,
          "user_uuid": "29525685-85c9-45c7-9eda-3c178d86398e",
          "next_chapter_uri": "/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch10.xhtml"
        
      },
      title: "Node.js Recipes: A Problem\u002DSolution Approach",
      author_list: "Cory Gackenheimer",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false,
      show_ios_app_teaser: false
    };
    // ]]></script><script src="./CHAPTER 9_ Using Web Server Frameworks - Node.js Recipes_ A Problem-Solution Approach_files/modernizr.js"></script><script>
    
      
        

        

        
          
            window.PUBLIC_ANNOTATIONS = true;
          
        

      

      
        window.MOBILE_PUBLIC_ANNOTATIONS = false;
      

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

    
      window.PRIVACY_CONTROL_SWITCH = true;
    

    
      window.PUBLISHER_PAGES = true;
    

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "https://www.safaribooksonline.com/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://www.safaribooksonline.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml"><meta name="description" content="CHAPTER 9 Using Web Server Frameworks Node.js is a natural fit for building a web server. Because of this, many developers have built web server applications. Some of these ... "><meta property="og:title" content="CHAPTER 9: Using Web Server Frameworks"><meta itemprop="isPartOf" content="/library/view/nodejs-recipes-a/9781430260585/"><meta itemprop="name" content="CHAPTER 9: Using Web Server Frameworks"><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/9781430260585/"><meta property="og:description" itemprop="description" content="CHAPTER 9 Using Web Server Frameworks Node.js is a natural fit for building a web server. Because of this, many developers have built web server applications. Some of these ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="Apress"><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781430260585"><meta property="og:book:author" itemprop="author" content="Cory Gackenheimer"><meta property="og:book:tag" itemprop="about" content="JavaScript"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: &lt;%= font_size %&gt; !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: &lt;%= font_family %&gt; !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: &lt;%= column_width %&gt;% !important; margin: 0 auto !important; }"></style><noscript>&lt;meta http-equiv="refresh" content="0; url=/library/no-js/" /&gt;</noscript><script type="text/javascript">
  (function(i,s,o,g,r,a,m) {
    i['GoogleAnalyticsObject']=r;
    i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();
    a=s.createElement(o),m=s.getElementsByTagName(o)[0];
    a.async=1;
    a.src=g;
    m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  var matches = document.cookie.match(/BrowserCookie\s*=\s*([a-f0-9\-]{36})/),
      user_uuid = null;

  if (matches && matches.length === 2) {
    user_uuid = matches[1];
  }


  ga('create', 'UA-39299553-7', {'userId': '29525685-85c9-45c7-9eda-3c178d86398e' });


ga('set', 'dimension1', 'Trial');
ga('set', 'dimension6', user_uuid);


  ga('set', 'dimension2', '29525685-85c9-45c7-9eda-3c178d86398e');
  






  //enable enhanced link tracking
  ga('require', 'linkid', 'linkid.js');

  // reading interface will track pageviews itself
  if (document.location.pathname.indexOf("/library/view") !== 0) {
    ga('send', 'pageview');
  }
</script><script defer="" src="./CHAPTER 9_ Using Web Server Frameworks - Node.js Recipes_ A Problem-Solution Approach_files/vendor.34024413b1d4.js"></script><script defer="" src="./CHAPTER 9_ Using Web Server Frameworks - Node.js Recipes_ A Problem-Solution Approach_files/reader.a05323b190d3.js"></script><script async="" src="./CHAPTER 9_ Using Web Server Frameworks - Node.js Recipes_ A Problem-Solution Approach_files/MathJax.js"></script><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts subscribe-panel library">

    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        





<a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="https://www.safaribooksonline.com/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"></path><rect x="10" y="12" width="3" height="7"></rect><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"></rect><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"></rect></g></svg><span>Safari Home</span></a></li><li><a href="https://www.safaribooksonline.com/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z"></path></g></svg><span>Recommended</span></a></li><li><a href="https://www.safaribooksonline.com/s/" class="t-queue-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z"></path></g></svg><span>
              
                Queue
              
            </span></a></li><li class="search"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="https://www.safaribooksonline.com/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z"></path></g></svg><span>History</span></a></li><li><a href="https://www.safaribooksonline.com/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" width="20" height="20" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z"></path></g></svg><span>Topics</span></a></li><li><a href="https://www.safaribooksonline.com/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z"></path></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>offers icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M35.9 20.6L27 15.5C26.1 15 24.7 15 23.7 15.5L14.9 20.6C13.9 21.1 13.2 22.4 13.2 23.4L13.2 41.4C13.2 42.4 13.9 43.7 14.9 44.2L23.3 49C24.2 49.5 25.6 49.5 26.6 49L35.9 43.6C36.8 43.1 37.6 41.8 37.6 40.8L37.6 23.4C37.6 22.4 36.8 21.1 35.9 20.6L35.9 20.6ZM40 8.2C39.1 7.6 37.6 7.6 36.7 8.2L30.2 11.9C29.3 12.4 29.3 13.2 30.2 13.8L39.1 18.8C40 19.4 40.7 20.6 40.7 21.7L40.7 39C40.7 40.1 41.4 40.5 42.4 40L48.2 36.6C49.1 36.1 49.8 34.9 49.8 33.8L49.8 15.6C49.8 14.6 49.1 13.3 48.2 12.8L40 8.2 40 8.2ZM27 10.1L33.6 6.4C34.5 5.9 34.5 5 33.6 4.5L26.6 0.5C25.6 0 24.2 0 23.3 0.5L16.7 4.2C15.8 4.7 15.8 5.6 16.7 6.1L23.7 10.1C24.7 10.6 26.1 10.6 27 10.1ZM10.1 21.7C10.1 20.6 10.8 19.4 11.7 18.8L20.6 13.8C21.5 13.2 21.5 12.4 20.6 11.9L13.6 7.9C12.7 7.4 11.2 7.4 10.3 7.9L1.6 12.8C0.7 13.3 0 14.6 0 15.6L0 33.8C0 34.9 0.7 36.1 1.6 36.6L8.4 40.5C9.3 41 10.1 40.6 10.1 39.6L10.1 21.7 10.1 21.7Z"></path></g></svg><span>Offers &amp; Deals</span></a><ul class="flyout"><li><a href="https://www.safaribooksonline.com/oreilly-newsletters/" class="l2 nav-icn"><span>Newsletters</span></a></li></ul></li><li class="nav-highlights"><a href="https://www.safaribooksonline.com/u/001o00000169U9HAAU/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" width="20" height="20" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z"></path></g></svg><span>Highlights</span></a></li><li><a href="https://www.safaribooksonline.com/u/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://www.safaribooksonline.com/public/support" class="l1 no-icon">Support</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="https://www.safaribooksonline.com/u/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a><span class="l2 t-nag-notification" id="nav-nag"><strong class="trial-green">10</strong> days left in your trial.
  
  

  
    
      

<a class="" href="https://www.safaribooksonline.com/subscribe/">Subscribe</a>.


    
  

  

</span></li><li><a href="https://www.safaribooksonline.com/public/support" class="l2">Support</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Node.js Recipes: A Problem-Solution Approach
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9781430260585/chapter/9781430260585_Ch09.xhtml" data-for-analytics="9781430260585:9781430260585_Ch09.xhtml" aria-label="Add to Queue"><span>Add to Queue</span></button></li><li class="js-font-control-panel font-control-activator"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml&amp;text=Node.js%20Recipes%3A%20A%20Problem-Solution%20Approach&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%20CHAPTER%209%3A%20Using%20Web%20Server%20Frameworks&amp;body=https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml%0D%0Afrom%20Node.js%20Recipes%3A%20A%20Problem-Solution%20Approach%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
        
        



 <!--[if lt IE 9]>
  
<![endif]-->



  <script defer="" src="./CHAPTER 9_ Using Web Server Frameworks - Node.js Recipes_ A Problem-Solution Approach_files/djangoMessagesPage.845b17d78025.js"></script>


        
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch08.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">CHAPTER 8: Creating a WebSocket Server</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch10.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">CHAPTER 10: Connecting to a Data Store</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content" style="transform: none;"><div class="annotator-wrapper"><p class="ChapterNumber"><a id="Chap_9"></a>CHAPTER 9</p>
<p class="chapimage"><img src="./CHAPTER 9_ Using Web Server Frameworks - Node.js Recipes_ A Problem-Solution Approach_files/frontdot.jpg" alt="image" width="82" height="25" data-mfp-src="/library/view/nodejs-recipes-a/9781430260585/images/frontdot.jpg"></p>
<p class="ChapterTitle">Using Web Server Frameworks<a id="cXXX.486a"></a></p>
<div>
<p class="noindent">Node.js is a natural fit for building a web server. Because of this, many developers have built web server applications. Some of these have gone on to become open source frameworks and available to any developer wishing to develop a Node.js web server. In this chapter you will see examples of utilizing these frameworks in order to build a Node.js web server.</p>
<p class="indent">First you will examine one of the most popular Node.js frameworks, Express. You will gain an understanding of how to utilize Express for building a web application. You will also see how to utilize the tools that are packaged with Express to scaffold an application quickly. Express also provides an easy way to route requests that will allow you to create logical routes and build out an API by using the framework.</p>
<p class="indent">Aside from Express there are several other frameworks that you will examine in this chapter that allow you to create a Node.jsbased web application. The next frameworks that you will investigate are all slightly different in their implementation to Express but will allow you to see that there are various ways in which you can create a Node.js application. These include the following:</p>
<ul class="bulleted">
<li>Geddy</li>
<li>Yahoo! Mojito</li>
<li>Flatiron</li>
</ul>
<p id="Sec1" class="Heading1">9-1. Getting Started with Express </p>
<div>
<p id="Sec2" class="Heading2_2">Problem</p>
<p class="noindent">You want to get up and running with the Express Node.js application framework.</p>
</div>
<div>
<p id="Sec3" class="Heading2">Solution</p>
<p class="noindent">There are several methods that you can utilize to get started with Express. In this solution, <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#list1" id="_list1">Listing 9-1</a>, you will build a web server with Express that will perform several tasks.</p>
<p class="indent">First, your server will use Express middleware to log requests that are made to the server. Your server will also serve static files from the directory in which the script is being executed. These static files<a id="cXXX.479"></a> will be compressed with gzip as they are served. In addition to these actions your Express server will be able to perform simple authentication and provide a fallback response to any addresses that cannot be served by static pages.</p>
<p class="indent">You will also see how to get and set many Express settings and how to enable and disable them. You will also create a method to set different configurations for your application based on whether you are serving content in development mode or in a production environment. To get started, you must first install the Express framework by using npm. This is done either by running the command <span class="FontName1">$ npm install express</span><a id="cXXX.480"></a> or globally as <span class="FontName1">$ npm install g</span> express; you will then be able to get started with Express.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#_list1" id="list1">Listing 9-1</a></i></b>.&nbsp;&nbsp;Getting Started with Express</p>
<pre><span class="FontName1">/**</span><br><span class="FontName1">* Getting started with ExpressJS</span><br><span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var express = require('express'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app = express();</span><br><span class="FontName1">// use middleware</span><br><span class="FontName1">app.use(express.logger());</span><br><span class="FontName1">app.use(express.compress());</span><br><span class="FontName1">app.use(express.static(__dirname));</span><br><span class="FontName1">app.use(express.basicAuth(function(username, password) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return username == 'shire' &amp; password == 'baggins';</span><br><span class="FontName1">}));</span><br><span class="FontName1">// a simple route</span><br><span class="FontName1">app.get('/blah', function(req, res) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.send(app.get('default'));</span><br><span class="FontName1">});</span><br><span class="FontName1">// a default handler</span><br><span class="FontName1">app.use(function(req, res) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.send(app.get('default'));</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">// settings</span><br><span class="FontName1">console.log(app.get('env'));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // development</span><br><span class="FontName1">console.log(app.get('trust proxy')); // undefined</span><br><span class="FontName1">app.disable('trust proxy');</span><br><span class="FontName1">console.log(app.get('trust proxy')); // false</span><br><span class="FontName1">console.log(app.get('jsonp callback name'));</span><br><span class="FontName1">console.log(app.get('json replacer'));</span><br><span class="FontName1">console.log(app.get('json spaces'));</span><br><span class="FontName1">console.log(app.get('case sensitive routing'));</span><br><span class="FontName1">console.log(app.get('strict routing'));</span><br><span class="FontName1">console.log(app.get('view cache'));</span><br><span class="FontName1">console.log(app.get('view engine'));</span><br><span class="FontName1">console.log(app.get('views'));</span><br>&nbsp;<br><span class="FontName1">// configurations</span><br><span class="FontName1">app.configure('development', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app.set('default', 'express development site');</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">app.configure('production', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app.set('default', 'express production site');</span><br><span class="FontName1">});</span><br><span class="FontName1">// app.engine('jade', require('jade').__express);</span><br><span class="FontName1">app.listen(8080);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// same as http.server.listen</span></pre>
</div>
<div>
<p id="Sec4" class="Heading2">How It Works</p>
<p class="noindent">Express is an application framework designed for Node.js. It is a highly flexible framework that allows you to build a Node.js application to suit your needs. In the solution in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#list1">Listing 9-1</a> you created a web server that would perform several tasks. In order for this to happen, you first must install the Express Node.js module. This can be done either local to the project you are working on, with <span class="FontName1">$ npm install express</span>, or globally as <span class="FontName1">$ npm install g express</span>.</p>
<p class="indent">Once you have installed Express, you can then incorporate it into your project. You must include the framework  <span class="FontName1">require('express')</span>, and then you tell Express to create an application by instantiating the express object. This creates a reference to the app variable in your solution, which will give access to the Express API.</p>
<p class="indent">The first thing you can see with this solution is a cluster of calls to <span class="FontName1">app.use()</span><a id="cXXX.481"></a> (see <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#list2" id="_list2">Listing 9-2</a>). This function comes from one of Expresss main dependenciesConnectwhich is an application middleware framework built for Node.js by Sencha Labs. The following snippet is from the Express implementation of <span class="FontName1">app.use()</span>. This shows you how this .use() call is extended from Connect.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#_list2" id="list2">Listing 9-2</a></i></b>.&nbsp;&nbsp;app.use in express/lib/application.js</p>
<pre><span class="FontName1">app.use = function(route, fn){</span><br>&nbsp;&nbsp;<span class="FontName1">var app;</span><br>&nbsp;&nbsp;<span class="FontName1">// default route to '/'</span><br>&nbsp;&nbsp;<span class="FontName1">if ('string' != typeof route) fn = route, route = '/';</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">// express app</span><br>&nbsp;&nbsp;<span class="FontName1">if (fn.handle &amp;&amp; fn.set) app = fn;</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">// restore .app property on req and res</span><br>&nbsp;&nbsp;<span class="FontName1">if (app) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app.route = route;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fn = function(req, res, next) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var orig = req.app;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app.handle(req, res, function(err){</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">req.__proto__ = orig.request;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.__proto__ = orig.response;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">next(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">connect.proto.use.call(this, route, fn);</span><br>&nbsp;&nbsp;<span class="FontName1">// mounted an app</span><br>&nbsp;&nbsp;<span class="FontName1">if (app) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app.parent = this;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app.emit('mount', this);</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">return this;</span><br><span class="FontName1">};</span></pre>
<p class="indent">You can see from this code that the <span class="FontName1">app.use()</span> method<a id="cXXX.482"></a> is run through some custom logic, which includes ensuring that the method signature is that which is expected, that the request and response are properly passed along, all before the <span class="FontName1">.use()</span> method from Connect is called.</p>
<p class="indent">What this means is that when you call <span class="FontName1">app.use(&lt;function&gt;)</span> in your solution, you are either making available a generic route with a special middleware function or setting an explicit route. In the solution you first use this to call <span class="FontName1">express.logger()</span>.</p>
<p class="indent">The <span class="FontName1">express.logger()</span> middleware, when added to an Express application, is used to log every request on the server. In this solution, when you run the Express application and navigate to your Express site, the <span class="FontName1">express.logger()</span><a id="cXXX.483"></a> application will log something similar to the following:</p>
<p class="noindent2"><b><i>Listing 9-3</i></b>.&nbsp;&nbsp;express.logger() in Action</p>
<pre><span class="FontName1">&lt; 127.0.0.1 - - [Tue, 16 Jul 2013 00:26:22 GMT] "GET / HTTP/1.1" 401 - "-" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:22.0) Gecko/20100101 Firefox/22.0"</span><br><span class="FontName1">&lt; 127.0.0.1 - - [Tue, 16 Jul 2013 00:26:27 GMT] "GET / HTTP/1.1" 200 24 "-" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:22.0) Gecko/20100101 Firefox/22.0"</span></pre>
<p class="indent">The next middleware that you utilize is <span class="FontName1">express.compress()</span><a id="cXXX.484"></a>. This middleware will compress the content with gzip. For example, a JavaScript file that is 1.3 KB (uncompressed) will serve at approximately 518 B when the <span class="FontName1">express.compress()</span> middleware is added.</p>
<p class="indent">After <span class="FontName1">express.compress()</span> you add the middleware <span class="FontName1">express.static()</span> to your application. Express uses <span class="FontName1">express.static</span> to point to a directory that you wish to use as a static file handler. For example you can use this to serve your static JavaScript, HTML, and CSS files. The case for <span class="FontName1">express.static()</span><a id="cXXX.485"></a> is interesting for discovering the use of <span class="FontName1">app.use()</span>. As shown in the solution, you simply use the functional handler of <span class="FontName1">app.use()</span> and place the static middleware there. However, it may be that the static content you wish to serve is located in an obscure directory in your application, or you simply wish to rename the route to static content to something else. You can do this easily by just naming a route for the static handler. For example, if your static content resides in the subdirectory <span class="FontName1">/content/shared/static/</span> and you wish to serve that as <span class="FontName1">/static</span>, your <span class="FontName1">app.use()</span> would change as follows:</p>
<pre><span class="FontName1">//Original</span><br><span class="FontName1">app.use(express.static(__dirname + '/content/shared/static'));</span><br><span class="FontName1">//Altered route</span><br><span class="FontName1">App.use('/static',express.static(__dirname + '/content/shared/static'));</span></pre>
<p class="indent">The next middleware that you connect to Express is the <span class="FontName1">express.basicAuth()</span> middleware. This middleware will allow you to implement authentication in a rudimentary manner to grant access to your Express application. In this solution you provide a callback, then directly check the credentials within this callback that is provided from the <span class="FontName1">basicAuth()</span> middleware.</p>
<p class="indent">The final example of <span class="FontName1">app.use()</span> in your solution is to set the default response for generalized routes for your application. This is where you provide a callback with a request and a response. In the section of the solution you also see the use of <span class="FontName1">app.get()</span>.</p>
<p class="indent">The Express method <span class="FontName1">app.get()</span><a id="cXXX.486"></a> has two main roles. The first role is the routing role. This is <span class="FontName1">app.HTTP_VERB</span>, meaning you will be handling any request that is an HTTP GET request. You will see more about this use of <span class="FontName1">app.get()</span> in later sections. The second role, as you see in the callback for the default route, is to retrieve a setting that you have set for your Express app by using the <span class="FontName1">app.set()</span> method.</p>
<p class="indent">The <span class="FontName1">app.set()</span> method<a id="cXXX.487"></a> is used to alter settings in your application. The signature is <span class="FontName1">app.set(&lt;name&gt;, &lt;value&gt;)</span>. In this solution you set a couple of variables. One was the default variable, which set the text that you want to serve from the default route in your web server.</p>
<p class="indent">There are a few settings that are used as environment variables for an Express application. Some, like <span class="FontName1">jsonp callback name</span>, are set to callback by default but could be set to any value you wish for your JSON with padding (JSONP) methods. Others, such as <span class="FontName1">'trust proxy'</span>, show the state of the setting. In the example you see the default of the <span class="FontName1">trust proxy</span> setting is undefined. You then utilize the <span class="FontName1">app.disable('trust proxy')</span> method to set the value to false. This could also be set to true using the <span class="FontName1">app.enable()</span>. Also, there is the <span class="FontName1">env</span> variable, which is the environment that the Node.js process is running as. You then use to configure options that you wish to keep different in the development and production environments.</p>
<p class="indent">This is the basic API that Express provides. You can use this as a web server framework as is shown in this example or you can leverage the command-line capabilities of Express to generate an application as you will see in the following sections.</p>
</div>
<p id="Sec5" class="Heading1">9-2. Using Express to Generate an Application </p>
<div>
<p id="Sec6" class="Heading2_2">Problem</p>
<p class="noindent">You want to utilize Expresss command-line interface to quickly generate an application scaffold.</p>
</div>
<div>
<p id="Sec7" class="Heading2">Solution</p>
<p class="noindent">Express not only comes with the API that you saw outlined in the previous section but also allows you to create a web server capable of handling many of the boilerplate methods needed in a Node.js server, but it also can be utilized as a command-line application generator<a id="cXXX.488"></a>. <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#list4" id="_list4">Listing 9-4</a> demonstrates several methods for Express application generation.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#_list4" id="list4">Listing 9-4</a></i></b>.&nbsp;&nbsp;Express Application<a id="cXXX.486b"></a> Generation</p>
<pre><span class="FontName1">&gt; npm install -g express</span><br><span class="FontName1">&gt; mkdir myapp</span><br><span class="FontName1">&gt; cd myapp</span><br><span class="FontName1">&gt; express -h</span><br>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">Usage: express [options]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">Options:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-h, --help&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output usage information</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-V, --version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; output the version number</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-s, --sessions&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add session support</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-e, --ejs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; add ejs engine support (defaults to jade)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-J, --jshtml&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add jshtml engine support (defaults to jade)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-H, --hogan&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; add hogan.js engine support</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-c, --css &lt;engine&gt;&nbsp;&nbsp;add stylesheet &lt;engine&gt; support (less|stylus) (defaults to plain css)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-f, --force&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; force on non-empty directory</span><br><span class="FontName1">&gt; express</span><br><span class="FontName1">destination is not empty, continue? y</span><br><span class="FontName1">create : .</span><br><span class="FontName1">create : ./package.json</span><br><span class="FontName1">create : ./app.js</span><br><span class="FontName1">create : ./public</span><br><span class="FontName1">create : ./routes</span><br><span class="FontName1">create : ./routes/index.js</span><br><span class="FontName1">create : ./routes/user.js</span><br><span class="FontName1">create : ./public/images</span><br><span class="FontName1">create : ./public/javascripts</span><br><span class="FontName1">create : ./views</span><br><span class="FontName1">create : ./views/layout.jade</span><br><span class="FontName1">create : ./public/stylesheets</span><br><span class="FontName1">create : ./public/stylesheets/style.css</span><br>&nbsp;<br><span class="FontName1">install dependencies:</span><br>&nbsp;&nbsp;<span class="FontName1">$ cd . &amp;&amp; npm install</span><br><span class="FontName1">run the app:</span><br>&nbsp;&nbsp;<span class="FontName1">$ node app</span><br><span class="FontName1">&gt; express --sessions --ejs --css less --force</span><br>&nbsp;<br><span class="FontName1">create : .</span><br><span class="FontName1">create : ./package.json</span><br><span class="FontName1">create : ./app.js</span><br><span class="FontName1">create : ./public</span><br><span class="FontName1">create : ./routes</span><br><span class="FontName1">create : ./routes/index.js</span><br><span class="FontName1">create : ./routes/user.js</span><br><span class="FontName1">create : ./public/images</span><br><span class="FontName1">create : ./public/javascripts</span><br><span class="FontName1">create : ./views</span><br><span class="FontName1">create : ./views/index.ejs</span><br><span class="FontName1">create : ./public/stylesheets</span><br><span class="FontName1">create : ./public/stylesheets/style.less</span><br>&nbsp;<br><span class="FontName1">install dependencies:</span><br>&nbsp;&nbsp;<span class="FontName1">$ cd . &amp;&amp; npm install</span><br><span class="FontName1">run the app:</span><br>&nbsp;&nbsp;<span class="FontName1">$ node app</span></pre>
</div>
<div>
<p id="Sec8" class="Heading2">How It Works</p>
<p class="noindent">This command-line utility works by first installing the Express module to your machine with <span class="FontName1">npm install g express</span>. From here, you now have access to the express command-line utility. When you type express, you run a JavaScript file that is found in the bin file of the source.</p>
<p class="indent">First, you want to get an idea of what is accessible to you in the Express command-line tool. You do this by typing <span class="FontName1">express h</span> or <span class="FontName1">express --help</span>. This prints the list of command arguments that can accompany the <span class="FontName1">express</span> command. The first two are general output for the help text and the version of Express that you are utilizing.</p>
<p class="indent">The other options are set in the application by parsing the command-line arguments that are passed and added to an object called program by use of a module called commander<a id="cXXX.489"></a>.</p>
<p class="noindent2"><b><i>Listing 9-5</i></b>.&nbsp;&nbsp;Parsing Command-Line Arguments with commander</p>
<pre><span class="FontName1">program</span><br>&nbsp;&nbsp;<span class="FontName1">.version(version)</span><br>&nbsp;&nbsp;<span class="FontName1">.option('-s, --sessions', 'add session support')</span><br>&nbsp;&nbsp;<span class="FontName1">.option('-e, --ejs', 'add ejs engine support (defaults to jade)')</span><br>&nbsp;&nbsp;<span class="FontName1">.option('-J, --jshtml', 'add jshtml engine support (defaults to jade)')</span><br>&nbsp;&nbsp;<span class="FontName1">.option('-H, --hogan', 'add hogan.js engine support')</span><br>&nbsp;&nbsp;<span class="FontName1">.option('-c, --css &lt;engine&gt;', 'add stylesheet &lt;engine&gt; support (less|stylus) (defaults to plain css)')</span><br>&nbsp;&nbsp;<span class="FontName1">.option('-f, --force', 'force on non-empty directory')</span><br>&nbsp;&nbsp;<span class="FontName1">.parse(process.argv);</span></pre>
<p class="indent">Next, you create an Express application by using nothing by the default settings. This is done by navigating to the directory in which you wish to create your application and running the <span class="FontName1">express</span> command with zero arguments. You could also add a single argument naming an application name, <span class="FontName1">express myapp</span>, which will create a child directory by that name from where the script is executed.</p>
<p class="indent">When the express command-line application executes, aside from parsing the arguments as you saw above, it will immediately invoke a function that will pass in the path where the application is to be generated.</p>
<p class="noindent2"><b><i>Listing 9-6</i></b>.&nbsp;&nbsp;Generate Application</p>
<pre><span class="FontName1">(function createApplication(path) {</span><br>&nbsp;&nbsp;<span class="FontName1">emptyDirectory(path, function(empty){</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (empty || program.force) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">createApplicationAt(path);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">program.confirm('destination is not empty, continue? ', function(ok){</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (ok) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">process.stdin.destroy();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">createApplicationAt(path);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">abort('aborting');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">})(path);</span></pre>
<p class="indent">This will check to see if the directory in which you are creating your application is empty. It does this by utilizing Node.js and the file system module<a id="cXXX.490"></a>.</p>
<pre><span class="FontName1">function emptyDirectory(path, fn) {</span><br>&nbsp;&nbsp;<span class="FontName1">fs.readdir(path, function(err, files){</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err &amp;&amp; 'ENOENT' != err.code) throw err;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fn(!files || !files.length);</span><br>&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">}</span></pre>
<p class="indent">If the directory is not empty, Express will present you with a warning destination is not empty, continue? to which you can simply type in y and continue. The application will generate the application structure and scaffolding out your application according to the parameters that you provided. This is done with the <span class="FontName1">createApplicationAt()</span> function<a id="cXXX.491"></a>.</p>
<p class="indent">This method starts by creating the root directory of your application, then all of the directories that are required by your application. You can see that this will utilize the flags that you have set in order to make the application directory tree.</p>
<pre><span class="FontName1">mkdir(path, function(){</span><br>&nbsp;&nbsp;<span class="FontName1">mkdir(path + '/public');</span><br>&nbsp;&nbsp;<span class="FontName1">mkdir(path + '/public/javascripts');</span><br>&nbsp;&nbsp;<span class="FontName1">mkdir(path + '/public/images');</span><br>&nbsp;&nbsp;<span class="FontName1">mkdir(path + '/public/stylesheets', function(){</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">switch (program.css) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">case 'less':</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">write(path + '/public/stylesheets/style.less', less);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">break;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">case 'stylus':</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">write(path + '/public/stylesheets/style.styl', stylus);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">break;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">default:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">write(path + '/public/stylesheets/style.css', css);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">mkdir(path + '/routes', function(){</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">write(path + '/routes/index.js', index);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">write(path + '/routes/user.js', users);</span><br>&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">mkdir(path + '/views', function(){</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">switch (program.template) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">case 'ejs':</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">write(path + '/views/index.ejs', ejsIndex);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">break;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">case 'jade':</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">write(path + '/views/layout.jade', jadeLayout);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">write(path + '/views/index.jade', jadeIndex);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">break;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">case 'jshtml':</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">write(path + '/views/layout.jshtml', jshtmlLayout);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">write(path + '/views/index.jshtml', jshtmlIndex);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">break;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">case 'hjs':</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">write(path + '/views/index.hjs', hoganIndex);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">break;</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;<span class="FontName1">});</span></pre>
<p class="indent">After the directory structure is set, the root application JavaScript file will be generated along with a properly configured <span class="FontName1">package.json</span> file<a id="cXXX.492"></a>. This is done by simply replacing tokens that are set based upon the settings you pass the Express generator on the command line.</p>
<pre><span class="FontName1">// CSS Engine support</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">switch (program.css) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">case 'less':</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app = app.replace('{css}', eol + 'app.use(require(\'less-middleware\')({ src: __dirname + \'/public\' }));');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">break;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">case 'stylus':</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app = app.replace('{css}', eol + 'app.use(require(\'stylus\').middleware(__dirname + \'/public\'));');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">break;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">default:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app = app.replace('{css}', ");</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// Session support</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app = app.replace('{sess}', program.sessions</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">? eol + 'app.use(express.cookieParser(\'your secret here\'));' + eol + 'app.use(express.session());'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">: ");</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// Template support</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app = app.replace(':TEMPLATE', program.template);</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// package.json</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var pkg = {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">name: 'application-name'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">, version: '0.0.1'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">, private: true</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">, scripts: { start: 'node app.js' }</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">, dependencies: {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">express: version</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (program.template) pkg.dependencies[program.template] = '*';</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// CSS Engine support</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">switch (program.css) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">case 'less':</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">pkg.dependencies['less-middleware'] = '*';</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">break;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">default:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (program.css) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">pkg.dependencies[program.css] = '*';</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">write(path + '/package.json', JSON.stringify(pkg, null, 2));</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">write(path + '/app.js', app);</span></pre>
<p class="indent">You now have a functioning Express application that has been built via the applications command-line interface tool. You were able to see that the default template rendering that comes with Express is utilizing a framework called Jade. In the next section you will see how you can leverage this tool in order to create minimal and clean HTML templates for your Express application.</p>
</div>
<p id="Sec9" class="Heading1">9-3. Rendering HTML with Jade </p>
<div>
<p id="Sec10" class="Heading2_2">Problem</p>
<p class="noindent">You have generated an Express application by using the command <span class="FontName1">$ express</span>. By default, this application will utilize the Jade HTML template<a id="cXXX.493"></a> framework so you need to be able to understand and utilize this framework in your Node.js application.</p>
</div>
<div>
<p id="Sec11" class="Heading2">Solution</p>
<p class="noindent">Jade was created as a templating language specifically for Node.js. It is used by default with Express so it is important to gain some understanding of it. It is built as a minimalist templating engine; it can be used to build HTML from a very terse template.</p>
<p class="indent">In this solution you will examine and build on the default templates that are generated with Express. These are located in &lt;appRoot&gt;/views.</p>
<p class="noindent2"><b><i>Listing 9-7</i></b>.&nbsp;&nbsp;/views/layout.jade</p>
<pre><span class="FontName1">doctype 5</span><br><span class="FontName1">html</span><br>&nbsp;&nbsp;<span class="FontName1">head</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">title= title</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">link(rel='stylesheet', href='/stylesheets/style.css')</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//if lt IE 8</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">script(src='/old_ie.js')</span><br>&nbsp;&nbsp;<span class="FontName1">body</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">block content</span></pre>
<p class="noindent2"><b><i>Listing 9-8</i></b>.&nbsp;&nbsp;/views/index.jade</p>
<pre><span class="FontName1">extends layout</span><br>&nbsp;<br>&nbsp;<br><span class="FontName1">block content</span><br>&nbsp;&nbsp;<span class="FontName1">h1= title</span><br>&nbsp;&nbsp;<span class="FontName1">p.a_class Welcome to #{title}</span><br>&nbsp;&nbsp;<span class="FontName1">#an_id this is a div which has an ID</span><br>&nbsp;&nbsp;<span class="FontName1">label A range slider:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">input(type='range')</span><br>&nbsp;&nbsp;<span class="FontName1">#ckbx</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">label A checkbox:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">input(type='checkbox', checked)</span><br>&nbsp;&nbsp;<span class="FontName1">ul</span><br>&nbsp;&nbsp;<span class="FontName1">li.odd: a(href='#', title='one') one</span><br>&nbsp;&nbsp;<span class="FontName1">li.even: a(href='#', title='two') two</span><br>&nbsp;&nbsp;<span class="FontName1">li.odd: a(href='#', title='three') three</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">case flag</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">when 0: #zero there is no flag</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">when 1: #one there is a single flag</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">default: #other other</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">- if (items.length)</span><br>&nbsp;&nbsp;<span class="FontName1">ul</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">- items.forEach(function(item){</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">li= item</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">- })</span></pre>
<p class="noindent2"><b><i>Listing 9-9</i></b>.&nbsp;&nbsp;Routes/index.js</p>
<pre><span class="FontName1">/*</span><br>&nbsp;<span class="FontName1">* GET home page.</span><br>&nbsp;<span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">exports.index = function(req, res){</span><br>&nbsp;&nbsp;<span class="FontName1">res.render('index', { title: 'Express', flag: 0, items: ['a', 'b', 'c'] });</span><br><span class="FontName1">};</span></pre>
</div>
<div>
<p id="Sec12" class="Heading2">How It Works</p>
<p class="noindent">Jade works by parsing its own syntax and then rendering that into the appropriate and corresponding HTML output. Take a look at your layout.jade file. This file declares a doctype, specifically the HTML5 doctype. This is done by typing doctype 5, or alternatively !!! 5. These are the shorthand notations for the document types. While this isnt too drastic of a shortcut for the terse HTML5 document type, you can see from <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#list10" id="_list10">Listing 9-10</a> that this can become extremely useful if you are utilizing a transitional document type in your Express application.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#_list10" id="list10">Listing 9-10</a></i></b>.&nbsp;&nbsp;Express.jss Available Document Types</p>
<pre><span class="FontName1">var doctypes = exports.doctypes = {</span><br>&nbsp;&nbsp;<span class="FontName1">'5': '&lt;!DOCTYPE html&gt;',</span><br>&nbsp;&nbsp;<span class="FontName1">'default': '&lt;!DOCTYPE html&gt;',</span><br>&nbsp;&nbsp;<span class="FontName1">'xml': '&lt;?xml version="1.0" encoding="utf-8" ?&gt;',</span><br>&nbsp;&nbsp;<span class="FontName1">'transitional': '&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "</span><span class="FontName1"><a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</a></span><span class="FontName1">"&gt;',</span><br>&nbsp;&nbsp;<span class="FontName1">'strict': '&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "</span><span class="FontName1"><a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd</a></span><span class="FontName1">"&gt;',</span><br>&nbsp;&nbsp;<span class="FontName1">'frameset': '&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "</span><span class="FontName1"><a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd</a></span><span class="FontName1">"&gt;',</span><br>&nbsp;&nbsp;<span class="FontName1">'1.1': '&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "</span><span class="FontName1"><a href="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</a></span><span class="FontName1">"&gt;',</span><br>&nbsp;&nbsp;<span class="FontName1">'basic': '&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.1//EN" "</span><span class="FontName1"><a href="http://www.w3.org/TR/xhtml-basic/xhtml-basic11.dtd">http://www.w3.org/TR/xhtml-basic/xhtml-basic11.dtd</a></span><span class="FontName1">"&gt;',</span><br>&nbsp;&nbsp;<span class="FontName1">'mobile': '&lt;!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.2//EN" "</span><span class="FontName1"><a href="http://www.openmobilealliance.org/tech/DTD/xhtml-mobile12.dtd">http://www.openmobilealliance.org/tech/DTD/xhtml-mobile12.dtd</a></span><span class="FontName1">"&gt;'</span><br><span class="FontName1">};</span></pre>
<p class="indent">Next you see that HTML elements are written in a shorthand manner, which allows for the highly readable markup. Elements are created and inner content is nested by either two spaces or a tab to indicate they are relative to the parent. You can see this is evident with the title element, nested below the head element. Attributes within an element, such as the src found in the script element, are set within parentheses. Comments are translated from a single line C style comment to an HTML comment so you can see that adding a conditional parameter to test for older versions of Internet Explorer is not complex. Once all the Jade rendering is completed for this HTML block, up to the &lt;body&gt; element, you can see that this relatively short and simple markup is translated to the following HTML:</p>
<pre><span class="FontName1">&lt;!DOCTYPE html&gt;</span><span class="FontName1">&lt;html&gt;</span><br><span class="FontName1">&lt;head&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;title&gt;Express&lt;/title&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;link rel="stylesheet" href="/stylesheets/style.css"&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;!--[if lt IE 8]&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;script src=/zomg_old_ie.js&gt;&lt;/script&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;![endif]--&gt;</span><br><span class="FontName1">&lt;/head&gt;</span><br><span class="FontName1">&lt;body&gt;</span><br><span class="FontName1">&lt;/body&gt;</span><br><span class="FontName1">&lt;/html&gt;</span></pre>
<p class="indent">As you examine the index.jade file, you see many of the same things as the layout.jade file. You can see that you have named which Jade file this is extending with extends layout. You also have a named block, block content, which matches the corresponding block on the layout file.</p>
<p class="indent">Also present in this file is a sampling of the template-rendering capabilities of Jade. You have an h1= title snippet. This snippet will create an H1 element in your code but will also take the object from the index render code in the routes/index.js file and add the title to the HTML markup. Other portions of the template object that you created were the flag attribute and the items array. These items are also parsed into HTML. The flag, as you can see, you use in a case statement within the code. This allows for conditional markup. Also you can see that you are able to iterate through your array of items and render a list item for each one. When doing this sort of iteration, you must preface the code you are using to iterate with a hyphen. Then you can just write JavaScript behind this hyphen in order to generate the layout you desire. This can greatly improve your markup generation when you are building large lists of things, and it will save you time in your development cycles. The other method to iterate through this array would be to write each item in items and then li= item (indented below).</p>
<p class="indent">Jade also has shorthand for adding classes and IDs to your HTML tags. You can see where <span class="FontName1">p.a_class</span> will generate a &lt;p&gt; tag and add the class <span class="FontName1">a_class</span> to that tag. Classes can also be chained together, allowing for any number of class names to be tethered to a tag. Adding an ID to a tag is just as easy. Simply use #, prepended to a string of text and that string of text will become the ID of the tag. However, you can also create a &lt;div&gt; tag with an ID without naming the tag. By simply adding <span class="FontName1">'#an_id</span>, you generate a <span class="FontName1">&lt;div id='an_id'&gt;</span> tag in your markup without the need to type the extra three characters to name the div.</p>
<p class="indent">If you create a Node.js application with Express and Jade, you have the power to create clean markup with this powerful template engine.</p>
</div>
<p id="Sec13" class="Heading1">9-4. Routing<a id="cXXX.494"></a> with Express</p>
<div>
<p id="Sec14" class="Heading2_2">Problem</p>
<p class="noindent">You have created an application with Express. Your URL structure within your application has grown in complexity so you need a powerful routing mechanism for connecting these URLs to the proper handlers.</p>
</div>
<div>
<p id="Sec15" class="Heading2">Solution</p>
<p class="noindent">Express allows for an easy method for invoking proper routes in your Node.js application. You are capable of handling routes as external modules or as inline callbacks within the route handlers of your Express application. <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#list11" id="_list11">Listing 9-11</a> gives examples of both of these types of routing behaviors. This builds on the server file from Section 9-2. You can see that the routes that have been added are highlighted in bold in this listing.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#_list11" id="list11">Listing 9-11</a></i></b>.&nbsp;&nbsp;Routing with Express</p>
<pre><span class="FontName1">/**</span><br>&nbsp;<span class="FontName1">* Module dependencies.</span><br>&nbsp;<span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var express = require('express')</span><br>&nbsp;&nbsp;<span class="FontName1">, routes = require('./routes')</span><br>&nbsp;&nbsp;<span class="FontName1">, user = require('./routes/user')</span><br>&nbsp;&nbsp;<span class="FontName1">, http = require('http')</span><br>&nbsp;&nbsp;<span class="FontName1">, path = require('path');</span><br>&nbsp;<br><span class="FontName1">var app = express();</span><br><span class="FontName1">// all environments</span><br><span class="FontName1">app.set('port', process.env.PORT || 3000);</span><br><span class="FontName1">app.set('views', __dirname + '/views');</span><br><span class="FontName1">app.set('view engine', 'jade');</span><br><span class="FontName1">app.use(express.favicon());</span><br><span class="FontName1">app.use(express.logger('dev'));</span><br><span class="FontName1">app.use(express.bodyParser());</span><br><span class="FontName1">app.use(express.methodOverride());</span><br><span class="FontName1">app.use(app.router);</span><br><span class="FontName1">app.use(express.static(path.join(__dirname, 'public')));</span><br>&nbsp;<br><span class="FontName1">// development only</span><br><span class="FontName1">if ('development' == app.get('env')) {</span><br>&nbsp;&nbsp;<span class="FontName1">app.use(express.errorHandler());</span><br><span class="FontName1">}</span><br>&nbsp;<br><b>app.get('/', routes.index);</b><br><b>app.get('/user/:id', function(req, res) {</b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>res.send('you supplied param ' + req.params.id);</b><br><b>});</b><br><b>app.get('/users', user.list);</b><br><b>app.post('/user/:id', function(req, res) {</b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>console.log('update user' + req.params.id);</b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>res.send('successfully updated');</b><br><b>});</b><br>&nbsp;<br><span class="FontName1">http.createServer(app).listen(app.get('port'), function(){</span><br>&nbsp;&nbsp;<span class="FontName1">console.log('Express server listening on port ' + app.get('port'));</span><br><span class="FontName1">});</span></pre>
</div>
<div>
<p id="Sec16" class="Heading2">How It Works</p>
<p class="noindent">Express handles routes by utilizing an <span class="FontName1">app.VERB</span> paradigm where VERB is an HTTP verb. This means that you can route an application for specific types of HTTP requests, which you will see more of when you build an API with Express in Section 9-6.</p>
<p class="indent">The <span class="FontName1">app.VERB</span> methods<a id="cXXX.495"></a> all behave similarly to the middleware routing that you saw in Section 9-1. They each receive a route, which points to the accessing URL for the request, relative to the application root. They also receive a callback function. If you wish to handle all requests to a certain route a particular way, regardless of the HTTP verb that is supplied, you can use the <span class="FontName1">app.all()</span> function<a id="cXXX.496"></a> to do just that.</p>
<p class="indent">In this solution there are several varieties of routes that are used. First, you see that there is a route for the root path of /. This points to a routes module and the index method that resides there. This index method has a request and response object that are then handled by sending a response, which in this case is rendered using Jade, but does not necessarily need to be anything but what an HTTP response could send.</p>
<p class="indent">You can also see that routing requests can provide generic parameters. This is evident with the route users/:id. Here, the :id is the parameter that you will pass to the route. This is not limited to a singular parameter; in fact you can see from the source code snippet in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#list12" id="_list12">Listing 9-12</a> that any number of parameters may be added to a route.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#_list12" id="list12">Listing 9-12</a></i></b>.&nbsp;&nbsp;Find a Matching Route, then Parse the Remaining to be a Portion of the Parameters</p>
<pre><span class="FontName1">Route.prototype.match = function(path){</span><br>&nbsp;&nbsp;<span class="FontName1">var keys = this.keys</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">, params = this.params = []</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">, m = this.regexp.exec(path);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">if (!m) return false;</span><br>&nbsp;&nbsp;<span class="FontName1">for (var i = 1, len = m.length; i &lt; len; ++i) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var key = keys[i - 1];</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var val = 'string' == typeof m[i]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">? decodeURIComponent(m[i])</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">: m[i];</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (key) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">params[key.name] = val;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">params.push(val);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">return true;</span><br><span class="FontName1">};</span></pre>
<p class="indent">This logic depends on the regular expression for the given route as you defined it in your app.js file. For the users/:id route, this regular expression is built and will become that which is shown next.</p>
<p class="noindent2"><b><i>Listing 9-13</i></b>.&nbsp;&nbsp;Regular Expression for the user/:id Route</p>
<pre><span class="FontName1">/^\\/user\\/(?:([^\\/]+?))\\/?$/</span></pre>
<p class="indent">This creates a regular expression match of [/user/1, 1], if you had supplied the ID of one. If you were to add an additional parameter to this route (for example user/:role/:id or something similar), the regular expression simply grows to look like the following.</p>
<p class="noindent2"><b><i>Listing 9-14</i></b>.&nbsp;&nbsp;Regular Expression for /user/:role/:id</p>
<pre><span class="FontName1">/^\\/user\\/(?:([^\\/]+?))\\/(?:([^\\/]+?))\\/?$/</span></pre>
<p class="indent">This route produces the regular expression match of [/user/eng/1, eng, 1]. These matches are then added to the params array for the route.</p>
<p class="indent">You can use Express to build routes and parameterized routes. In the next section you will get a glimpse of how you might go about handling a failed request in your Node.js application.</p>
</div>
<p id="Sec17" class="Heading1">9-5. Handling Failed Requests in Your Application </p>
<div>
<p id="Sec18" class="Heading2_2">Problem</p>
<p class="noindent">You have built an Express application in Node.js and have even designated routing and request handling. However, you need to be able to properly handle a failed request in your application.</p>
</div>
<div>
<p id="Sec19" class="Heading2">Solution</p>
<p class="noindent">Express is a robust framework that allows for you as a developer to handle many aspects of the application development process in your own way. This is evident when you are either building your Express routes or augmenting your settings by adding middleware to your Node.js application. Handling failed requests is also something that Express allows for, but about which it is not overly opinionated.</p>
<p class="indent">This failed request handling<a id="cXXX.497"></a> is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#list15" id="_list15">Listing 9-15</a>. These handlers must follow a certain pattern but can fit into your application where needed.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#_list15" id="list15">Listing 9-15</a></i></b>.&nbsp;&nbsp;Failed Request Handling in Express</p>
<pre><span class="FontName1">/**</span><br><span class="FontName1">* Getting started with ExpressJS</span><br><span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var express = require('express'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app = express();</span><br><span class="FontName1">// use middleware</span><br><span class="FontName1">app.use(express.logger());</span><br><span class="FontName1">app.use(express.compress());</span><br><span class="FontName1">app.use(express.static(__dirname));</span><br><span class="FontName1">app.use(express.basicAuth(function(username, password) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return username == 'shire' &amp; password == 'baggins';</span><br><span class="FontName1">}));</span><br><span class="FontName1">// a simple route</span><br><span class="FontName1">app.get('/blah', function(req, res, next) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>next(new Error('failing route'));</b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.send(app.get('blah'));</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">// a default handler</span><br><span class="FontName1">app.use(function(req, res) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.send(app.get('default'));</span><br><span class="FontName1">});</span><br>&nbsp;<br><b>app.use(function(err, req, res, next){</b><br>&nbsp;<b>console.error(err.stack);</b><br>&nbsp;<b>res.send(500, 'Oh no! Something failed');</b><br><b>});</b><br>&nbsp;<br><span class="FontName1">// configurations</span><br><span class="FontName1">app.configure('development', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app.set('default', 'express development site');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app.set('blah', 'blah blah blah');</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">app.configure('production', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app.set('default', 'express production site');</span><br><span class="FontName1">});</span><br><span class="FontName1">// app.engine('jade', require('jade').__express);</span><br><span class="FontName1">app.listen(8080); // same as http.server.listen</span></pre>
</div>
<div>
<p id="Sec20" class="Heading2">How It Works</p>
<p class="noindent">You built this solution in a similar way to the initial example you had built in Section 9-1. Highlighted in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#list15">Listing 9-15</a> are two important parts.</p>
<p class="indent">First, in order to simulate a failing route, you build in an error on the route /blah. This calls the <span class="FontName1">next()</span> route handler with a new <span class="FontName1">Error()</span> object passed into it. This allows the failed request routing to work, because without this handler the site will break.</p>
<p class="indent">The failed request routing is built by using the <span class="FontName1">app.use()</span> function<a id="cXXX.498"></a>. This then uses a default callback that includes an error parameter. When the <span class="FontName1">next()</span> function is called with an error, Express will utilize this error handler and utilize it as a failed request handler. In this way you can gracefully handle errors on your Node.js server.</p>
</div>
<p id="Sec21" class="Heading1">9-6. Designing a RESTful API with ExpressJS </p>
<div>
<p id="Sec22" class="Heading2_2">Problem</p>
<p class="noindent">When designing an API, many times you wish to leverage HTTP and create a representational state transfer (REST)architecture<a id="cXXX.236f"></a> for your application.<a id="cXXX.499"></a></p>
</div>
<div>
<p id="Sec23" class="Heading2">Solution</p>
<p class="noindent">In the previous sections you have seen how to build useful routes in Express. Because of the Express API allowing a route to target a specific HTTP verb, it becomes a natural fit for a REST-like API.</p>
<p class="indent">In this solution, you will create a simple REST API to interact with a data model consisting of products. These products are represented by a simple JavaScript object in this example, but they could easily be an object set and retrieved from a data store. The example is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#list16" id="_list16">Listing 9-16</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#_list16" id="list16">Listing 9-16</a></i></b>.&nbsp;&nbsp;A REST Interface<a id="cXXX.236x"></a><a id="cXXX.500"></a></p>
<pre><span class="FontName1">/**</span><br>&nbsp;<span class="FontName1">* Module dependencies.</span><br>&nbsp;<span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var express = require('express')</span><br>&nbsp;&nbsp;<span class="FontName1">, routes = require('./routes')</span><br>&nbsp;&nbsp;<span class="FontName1">, http = require('http')</span><br>&nbsp;&nbsp;<span class="FontName1">, path = require('path');</span><br>&nbsp;<br><span class="FontName1">var app = express();</span><br><span class="FontName1">// all environments</span><br><span class="FontName1">app.set('port', process.env.PORT || 3000);</span><br><span class="FontName1">app.set('views', __dirname + '/views');</span><br><span class="FontName1">app.set('view engine', 'jade');</span><br><span class="FontName1">app.use(express.favicon());</span><br><span class="FontName1">app.use(express.logger('dev'));</span><br><span class="FontName1">app.use(express.bodyParser());</span><br><span class="FontName1">app.use(express.methodOverride());</span><br><span class="FontName1">app.use(app.router);</span><br><span class="FontName1">app.use(express.static(path.join(__dirname, 'public')));</span><br>&nbsp;<br><span class="FontName1">// development only</span><br><span class="FontName1">if ('development' == app.get('env')) {</span><br>&nbsp;&nbsp;<span class="FontName1">app.use(express.errorHandler());</span><br><span class="FontName1">}</span><br><span class="FontName1">var products = [</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">{ id: 0, name: 'watch', description: 'Tell time with this amazing watch', price: 30.00 },</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">{ id: 1, name: 'sandals', description: 'Walk in comfort with these sandals', price: 10.00 },</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">{ id: 2, name: 'sunglasses', description: 'Protect your eyes in style', price: 25.00 }</span><br><span class="FontName1">];</span><br>&nbsp;<br><span class="FontName1">app.get('/', routes.index);</span><br><span class="FontName1">// curl -X GET</span> <span class="FontName1"><a href="http://localhost:3000/products">http://localhost:3000/products</a></span><br><span class="FontName1">app.get('/products', function(req, res) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.json(products);</span><br><span class="FontName1">});</span><br><span class="FontName1">// curl -X GET</span> <span class="FontName1"><a href="http://localhost:3000/products/2">http://localhost:3000/products/2</a></span><br><span class="FontName1">app.get('/products/:id', function(req, res) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (req.params.id &gt; (products.length - 1) || req.params.id &lt; 0) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.statusCode = 404;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.end('Not Found');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.json(products[req.params.id]);</span><br><span class="FontName1">});</span><br><span class="FontName1">// curl -X POST -d "name=flops&amp;description=sandals&amp;price=12.00"</span> <span class="FontName1"><a href="http://localhost:3000/products">http://localhost:3000/products</a></span><br><span class="FontName1">app.post('/products', function(req, res) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (typeof req.body.name === 'undefined') {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.statusCode = 400;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.end('a product name is required');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">products.push(req.body);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.send(req.body);</span><br><span class="FontName1">});</span><br><span class="FontName1">// curl -X PUT -d "name=flipflops&amp;description=sandals&amp;price=12.00"</span> <span class="FontName1"><a href="http://localhost:3000/products/3">http://localhost:3000/products/3</a></span><br><span class="FontName1">app.put('/products/:id', function(req, res) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (req.params.id &gt; (products.length -1) || req.params.id &lt; 0) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.statusCode = 404;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.end('No product found for that ID');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">products[req.params.id] = req.body;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.send(req.body);</span><br><span class="FontName1">});</span><br><span class="FontName1">// curl -X DELETE</span> <span class="FontName1"><a href="http://localhost:3000/products/2">http://localhost:3000/products/2</a></span><br><span class="FontName1">app.delete('/products/:id', function(req, res) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (req.params.id &gt; (products.length - 1) || req.params.id &lt; 0) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">req.statusCode = 404;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.end('No product found for that ID');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">products.splice(req.params.id, 1);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.json(products);</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">http.createServer(app).listen(app.get('port'), function(){</span><br>&nbsp;&nbsp;<span class="FontName1">console.log('Express server listening on port ' + app.get('port'));</span><br><span class="FontName1">});</span></pre>
</div>
<div>
<p id="Sec24" class="Heading2">How It Works</p>
<p class="noindent"><a id="cXXX.501"></a>REST is an application architecture pattern that can rely on HTTP requests to perform operations. These operations are typically in the form of common create, read, update, and delete methods on the server.</p>
<p class="indent">A typical REST interface will at least use HTTP GET and POST methods<a id="cXXX.238z"></a><a id="cXXX.502"></a> to perform these actions on the server. In this solution, however, you actually employed the use of the GET, PUT, POST, and DELETE HTTP verbs in order to create your API. The GET method you utilized to simply retrieve data from a resource. The POST method is used to create data, while the PUT method<a id="cXXX.238u"></a> is used to update existing data. And the DELETE method will remove the data from the data store.</p>
<p class="indent">You started by creating a data store of products, which was an array of objects in your code that contains three entries. Once your server is running you can fetch this data by sending an HTTP GET to <span class="FontName1"><a href="http://localhost:3000/products">http://localhost:3000/products</a></span> <span class="FontName1">.</span></p>
<pre><span class="FontName1">$ CURL -X GET</span> <span class="FontName1"><a href="http://localhost:3000/products">http://localhost:3000/products</a></span><br><span class="FontName1">[</span><br>&nbsp;&nbsp;<span class="FontName1">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"name": "watch",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"description": "Tell time with this amazing watch",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"price": 30</span><br>&nbsp;&nbsp;<span class="FontName1">},</span><br>&nbsp;&nbsp;<span class="FontName1">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"name": "sandals",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"description": "Walk in comfort with these sandals",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"price": 10</span><br>&nbsp;&nbsp;<span class="FontName1">},</span><br>&nbsp;&nbsp;<span class="FontName1">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"name": "sunglasses",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"description": "Protect your eyes in style",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"price": 25</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">]</span></pre>
<p class="indent">Now that you have created and fetched your data, you are able to insert a new record into the products data store. In your REST API you simply send a POST request toward the products route. If successful, and it must at least include a name for the product, it will return the item that you have just added:</p>
<pre><span class="FontName1">$ CURL -X POST -d "name=flops&amp;description=sandal%20things&amp;price=12.00"&nbsp;&nbsp;</span><span class="FontName1"><a href="http://localhost:3000/products">http://localhost:3000/products</a></span><br><span class="FontName1">{</span><br>&nbsp;&nbsp;<span class="FontName1">"name": "flops",</span><br>&nbsp;&nbsp;<span class="FontName1">"description": "sandal things",</span><br>&nbsp;&nbsp;<span class="FontName1">"price": "12.00"</span><br><span class="FontName1">}</span></pre>
<p class="indent">You now have created a new record, but you realize that the name you gave the product was incorrect. To update the name of the product, you need to send a PUT request<a id="cXXX.503"></a> to the server, but you must also know the :id that you wish to send it to. In your case you know that this is the fourth item in the array, so the :id becomes 3. In order to update the name you can now send the request, which will respond with the updated value in the data store:</p>
<pre><span class="FontName1">$ curl -X PUT -d "name=flip%20flops&amp;description=sandals&amp;price=12.00" </span> <span class="FontName1"><a href="http://localhost:3000/products/3">http://localhost:3000/products/3</a></span><br><span class="FontName1">{</span><br>&nbsp;&nbsp;<span class="FontName1">"name": "flip flops",</span><br>&nbsp;&nbsp;<span class="FontName1">"description": "sandals",</span><br>&nbsp;&nbsp;<span class="FontName1">"price": "12.00"</span><br><span class="FontName1">}</span></pre>
<p class="indent">After creating and updating this new record, you realize that the product sandals is no longer necessary in your product line. Because of this, you remove it by sending the DELETE HTTP request<a id="cXXX.239p"></a><a id="cXXX.504"></a> to that item, which will remove it entirely from the data store. This will also return the list of the products that are now available after removal of this item:</p>
<pre><span class="FontName1">$ curl -X DELETE</span> <span class="FontName1"><a href="http://localhost:3000/products/1">http://localhost:3000/products/1</a></span><br><span class="FontName1">[</span><br>&nbsp;&nbsp;<span class="FontName1">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"name": "watch",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"description": "Tell time with this amazing watch",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"price": 30</span><br>&nbsp;&nbsp;<span class="FontName1">},</span><br>&nbsp;&nbsp;<span class="FontName1">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"name": "sunglasses",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"description": "Protect your eyes in style",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"price": 25</span><br>&nbsp;&nbsp;<span class="FontName1">},</span><br>&nbsp;&nbsp;<span class="FontName1">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"name": "flip flops",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"description": "sandals",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"price": "12.00"</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">]</span></pre>
</div>
<p id="Sec25" class="Heading1">9-7. Up and Running with Geddy</p>
<div>
<p id="Sec26" class="Heading2_2">Problem</p>
<p class="noindent">You want to utilize the Geddy application<a id="cXXX.508a"></a> framework for Node.js to build your product.</p>
</div>
<div>
<p id="Sec27" class="Heading2">Solution</p>
<p class="noindent">To get started with Geddy, you first need to install the module via npm. If you install it globally, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#list17" id="_list17">Listing 9-17</a>, you will gain access to the application generators from any directory on your machine.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#_list17" id="list17">Listing 9-17</a></i></b>.&nbsp;&nbsp;<a id="cXXX.505"></a>Installing Geddy</p>
<pre><span class="FontName1">$ npm install g geddy</span></pre>
<p class="noindent2"><b><i>Listing 9-18</i></b>.&nbsp;&nbsp;Generate an Application in a Named Directory</p>
<pre><span class="FontName1">$ geddy gen app geddyapp</span><br><span class="FontName1">$ cd geddyapp</span></pre>
<p class="noindent2"><b><i>Listing 9-19</i></b>.&nbsp;&nbsp;Run the Application</p>
<pre><span class="FontName1">$ geddy</span></pre>
<p class="noindent2"><b><i>Listing 9-20</i></b>.&nbsp;&nbsp;Generate a New Model for the Application and Run the Application<a id="cXXX.506"></a></p>
<pre><span class="FontName1">$ geddy gen scaffold products name:default description price</span><br><span class="FontName1">$ geddy</span></pre>
<p class="indent">You can view this application as it is running by navigating in your browser to <span class="FontName1"><a href="http://localhost:4000/">http://localhost:4000</a></span>.</p>
</div>
<div>
<p id="Sec28" class="Heading2">How It Works </p>
<p class="noindent">Geddy works by installing a useful command-line tool that will allow you to generate applications and to scaffold out new functionality quickly and efficiently. Once this command-line tool is installed, you may simply build your first application by typing the command <span class="FontName1">$ geddy gen app &lt;appname&gt;</span>. This will generate a new application for you in the <span class="FontName1">appname</span> directory. The directory structure<a id="cXXX.507"></a> will look as follows:</p>
<pre><span class="FontName1">appname</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-app</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-controllers</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-helpers</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-models</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-views</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-config</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-lib</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-log</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-node_modules</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-public</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-css</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-img</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-js</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-test</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-controllers</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">-models</span></pre>
<p class="indent">You can see that this scaffolds out a working application that will have default models, views, controllers, and helpers within the application, allowing for testing of your application by default. To run the application, you used the command <span class="FontName1">$ geddy</span>, which will start the server running. <a id="cXXX.508"></a>The server is configured using either a production.js or a development.js file that is contained inside the config directory.</p>
<p class="noindent2"><b><i>Listing 9-21</i></b>.&nbsp;&nbsp;Configuration File</p>
<pre><span class="FontName1">var config = {</span><br>&nbsp;&nbsp;<span class="FontName1">detailedErrors: true</span><br><span class="FontName1">, debug: true</span><br><span class="FontName1">, hostname: null</span><br><span class="FontName1">, port: 4000</span><br><span class="FontName1">, model: {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">defaultAdapter: 'memory'</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">, sessions: {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">store: 'memory'</span><br>&nbsp;&nbsp;<span class="FontName1">, key: 'sid'</span><br>&nbsp;&nbsp;<span class="FontName1">, expiry: 14 * 24 * 60 * 60</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">module.exports = config;</span></pre>
<p class="indent">This creates several configuration options for standard features of an HTTP server such as the port and hostname, but it adds features like the adapter for data models, which you see will default to in-memory. Geddy is very robust in that it provides a versatile set of adapters for storage aside from the in-memory option. These options include PostgreSQL, MongoDB, and Riak. Once the application is running, you will see any requests to the server logged in your console.</p>
<pre><span class="FontName1">[Sat, 20 Jul 2013 19:47:42 GMT]&nbsp;&nbsp;127.0.0.1 - - [Sat Jul 20 2013 15:47:42 GMT-0400 (Eastern Daylight Time)] "GET / 1.1" 200 2645 "-" "Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1568.2 Safari/537.36"</span></pre>
<p class="indent">You next generated a scaffold for a products model in your application. This was done with the command <span class="FontName1">$ geddy gen scaffold products name:default description price</span>. This generates corresponding JavaScript or HTML view files in each of the <span class="FontName1">app/models</span>, <span class="FontName1">app/views/</span>, and <span class="FontName1">app/controllers</span> directories. You will notice that you set the name parameter of the products model with the attribute default. This sets it to be a required field in your application, which becomes evident when you view the products model file<a id="cXXX.509"></a>.</p>
<p class="noindent2"><b><i>Listing 9-22</i></b>.&nbsp;&nbsp;Products Model File</p>
<pre><span class="FontName1">var Product = function () {</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this.defineProperties({</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">name: {type: 'string', required: true},</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">description: {type: 'string'},</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">price: {type: 'string'}</span><br>&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">exports.Product = Product;</span></pre>
<p class="indent">The scaffolding with Geddy creates a complete create, read, update, and delete (CRUD) controller. With that simple command you now have control over all the CRUD operations that you might need with the application. The controller will direct the application to store, remove, or redirect your view to whichever portion of your model you are trying to reach.</p>
<p class="noindent2"><b><i>Listing 9-23</i></b>.&nbsp;&nbsp;Products Controller</p>
<pre><span class="FontName1">var Products = function () {</span><br>&nbsp;&nbsp;<span class="FontName1">this.respondsWith = ['html', 'json', 'xml', 'js', 'txt'];</span><br>&nbsp;&nbsp;<span class="FontName1">this.index = function (req, resp, params) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var self = this;</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">geddy.model.Product.all(function(err, products) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.respond({params: params, products: products});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this.add = function (req, resp, params) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this.respond({params: params});</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this.create = function (req, resp, params) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var self = this</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">, product = geddy.model.Product.create(params);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (!product.isValid()) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this.flash.error(product.errors);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this.redirect({action: 'add'});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">product.save(function(err, data) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.flash.error(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.redirect({action: 'add'});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.redirect({controller: self.name});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><a id="cXXX.510"></a><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this.show = function (req, resp, params) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var self = this;</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">geddy.model.Product.first(params.id, function(err, product) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (!product) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var err = new Error();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">err.statusCode = 404;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.error(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.respond({params: params, product: product.toObj()});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this.edit = function (req, resp, params) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var self = this;</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">geddy.model.Product.first(params.id, function(err, product) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (!product) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var err = new Error();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">err.statusCode = 400;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.error(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.respond({params: params, product: product});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this.update = function (req, resp, params) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var self = this;</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">geddy.model.Product.first(params.id, function(err, product) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">product.updateProperties(params);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (!product.isValid()) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this.flash.error(product.errors);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this.redirect({action: 'edit'});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">product.save(function(err, data) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.flash.error(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.redirect({action: 'edit'});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.redirect({controller: self.name});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this.destroy = function (req, resp, params) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var self = this;</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">geddy.model.Product.remove(params.id, function(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.flash.error(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.redirect({action: 'edit'});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.redirect({controller: self.name});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">exports.Products = Products;</span></pre>
<p class="indent">The controller performs the CRUD operations, in this case in-memory, but with the adapters available you could just as easily store to PostgreSQL or MongoDB for persistence. There are several calls to self.redirect. This function will redirect your application to the views as they are described in the controller. These views are created with EmbeddedJS (EJS) templating by default, but you could utilize Jade by passing that as a command-line parameter when you generate your application.</p>
<p class="indent">EmbeddedJS<a id="cXXX.511"></a> is basically just like it sounds; you can embed JavaScript directly within your view template and that will control the final layout of the page. The embedded JavaScript is simply placed within &lt;% %&gt; tags in your markup and that will be stripped out, parsed, and executed as the view is rendered. If you examine the template for adding a product, you see what is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#list24" id="_list24">Listing 9-24</a>, and the ability to embed a child template.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#_list24" id="list24">Listing 9-24</a></i></b>.&nbsp;&nbsp;EJS Template: add.html.ejs</p>
<pre><span class="FontName1">&lt;div class="hero-unit"&gt;</span><br>&nbsp;&nbsp;<span class="FontName1">&lt;form id="product-form" class="form-horizontal" action="/products" method="POST"&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;fieldset&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;legend&gt;Create a new Product&lt;/legend&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;% if(params.errors) { %&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;div class="control-group"&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;ul&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;% for(var err in params.errors) { %&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;li&gt;&lt;%= params.errors[err]; %&gt;&lt;/li&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;% } %&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;/ul&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;/div&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;% } %&gt;</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;%- partial('form', {product: {}}) %&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;div class="form-actions"&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;%- contentTag('input', 'Add', {type: 'submit', class: 'btn btn-primary'}) %&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;/div&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;/fieldset&gt;</span><br>&nbsp;&nbsp;<span class="FontName1">&lt;/form&gt;</span><br><span class="FontName1">&lt;/div&gt;</span></pre>
<p class="noindent2"><b><i>Listing 9-25</i></b>.&nbsp;&nbsp;Partial Child Template<a id="cXXX.512"></a> .html.ejs</p>
<pre><span class="FontName1">&lt;div class="control-group"&gt;</span><br>&nbsp;&nbsp;<span class="FontName1">&lt;label for="name" class="control-label"&gt;name&lt;/label&gt;</span><br>&nbsp;&nbsp;<span class="FontName1">&lt;div class="controls"&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;%- contentTag('input', product.name, {type:'text', class:'span6', name:'name'}) %&gt;</span><br>&nbsp;&nbsp;<span class="FontName1">&lt;/div&gt;</span><br><span class="FontName1">&lt;/div&gt;</span><br><span class="FontName1">&lt;div class="control-group"&gt;</span><br>&nbsp;&nbsp;<span class="FontName1">&lt;label for="description" class="control-label"&gt;description&lt;/label&gt;</span><br>&nbsp;&nbsp;<span class="FontName1">&lt;div class="controls"&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;%- contentTag('input', product.description, {type:'text', class:'span6', name:'description'}) %&gt;</span><br>&nbsp;&nbsp;<span class="FontName1">&lt;/div&gt;</span><br><span class="FontName1">&lt;/div&gt;</span><br><span class="FontName1">&lt;div class="control-group"&gt;</span><br>&nbsp;&nbsp;<span class="FontName1">&lt;label for="price" class="control-label"&gt;price&lt;/label&gt;</span><br>&nbsp;&nbsp;<span class="FontName1">&lt;div class="controls"&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;%- contentTag('input', product.price, {type:'text', class:'span6', name:'price'}) %&gt;</span><br>&nbsp;&nbsp;<span class="FontName1">&lt;/div&gt;</span><br><span class="FontName1">&lt;/div&gt;</span></pre>
<p class="indent">The EJS templates here utilize a function for creating content from the products model. For example, to create the input field that will become the name of a product, the EJS looks like <span class="FontName1">&lt;%- contentTag('input', product.name, {type:'text', class:'span6', name:'name'}) %&gt;</span>, which uses the name of the model item and will assign it back to that model when the form is posted.</p>
<p class="indent">Aside from the scaffolding that autogenerates these CRUD methods for you in your application, you can use the <span class="FontName1">$ geddy gen resource &lt;resourcename&gt;</span> command. The <span class="FontName1">resource</span> command<a id="cXXX.513"></a> is less opinionated in that it does not create a specific view for each operation on the model, and the controller is more generalized as follows:</p>
<pre><span class="FontName1">var Products = function () {</span><br>&nbsp;&nbsp;<span class="FontName1">this.respondsWith = ['html', 'json', 'xml', 'js', 'txt'];</span><br>&nbsp;&nbsp;<span class="FontName1">this.index = function (req, resp, params) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this.respond({params: params});</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this.add = function (req, resp, params) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this.respond({params: params});</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this.create = function (req, resp, params) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// Save the resource, then display index page</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this.redirect({controller: this.name});</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this.show = function (req, resp, params) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this.respond({params: params});</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this.edit = function (req, resp, params) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this.respond({params: params});</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this.update = function (req, resp, params) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// Save the resource, then display the item page</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this.redirect({controller: this.name, id: params.id});</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this.destroy = function (req, resp, params) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this.respond({params: params});</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">exports.Products = Products;</span></pre>
<p class="indent">Using the resource generator may be more suitable for your application because it is less opinionated and you can easily add your own application-specific logic, without the CRUD boilerplate in the <span class="FontName1">scaffold</span> command<a id="cXXX.514"></a>.</p>
<p class="indent">Finally, as you may have already seen in your testing with Geddy, Geddy provides a flexible router. This router is located in the config/router.js file. It can match routes similar to how the Express router performed in Section 9-4. This means that if you had a specific product and you knew the ID and wanted to perform a specific action on that route, you could add this to the router.js file as <span class="FontName1">router.match('products/:id', 'GET').to(products.handleId);</span> This will route the specific ID to the <span class="FontName1">products.handleId</span> controller method. You do not need to specify the HTTP verb in the <span class="FontName1">router.match</span> query<a id="cXXX.515"></a>, in fact, you could have written that as <span class="FontName1">router.get('products/:id').to(products.handleId);</span> and it would perform in the same manner. In this solution you utilize the full resource-based routing, so your router will display as follows:</p>
<pre><span class="FontName1">var router = new geddy.RegExpRouter();</span><br><span class="FontName1">router.get('/').to('Main.index');</span><br><span class="FontName1">router.resource('users');</span><br><span class="FontName1">router.resource('products');</span><br><span class="FontName1">exports.router = router;</span></pre>
<p class="indent">You can swiftly get an application up and running with Geddy. This framework is extremely fast for starting a simple CRUD application and still allows for more creative implementations of your Node.js applications.</p>
</div>
<p id="Sec29" class="Heading1">9-8. Using Yahoo! Mojito </p>
<div>
<p id="Sec30" class="Heading2_2">Problem</p>
<p class="noindent">You want to create a Node.js application by using the Yahoo! Mojito framework<a id="cXXX.523a"></a>.</p>
</div>
<div>
<p id="Sec31" class="Heading2">Solution</p>
<p class="noindent">Yahoo! Mojito is another Node.js application development framework. Created by Yahoo!, it allows you to build high-performance, device-independent HTML5 applications running on both client and server with Node.js.</p>
<p class="indent">To get started with Yahoo! Mojito you first must install the command-line interface. This is done through npm. From then you can utilize the command-line interface to build your application, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#list26" id="_list26">Listing 9-26</a>.</p>
<p class="noindent"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#_list26" id="list26"><i><b>Listing 9-26</b></i></a>.<a id="cXXX.516"></a>Installing Yahoo! Mojito and Creating an Application</p>
<pre><span class="FontName1">$ npm install g mojito-cli</span><br><span class="FontName1">$ mojito create app mojitoapp</span><br><span class="FontName1">$cd mojitoapp</span><br><span class="FontName1">$ mojito create mojit testmojit</span><br><span class="FontName1">$ mojito test</span><br><span class="FontName1">$ mojito start</span><br><span class="FontName1"><a href="http://localhost:8666/@testmojit/index">http://localhost:8666/@testmojit/index</a></span></pre>
</div>
<div>
<p id="Sec32" class="Heading2">How It Works</p>
<p class="noindent">When you install Mojito via npm, you do so globally to gain access to the command-line interface<a id="cXXX.517"></a> throughout your machine. Then you create an application by typing <span class="FontName1">$ mojito create app mojitoapp</span>. This creates a directory named mojitoapp that has the following structure.</p>
<pre><span class="FontName1">mojitoapp</span><br>&nbsp;&nbsp;<span class="FontName1">- artifacts</span><br>&nbsp;&nbsp;<span class="FontName1">- assets</span><br>&nbsp;&nbsp;<span class="FontName1">- mojits</span><br>&nbsp;&nbsp;<span class="FontName1">- node_modules</span><br>&nbsp;&nbsp;<span class="FontName1">application.json</span><br>&nbsp;&nbsp;<span class="FontName1">package.json</span><br>&nbsp;&nbsp;<span class="FontName1">routes.json</span><br>&nbsp;&nbsp;<span class="FontName1">server.js</span></pre>
<p class="indent">The server.js file controls<a id="cXXX.518"></a> the Mojito application and is started when you run <span class="FontName1">mojito start</span>. In this file you see what appears to be a Mojito version of the Node.js HTTP server.</p>
<pre><span class="FontName1">/*jslint anon:true, sloppy:true, nomen:true*/</span><br><span class="FontName1">process.chdir(__dirname);</span><br>&nbsp;<br><span class="FontName1">/*</span><br>&nbsp;<span class="FontName1">* Create the MojitoServer instance we'll interact with. Options can be passed</span><br>&nbsp;<span class="FontName1">* using an object with the desired key/value pairs.</span><br>&nbsp;<span class="FontName1">*/</span><br><span class="FontName1">var Mojito = require('mojito');</span><br><span class="FontName1">var app = Mojito.createServer();</span><br>&nbsp;<br><span class="FontName1">// ---------------------------------------------------------------------------</span><br><span class="FontName1">// Different hosting environments require different approaches to starting the</span><br><span class="FontName1">// server. Adjust below to match the requirements of your hosting environment.</span><br><span class="FontName1">// ---------------------------------------------------------------------------</span><br>&nbsp;<br><span class="FontName1">module.exports = app.listen();</span></pre>
<p class="indent">From this point you created a mojit. A mojit is a Mojito term that represents a mashup of the names module and widget. This means that when you create a mojit, you can think of it as building a module. By default, a mojit in a Mojito application is accessible via the path <span class="FontName1"><a href="http://localhost:8666/@mojitname/index">http://localhost:8666/@mojitname/index</a></span>. When you navigate to this location in your application, you will see the default mojit page, which is part of the Mojito Model-View-Controller (MVC) framework<a id="cXXX.519"></a>.</p>
<p class="indent">The MVC architecture<a id="cXXX.520"></a> in Mojito is centered around what is referred to as an action context, which you will see in the code as ac in most places. The action context of each mojit becomes apparent when you view the source of the controller.server.js file. This file is what registers the mojit with the application and controls the behavior of the views with the models.</p>
<pre><span class="FontName1">/*jslint anon:true, sloppy:true, nomen:true*/</span><br><span class="FontName1">YUI.add('testmojit', function(Y, NAME) {</span><br>&nbsp;<br><span class="FontName1">/**</span><br>&nbsp;<span class="FontName1">* The testmojit module.</span><br>&nbsp;<span class="FontName1">*</span><br>&nbsp;<span class="FontName1">* @module testmojit</span><br>&nbsp;<span class="FontName1">*/</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">/**</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">* Constructor for the Controller class.</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">*</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">* @class Controller</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">* @constructor</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">Y.namespace('mojito.controllers')[NAME] = {</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">/**</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">* Method corresponding to the 'index' action.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">*</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">* @param ac {Object} The ActionContext that provides access</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to the Mojito API.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">index: function(ac) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">ac.models.get('testmojitModel').getData(function(err, data) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">ac.error(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">ac.assets.addCss('./index.css');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">ac.done({</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">status: 'Mojito is working.',</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">data: data</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">}, '0.0.1', {requires: ['mojito', 'mojito-assets-addon', 'mojito-models-addon', 'testmojitModel']});</span></pre>
<p class="indent">The action context within the <span class="FontName1">Y.namespace</span> callback is provided in the index handler for this mojit. It will use the appropriate model <span class="FontName1">ac.models.get('testmojitModel')</span> . . . and will then add assets and send data via an <span class="FontName1">ac.done()</span> handler.</p>
<p class="indent">The model server is found within the models directory for each mojit and you can see that this follows a similar Yahoo! User Interface (YUI<a id="cXXX.521"></a>)<a id="cXXX.522"></a> pattern to generate the model and add it to the application via <span class="FontName1">Y.namespace</span>. This is also where you not only initialize the model with a configuration but also then add methods such as <span class="FontName1">getData</span>.</p>
<pre><span class="FontName1">/*jslint anon:true, sloppy:true, nomen:true*/</span><br><span class="FontName1">YUI.add('testmojitModel', function(Y, NAME) {</span><br>&nbsp;<br><span class="FontName1">/**</span><br>&nbsp;<span class="FontName1">* The testmojitModel module.</span><br>&nbsp;<span class="FontName1">*</span><br>&nbsp;<span class="FontName1">* @module testmojit</span><br>&nbsp;<span class="FontName1">*/</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">/**</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">* Constructor for the testmojitModel class.</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">*</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">* @class testmojitModel</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">* @constructor</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">Y.namespace('mojito.models')[NAME] = {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">init: function(config) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this.config = config;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">},</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">/**</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">* Method that will be invoked by the mojit controller to obtain data.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">*</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">* @param callback {function(err,data)} The callback function to call when the</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data has been retrieved.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">getData: function(callback) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">callback(null, { some: 'data', even: 'more data' });</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">}, '0.0.1', {requires: []});</span></pre>
<p class="indent">Before you look at how the views work with Mojito, you should first understand that you are not limited to leaving your URLs as the default <span class="FontName1">.../@mojitname/index</span> paths. These URLs would be fine from within your application but if a user needs to remember these URLs it is not a great experience. There is a way to make these URLs appear cleaner and more user-friendly.</p>
<p class="indent">First, you need to name your new endpoint by adding the name to the application.json file<a id="cXXX.523"></a> in the root of your application. In this file you name a spec of test and direct that to the type of testmojit, which you created earlier. You then need to name this new route in the routes.json file<a id="cXXX.524"></a>. This is done by naming test index and telling the HTTP GET method on the / path to then resolve the .index handler of the testmojit mojit. These files are shown in the following examples.</p>
<p class="noindent2"><b><i>Listing 9-27</i></b>.&nbsp;&nbsp;Application.json</p>
<pre><span class="FontName1">[</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"settings": [ "master" ],</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"appPort": "8666",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"specs": {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"test": {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"type": "testmojit"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">},</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"settings": [ "environment:development" ],</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"staticHandling": {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"forceUpdate": true</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">]</span></pre>
<p class="noindent2"><b><i>Listing 9-28</i></b>.&nbsp;&nbsp;Routes.json</p>
<pre><span class="FontName1">[{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"settings": [ "master" ],</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"test index": {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"verbs": ["get"],</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"path": "/",</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">"call": "test.index"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">//^^ convert</span> <span class="FontName1"><a href="http://localhost:8666/@testmojit/index">http://localhost:8666/@testmojit/index</a></span> <span class="FontName1">to</span> <span class="FontName1"><a href="http://localhost:8666/">http://localhost:8666/</a></span><br><span class="FontName1">}]</span><br>&nbsp;<br><span class="FontName1">$ mojito start</span><br><span class="FontName1"><a href="http://localhost:8666/">http://localhost:8666/</a></span></pre>
<p class="indent">Now that you are serving your mojit on the URL that you desire, you can modify these templates. The templates for Mojito default to using the handlebars template<a id="cXXX.525"></a> language. Handlebars allow you to insert objects from your models by using simple expressions like you see in the template for the testmojit you created.</p>
<p class="noindent2"><b><i>Listing 9-29</i></b>.&nbsp;&nbsp;Templating with Handlebars</p>
<pre><span class="FontName1">&lt;div id="</span> <b>{{mojit_view_id}}</b> <span class="FontName1">"&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;dl&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;dt&gt;status&lt;/dt&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;dd id="dd_status"&gt;</span> <b>{{status}}</b> <span class="FontName1">&lt;/dd&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;dt&gt;data&lt;/dt&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;dd id="dd_data"&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;b&gt;some:&lt;/b&gt;</span> <b>{{#data}}{{some}}{{/data}}</b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;span&gt;event:&lt;/b&gt;</span> <b>{{#data}}{{even}}{{/data}}</b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;/dd&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">&lt;/dl&gt;</span><br><span class="FontName1">&lt;/div&gt;</span></pre>
<p class="indent">Building a Node.js application by using the Yahoo! Mojito application framework can allow for a versatile MVC application.</p>
</div>
<p id="Sec33" class="Heading1">9-9. Building a Flatiron Application </p>
<div>
<p id="Sec34" class="Heading2_2">Problem</p>
<p class="noindent">You want to build a Node.js server by utilizing the Flatiron application<a id="cXXX.526"></a> framework.</p>
</div>
<div>
<p id="Sec35" class="Heading2">Solution</p>
<p class="noindent">To get started with Flatiron, just like many of the other frameworks you have seen in this chapter, you need to install the framework and doing so globally allows for universal access to the command-line interface. The command-line interface, as you can see in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#list30" id="_list30">Listing 9-30</a>, allows you to quickly scaffold a Flatiron application.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#_list30" id="list30">Listing 9-30</a></i></b>.&nbsp;&nbsp;Installing Flatiron and Generating an Application</p>
<pre><span class="FontName1">$ npm install&nbsp;&nbsp;-g flatiron</span><br>&nbsp;<br><span class="FontName1">$ flatiron create flatironapp</span></pre>
<p class="indent">Once you have created your application, you can install dependencies from within the generated directory <span class="FontName1">$ cd flatironapp</span>. Then, in order to utilize your Flatiron app, you simply start the app.js file.</p>
<pre><span class="FontName1">$ npm install</span><br><span class="FontName1">$ node app.js # starts your app on localhost:3000</span></pre>
</div>
<div>
<p id="Sec36" class="Heading2">How It Works</p>
<p class="noindent">When you first generate an application with Flatiron, you utilize the <span class="FontName1">cli/create.js</span> file that creates the application. This will prompt you for the author and a description of the application you are going to make.</p>
<pre><span class="FontName1">$ flatiron create flatironapp</span><br><span class="FontName1">info:&nbsp;&nbsp;&nbsp;&nbsp;Creating application flatironapp</span><br><span class="FontName1">info:&nbsp;&nbsp;&nbsp;&nbsp;Using http scaffold.</span><br><span class="FontName1">prompt: author:&nbsp;&nbsp;cgack</span><br><span class="FontName1">prompt: description:&nbsp;&nbsp;test application</span><br><span class="FontName1">test application</span><br><span class="FontName1">prompt: homepage:</span><br><span class="FontName1">info:&nbsp;&nbsp;&nbsp;&nbsp;Creating directory config</span><br><span class="FontName1">info:&nbsp;&nbsp;&nbsp;&nbsp;Creating directory lib</span><br><span class="FontName1">info:&nbsp;&nbsp;&nbsp;&nbsp;Creating directory test</span><br><span class="FontName1">info:&nbsp;&nbsp;&nbsp;&nbsp;Writing package.json</span><br><span class="FontName1">info:&nbsp;&nbsp;&nbsp;&nbsp;Writing file app.js</span><br><span class="FontName1">info:&nbsp;&nbsp;&nbsp;&nbsp;Writing file config/config.json</span><br><span class="FontName1">info:&nbsp;&nbsp;&nbsp;&nbsp;Application flatiron is now ready</span></pre>
<p class="indent">Once you provide this information, you now have generated the app.js file, the configuration files, and the package.json file. The package.json file includes the dependencies needed to run the app. This means all you need to do is navigate to your application directory and install dependencies with npm. This will then give you access to the main Flatiron application, which, by default, will use the HTTP plugin, flatiron.plugins.http.</p>
<pre><span class="FontName1">var flatiron = require('flatiron'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">path = require('path'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app = flatiron.app;</span><br>&nbsp;<br><span class="FontName1">app.config.file({ file: path.join(__dirname, 'config', 'config.json') });</span><br><span class="FontName1">app.use(flatiron.plugins.http);</span><br><span class="FontName1">app.router.get('/', function () {</span><br>&nbsp;&nbsp;<span class="FontName1">this.res.json({ 'hello': 'world' })</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">app.start(3000);</span></pre>
<p class="indent">This application has a router built into it, which uses the syntax <span class="FontName1">app.router.VERB('/path', callback);</span> in order to provide the routes and the handlers for those routes. There is no default templating language included for your views in a Flatiron application but the documentation suggests that you can utilize the language Plates  npm install plates save-dev in order to create simple, template-language-free templates. These templates only use a binding between unique HTML ID attributes and would look similar to what is shown here.</p>
<pre><span class="FontName1">var flatiron = require('flatiron'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">path = require('path'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">plates = require('plates'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">app = flatiron.app;</span><br>&nbsp;<br><span class="FontName1">app.config.file({ file: path.join(__dirname, 'config', 'config.json') });</span><br><span class="FontName1">app.use(flatiron.plugins.http);</span><br><span class="FontName1">app.router.get('/', function () {</span><br>&nbsp;&nbsp;<span class="FontName1">this.res.json({ 'hello': 'world' })</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">app.router.get('/test', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var html = '&lt;div id="bind"&gt;&lt;/div&gt;';</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var data = { "bind": "Bound data" };</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var output = plates.bind(html, data);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this.res.end(output);</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">app.start(3000);</span></pre>
<p class="indent">Flatiron has an openness and an API syntax that are similar to the Express framework. It is quick to get up and running with and you should find that it is flexible and extensible. It, like many of the frameworks you have seen in this chapter, provides a way to build a Node.js web server application in a way that allows for swift generation and flexible scalability.</p>
</div>
</div>
<div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-0" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders ">
		
		<li class="copy"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#">Add Highlight</a></li>
		<li class="add-note"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#">
			
				Add Note
			
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch08.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">CHAPTER 8: Creating a WebSocket Server</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch10.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">CHAPTER 10: Connecting to a Data Store</div>
        </a>
    
  
  </div>


        
    </section>
    <div class="reading-controls-bottom">
      <ul class="interface-controls js-bitlist">
        <li class="queue-control">
            <button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9781430260585/chapter/9781430260585_Ch09.xhtml" data-for-analytics="9781430260585:9781430260585_Ch09.xhtml" aria-label="Add to Queue">
      <span>Add to Queue</span>
  </button>
        </li>
      </ul>
    </div>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  





    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel  collapsed slideUp">
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#" class="js-toggle-nag ss-navigateup" title="Toggle open or close footer"></a>
        <div class="sample-message">
          <p class="usage-data t-collapsed-text">Enjoy Safari?
            <a class="ga-active-trial-subscribe-nag" href="https://www.safaribooksonline.com/subscribe/">
              Subscribe Today
              
            </a>
          </p>
          

        <div class="expanded">
          <h2>You have 10 days left in your trial, Raviguru0007. </h2>
          <p class="t-expanded-text">Safari is your trusted guide for building a remarkable career. We hope you've been enjoying your trialready to join?</p>
          <a href="https://www.safaribooksonline.com/subscribe/" class="button-primary">
            Subscribe Today
            
          </a>
          
          <footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
    <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#" class="icon-up" style="display: none;"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/contact/">Contact Us</a></li>
      <li><a href="https://www.safaribooksonline.com/blog/">Blog</a></li>
    </ul>
    <span class="copyright"> 2017 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/membership-agreement/">Membership Agreement</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>

        </div>
      </div>
    </div>

    
    



        
      </div>
      




  <footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
    <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#" class="icon-up" style="display: none;"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      
        <li><a class="t-recommendations-footer" href="https://www.safaribooksonline.com/r/">Recommended</a></li>
      
      <li><a class="t-queue-footer" href="https://www.safaribooksonline.com/s/">Queue</a></li>
      
        <li><a class="t-recent-footer" href="https://www.safaribooksonline.com/history/">History</a></li>
        <li><a class="t-topics-footer" href="https://www.safaribooksonline.com/topics?q=*&amp;limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="https://www.safaribooksonline.com/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="https://www.safaribooksonline.com/u/">Settings</a></li>
      <li><a href="https://www.safaribooksonline.com/blog/">Blog</a></li>
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright"> 2017 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>

<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"agent":"","queueTime":0,"applicationTime":227,"beacon":"bam.nr-data.net","transactionName":"YgdaZ0NSW0cEB0RdWltNfkZfUEFdCgofXFBHDVYdR1pQQxZeRl1QQj1aWkU=","errorBeacon":"bam.nr-data.net","applicationID":"3275661","licenseKey":"510f1a6865"}</script>


    

    <script src="./CHAPTER 9_ Using Web Server Frameworks - Node.js Recipes_ A Problem-Solution Approach_files/saved_resource" charset="utf-8"></script>
    <script src="./CHAPTER 9_ Using Web Server Frameworks - Node.js Recipes_ A Problem-Solution Approach_files/saved_resource(1)" charset="utf-8"></script>
  

<div class="annotator-notice"></div><div class="font-flyout" style="top: 200.012px; left: 1217px;"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch09.xhtml#">Reset</a>
</div>
</div></body></html>